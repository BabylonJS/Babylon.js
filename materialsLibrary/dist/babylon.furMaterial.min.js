var BABYLON;!function(e){var t=4,i=function(e){function t(){e.call(this),this.DIFFUSE=!1,this.HEIGHTMAP=!1,this.CLIPPLANE=!1,this.ALPHATEST=!1,this.POINTSIZE=!1,this.FOG=!1,this.LIGHT0=!1,this.LIGHT1=!1,this.LIGHT2=!1,this.LIGHT3=!1,this.SPOTLIGHT0=!1,this.SPOTLIGHT1=!1,this.SPOTLIGHT2=!1,this.SPOTLIGHT3=!1,this.HEMILIGHT0=!1,this.HEMILIGHT1=!1,this.HEMILIGHT2=!1,this.HEMILIGHT3=!1,this.DIRLIGHT0=!1,this.DIRLIGHT1=!1,this.DIRLIGHT2=!1,this.DIRLIGHT3=!1,this.POINTLIGHT0=!1,this.POINTLIGHT1=!1,this.POINTLIGHT2=!1,this.POINTLIGHT3=!1,this.SHADOW0=!1,this.SHADOW1=!1,this.SHADOW2=!1,this.SHADOW3=!1,this.SHADOWS=!1,this.SHADOWVSM0=!1,this.SHADOWVSM1=!1,this.SHADOWVSM2=!1,this.SHADOWVSM3=!1,this.SHADOWPCF0=!1,this.SHADOWPCF1=!1,this.SHADOWPCF2=!1,this.SHADOWPCF3=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.BONES=!1,this.BONES4=!1,this.BonesPerMesh=0,this.INSTANCES=!1,this._keys=Object.keys(this)}return __extends(t,e),t}(e.MaterialDefines),s=function(s){function n(t,n){s.call(this,t,n),this.furLength=.5,this.furAngle=0,this.diffuseColor=new e.Color3(.44,.21,.02),this.disableLighting=!1,this._worldViewProjectionMatrix=e.Matrix.Zero(),this._scaledDiffuse=new e.Color3,this._defines=new i,this._cachedDefines=new i,this._cachedDefines.BonesPerMesh=-1}return __extends(n,s),n.prototype.needAlphaBlending=function(){return this.alpha<1},n.prototype.needAlphaTesting=function(){return!1},n.prototype.getAlphaTestTexture=function(){return null},n.prototype._checkCache=function(e,t,i){return t?this._defines.INSTANCES!==i?!1:t._materialDefines&&t._materialDefines.isEqual(this._defines)?!0:!1:!0},n.prototype.isReady=function(s,n){if(this.checkReadyOnlyOnce&&this._wasPreviouslyReady)return!0;var r=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===r.getRenderId()&&this._checkCache(r,s,n))return!0;var h=r.getEngine(),a=!1,o=!1;if(this._defines.reset(),r.texturesEnabled){if(this.diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;o=!0,this._defines.DIFFUSE=!0}if(this.heightTexture){if(!this.heightTexture.isReady())return!1;o=!0,this._defines.HEIGHTMAP=!0}}r.clipPlane&&(this._defines.CLIPPLANE=!0),h.getAlphaTesting()&&(this._defines.ALPHATEST=!0),(this.pointsCloud||r.forcePointsCloud)&&(this._defines.POINTSIZE=!0),r.fogEnabled&&s&&s.applyFog&&r.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(this._defines.FOG=!0);var f=0;if(r.lightsEnabled&&!this.disableLighting)for(var l=0;l<r.lights.length;l++){var d=r.lights[l];if(d.isEnabled()){if(d._excludedMeshesIds.length>0){for(var u=0;u<d._excludedMeshesIds.length;u++){var c=r.getMeshByID(d._excludedMeshesIds[u]);c&&d.excludedMeshes.push(c)}d._excludedMeshesIds=[]}if(d._includedOnlyMeshesIds.length>0){for(var g=0;g<d._includedOnlyMeshesIds.length;g++){var v=r.getMeshByID(d._includedOnlyMeshesIds[g]);v&&d.includedOnlyMeshes.push(v)}d._includedOnlyMeshesIds=[]}if(d.canAffectMesh(s)){a=!0,this._defines["LIGHT"+f]=!0;var T;if(T=d instanceof e.SpotLight?"SPOTLIGHT"+f:d instanceof e.HemisphericLight?"HEMILIGHT"+f:d instanceof e.PointLight?"POINTLIGHT"+f:"DIRLIGHT"+f,this._defines[T]=!0,r.shadowsEnabled){var p=d.getShadowGenerator();s&&s.receiveShadows&&p&&(this._defines["SHADOW"+f]=!0,this._defines.SHADOWS=!0,(p.useVarianceShadowMap||p.useBlurVarianceShadowMap)&&(this._defines["SHADOWVSM"+f]=!0),p.usePoissonSampling&&(this._defines["SHADOWPCF"+f]=!0))}if(f++,f===t)break}}}if(s&&(a&&s.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),o&&(s.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(this._defines.UV1=!0),s.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),s.useVertexColors&&s.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,s.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),s.useBones&&s.computeBonesUsingShaders&&(this._defines.BONES=!0,this._defines.BonesPerMesh=s.skeleton.bones.length+1,this._defines.BONES4=!0),n&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines),r.resetCachedMaterial();var _=new e.EffectFallbacks;for(this._defines.FOG&&_.addFallback(1,"FOG"),f=0;t>f;f++)this._defines["LIGHT"+f]&&(f>0&&_.addFallback(f,"LIGHT"+f),this._defines["SHADOW"+f]&&_.addFallback(0,"SHADOW"+f),this._defines["SHADOWPCF"+f]&&_.addFallback(0,"SHADOWPCF"+f),this._defines["SHADOWVSM"+f]&&_.addFallback(0,"SHADOWVSM"+f));this._defines.BONES4&&_.addFallback(0,"BONES4");var x=[e.VertexBuffer.PositionKind];this._defines.NORMAL&&x.push(e.VertexBuffer.NormalKind),this._defines.UV1&&x.push(e.VertexBuffer.UVKind),this._defines.UV2&&x.push(e.VertexBuffer.UV2Kind),this._defines.VERTEXCOLOR&&x.push(e.VertexBuffer.ColorKind),this._defines.BONES&&(x.push(e.VertexBuffer.MatricesIndicesKind),x.push(e.VertexBuffer.MatricesWeightsKind)),this._defines.INSTANCES&&(x.push("world0"),x.push("world1"),x.push("world2"),x.push("world3"));var S="simple",L=this._defines.toString();this._effect=r.getEngine().createEffect(S,x,["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vLightData0","vLightDiffuse0","vLightSpecular0","vLightDirection0","vLightGround0","lightMatrix0","vLightData1","vLightDiffuse1","vLightSpecular1","vLightDirection1","vLightGround1","lightMatrix1","vLightData2","vLightDiffuse2","vLightSpecular2","vLightDirection2","vLightGround2","lightMatrix2","vLightData3","vLightDiffuse3","vLightSpecular3","vLightDirection3","vLightGround3","lightMatrix3","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","diffuseMatrix","shadowsInfo0","shadowsInfo1","shadowsInfo2","shadowsInfo3","furLength","furAngle"],["diffuseSampler","shadowSampler0","shadowSampler1","shadowSampler2","shadowSampler3","heightTexture"],L,_,this.onCompiled,this.onError)}return this._effect.isReady()?(this._renderId=r.getRenderId(),this._wasPreviouslyReady=!0,s&&(s._materialDefines||(s._materialDefines=new i),this._defines.cloneTo(s._materialDefines)),!0):!1},n.prototype.bindOnlyWorldMatrix=function(e){this._effect.setMatrix("world",e)},n.prototype.bind=function(i,n){var r=this.getScene();if(this.bindOnlyWorldMatrix(i),this._effect.setMatrix("viewProjection",r.getTransformMatrix()),n&&n.useBones&&n.computeBonesUsingShaders&&this._effect.setMatrices("mBones",n.skeleton.getTransformMatrices()),r.getCachedMaterial()!==this){if(this.diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._effect.setTexture("diffuseSampler",this.diffuseTexture),this._effect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._effect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.heightTexture&&this._effect.setTexture("heightTexture",this.heightTexture),r.clipPlane){var h=r.clipPlane;this._effect.setFloat4("vClipPlane",h.normal.x,h.normal.y,h.normal.z,h.d)}this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize),this._effect.setVector3("vEyePosition",r._mirroredCameraPosition?r._mirroredCameraPosition:r.activeCamera.position)}if(this._effect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*n.visibility),r.lightsEnabled&&!this.disableLighting)for(var a=0,o=0;o<r.lights.length;o++){var f=r.lights[o];if(f.isEnabled()&&f.canAffectMesh(n)){if(f instanceof e.PointLight?f.transferToEffect(this._effect,"vLightData"+a):f instanceof e.DirectionalLight?f.transferToEffect(this._effect,"vLightData"+a):f instanceof e.SpotLight?f.transferToEffect(this._effect,"vLightData"+a,"vLightDirection"+a):f instanceof e.HemisphericLight&&f.transferToEffect(this._effect,"vLightData"+a,"vLightGround"+a),f.diffuse.scaleToRef(f.intensity,this._scaledDiffuse),this._effect.setColor4("vLightDiffuse"+a,this._scaledDiffuse,f.range),r.shadowsEnabled){var l=f.getShadowGenerator();n.receiveShadows&&l&&(this._effect.setMatrix("lightMatrix"+a,l.getTransformMatrix()),this._effect.setTexture("shadowSampler"+a,l.getShadowMapForRendering()),this._effect.setFloat3("shadowsInfo"+a,l.getDarkness(),l.getShadowMap().getSize().width,l.bias))}if(a++,a===t)break}}r.fogEnabled&&n.applyFog&&r.fogMode!==e.Scene.FOGMODE_NONE&&this._effect.setMatrix("view",r.getViewMatrix()),r.fogEnabled&&n.applyFog&&r.fogMode!==e.Scene.FOGMODE_NONE&&(this._effect.setFloat4("vFogInfos",r.fogMode,r.fogStart,r.fogEnd,r.fogDensity),this._effect.setColor3("vFogColor",r.fogColor)),this._effect.setFloat("furLength",this.furLength),this._effect.setFloat("furAngle",this.furAngle),s.prototype.bind.call(this,i,n)},n.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.heightTexture&&this.heightTexture.animations&&this.heightTexture.animations.length>0&&e.push(this.heightTexture),e},n.prototype.dispose=function(e){this.diffuseTexture&&this.diffuseTexture.dispose(),s.prototype.dispose.call(this,e)},n.prototype.clone=function(e){var t=new n(e,this.getScene());return this.copyTo(t),this.diffuseTexture&&this.diffuseTexture.clone&&(t.diffuseTexture=this.diffuseTexture.clone()),this.heightTexture&&this.heightTexture.clone&&(t.heightTexture=this.heightTexture.clone()),this.diffuseColor&&this.diffuseColor.clone&&(t.diffuseColor=this.diffuseColor.clone()),t},n.prototype.serialize=function(){var e=s.prototype.serialize.call(this);return e.customType="BABYLON.FurMaterial",e.diffuseColor=this.diffuseColor.asArray(),e.disableLighting=this.disableLighting,e.furLength=this.furLength,e.furAngle=this.furAngle,this.diffuseTexture&&(e.diffuseTexture=this.diffuseTexture.serialize()),this.heightTexture&&(e.heightTexture=this.heightTexture.serialize()),e},n.Parse=function(t,i,s){var r=new n(t.name,i);return r.diffuseColor=e.Color3.FromArray(t.diffuseColor),r.furLength=t.furLength,r.furAngle=t.furAngle,r.disableLighting=t.disableLighting,r.alpha=t.alpha,r.id=t.id,e.Tags.AddTagsTo(r,t.tags),r.backFaceCulling=t.backFaceCulling,r.wireframe=t.wireframe,t.diffuseTexture&&(r.diffuseTexture=e.Texture.Parse(t.diffuseTexture,i,s)),t.heightTexture&&(r.heightTexture=e.Texture.Parse(t.heightTexture,i,s)),t.checkReadyOnlyOnce&&(r.checkReadyOnlyOnce=t.checkReadyOnlyOnce),r},n}(e.Material);e.FurMaterial=s}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore.furVertexShader="precision highp float;\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\n// Uniforms\nuniform mat4 worldViewProjection;\nuniform float time;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\nvarying float vfl;\n				\nfloat Random_Final(vec3 rv)\n{\n	float x = dot(rv, vec3(12.9898,78.233, 24.65487));\n	return fract(sin(x) * 43758.5453);\n}\n\nvoid main(void) {\n    float r = Random_Final(position);\n    float fur_length = (2.5 * r);\n    vec3 tangent1 = vec3(normal.y, -normal.x, 0);\n    vec3 tangent2 = vec3(-normal.z, 0, normal.x);\n    r = Random_Final(tangent1);\n	 float J = (4.0 + 2.0*r);\n    r = Random_Final(tangent2);\n	 float K = (2.0 + 2.0* r);\n	 tangent1 = tangent1*J + tangent2*K;\n	 tangent1 = normalize(tangent1);\n    vec3 v = position;\n    v = v + 0.2*normal * fur_length + tangent1*0.1;\n    \n    gl_Position = worldViewProjection * vec4(v, 1.0);\n    \n    vPosition = position;\n    vNormal = normal;\n    vUV = uv;\n    vfl = fur_length;\n};\n",BABYLON.Effect.ShadersStore.furPixelShader="precision highp float;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\nvarying float vfl;\n\n// Uniforms\nuniform mat4 world;\n\n// Refs\nuniform vec3 cameraPosition;\n				\nvoid main(void) {\n    vec3 vLightPosition = vec3(0,200,100);\n    \n    // World values\n    vec3 vPositionW = vec3(world * vec4(vPosition, 1.0));\n    vec3 vNormalW = normalize(vec3(world * vec4(vNormal, 0.0)));\n    vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n    \n    // Light variation depends on fur length gives shadow effect on a plane\n    vec3 lightVectorW = (0.1 + vfl/4.0)*normalize(vLightPosition - vPositionW);\n    vec3 color = vec3(0.44,0.21,0.02).rgb;\n    \n    // diffuse\n    float ndl = abs(dot(vNormalW, lightVectorW));\n    \n    // Specular\n    vec3 angleW = normalize(viewDirectionW + (0.1 + vfl)*lightVectorW);\n    float specComp = max(0., dot(vNormalW, angleW));\n    specComp = pow(specComp, max(1., 64.)) * 2.;\n    \n    gl_FragColor = vec4(color * ndl , 1.0);\n};";