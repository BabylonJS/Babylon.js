var BABYLON;!(function(e){var t=(function(){function t(){this.materials=[]}return t.prototype.parseMTL=function(r,s,n){if(!(s instanceof ArrayBuffer)){for(var a,i=s.split("\n"),o=/\s+/,l=null,u=0;u<i.length;u++){var p=i[u].trim();if(0!==p.length&&"#"!==p.charAt(0)){var h=p.indexOf(" "),m=h>=0?p.substring(0,h):p;m=m.toLowerCase();var f=h>=0?p.substring(h+1).trim():"";"newmtl"===m?(l&&this.materials.push(l),l=new e.StandardMaterial(f,r)):"kd"===m&&l?(a=f.split(o,3).map(parseFloat),l.diffuseColor=e.Color3.FromArray(a)):"ka"===m&&l?(a=f.split(o,3).map(parseFloat),l.ambientColor=e.Color3.FromArray(a)):"ks"===m&&l?(a=f.split(o,3).map(parseFloat),l.specularColor=e.Color3.FromArray(a)):"ke"===m&&l?(a=f.split(o,3).map(parseFloat),l.emissiveColor=e.Color3.FromArray(a)):"ns"===m&&l?l.specularPower=parseFloat(f):"d"===m&&l?l.alpha=parseFloat(f):"map_ka"===m&&l?l.ambientTexture=t._getTexture(n,f,r):"map_kd"===m&&l?l.diffuseTexture=t._getTexture(n,f,r):"map_ks"===m&&l?l.specularTexture=t._getTexture(n,f,r):"map_ns"===m||("map_bump"===m&&l?l.bumpTexture=t._getTexture(n,f,r):"map_d"===m&&l&&(l.opacityTexture=t._getTexture(n,f,r)))}}l&&this.materials.push(l)}},t._getTexture=function(t,r,s){if(!r)return null;var n=t;if("file:"===t){var a=r.lastIndexOf("\\");-1===a&&(a=r.lastIndexOf("/")),n+=a>-1?r.substr(a+1):r}else n+=r;return new e.Texture(n,s)},t})();e.MTLFileLoader=t;var r=(function(){function r(){this.name="obj",this.extensions=".obj",this.obj=/^o/,this.group=/^g/,this.mtllib=/^mtllib /,this.usemtl=/^usemtl /,this.smooth=/^s /,this.vertexPattern=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.normalPattern=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.uvPattern=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.facePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,this.facePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/}return r.prototype._loadMTL=function(t,r,s){var n=e.Tools.BaseUrl+r+t;e.Tools.LoadFile(n,s,void 0,void 0,!1,(function(){console.warn("Error - Unable to load "+n)}))},r.prototype.importMesh=function(e,t,r,s,n,a,i){var o=this._parseSolid(e,t,r,s);return n&&o.forEach((function(e){n.push(e)})),!0},r.prototype.load=function(e,t,r){return this.importMesh(null,e,t,r,null,null,null)},r.prototype.loadAssetContainer=function(t,r,s,n){var a=new e.AssetContainer(t);return this.importMesh(null,t,r,s,a.meshes,null,null),a.removeAllFromScene(),a},r.prototype._parseSolid=function(s,n,a,i){for(var o,l=[],u=[],p=[],h=[],m=[],f=[],c=[],d=[],v=[],x=0,g=!1,T=[],_=[],F=[],I=[],y="",P="",b=new t,w=1,A=!0,E=function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});var r=e[t[0]].normals.indexOf(t[1]);return-1===r?-1:e[t[0]].idx[r]},L=function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});var r=e[t[0]].normals.indexOf(t[1]);return 1!=r&&t[2]==e[t[0]].uv[r]?e[t[0]].idx[r]:-1},M=function(e,t,s,n,a,i){var o;o=r.OPTIMIZE_WITH_UV?L(v,[e,s,t]):E(v,[e,s]),-1==o?(m.push(f.length),f.push(n),c.push(a),d.push(i),v[e].normals.push(s),v[e].idx.push(x++),r.OPTIMIZE_WITH_UV&&v[e].uv.push(t)):m.push(o)},O=function(){for(var e=0;e<f.length;e++)T.push(f[e].x,f[e].y,f[e].z),_.push(d[e].x,d[e].y,d[e].z),F.push(c[e].x,c[e].y);f=[],d=[],c=[],v=[],x=0},V=function(e,t){t+1<e.length&&(I.push(e[0],e[t],e[t+1]),t+=1,V(e,t))},C=function(){h.length>0&&(o=h[h.length-1],O(),m.reverse(),o.indices=m.slice(),o.positions=T.slice(),o.normals=_.slice(),o.uvs=F.slice(),m=[],T=[],_=[],F=[])},N=a.split("\n"),B=0;B<N.length;B++){var U,k=N[B].trim();if(0!==k.length&&"#"!==k.charAt(0))if(null!==(U=this.vertexPattern.exec(k)))l.push(new e.Vector3(parseFloat(U[1]),parseFloat(U[2]),parseFloat(U[3])));else if(null!==(U=this.normalPattern.exec(k)))u.push(new e.Vector3(parseFloat(U[1]),parseFloat(U[2]),parseFloat(U[3])));else if(null!==(U=this.uvPattern.exec(k)))p.push(new e.Vector2(parseFloat(U[1]),parseFloat(U[2])));else if(null!==(U=this.facePattern3.exec(k)))!(function(e,t){V(e,t);for(var r=0;r<I.length;r++){var s=I[r].split("/"),n=parseInt(s[0])-1,a=parseInt(s[1])-1,i=parseInt(s[2])-1;M(n,a,i,l[n],p[a],u[i])}I=[]})(U[1].trim().split(" "),1);else if(null!==(U=this.facePattern4.exec(k)))!(function(t,r){V(t,r);for(var s=0;s<I.length;s++){var n=I[s].split("//"),a=parseInt(n[0])-1,i=parseInt(n[1])-1;M(a,1,i,l[a],e.Vector2.Zero(),u[i])}I=[]})(U[1].trim().split(" "),1);else if(null!==(U=this.facePattern2.exec(k)))!(function(t,r){V(t,r);for(var s=0;s<I.length;s++){var n=I[s].split("/"),a=parseInt(n[0])-1,i=parseInt(n[1])-1;M(a,i,0,l[a],p[i],e.Vector3.Up())}I=[]})(U[1].trim().split(" "),1);else if(null!==(U=this.facePattern1.exec(k)))!(function(t,r){V(t,r);for(var s=0;s<I.length;s++){var n=parseInt(I[s])-1;M(n,0,0,l[n],e.Vector2.Zero(),e.Vector3.Up())}I=[]})(U[1].trim().split(" "),1);else if(this.group.test(k)||this.obj.test(k)){var S={name:k.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,materialName:""};C(),h.push(S),g=!0,A=!0,w=1}else if(this.usemtl.test(k)){if(y=k.substring(7).trim(),!A){C();var S={name:"_mm"+w.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,materialName:y};w++,h.push(S)}g&&A&&(h[h.length-1].materialName=y,A=!1)}else this.mtllib.test(k)?P=k.substring(7).trim():this.smooth.test(k)||console.log("Unhandled expression at line : "+k)}g&&(o=h[h.length-1],m.reverse(),O(),o.indices=m,o.positions=T,o.normals=_,o.uvs=F),g||(m.reverse(),O(),h.push({name:e.Geometry.RandomId(),indices:m,positions:T,normals:_,uvs:F,materialName:y}));for(var Y=[],Z=new Array,j=0;j<h.length;j++){if(s&&h[j].name)if(s instanceof Array){if(-1==s.indexOf(h[j].name))continue}else if(h[j].name!==s)continue;o=h[j];var R=new e.Mesh(h[j].name,n);Z.push(h[j].materialName);var H=new e.VertexData;H.positions=o.positions,H.normals=o.normals,H.uvs=o.uvs,H.indices=o.indices,H.applyToMesh(R),r.INVERT_Y&&(R.scaling.y*=-1),Y.push(R)}return""!==P&&this._loadMTL(P,i,(function(e){b.parseMTL(n,e,i);for(var t=0;t<b.materials.length;t++){for(var r,s=0,a=[];(r=Z.indexOf(b.materials[t].name,s))>-1;)a.push(r),s=r+1;if(-1==r&&0==a.length)b.materials[t].dispose();else for(var o=0;o<a.length;o++)Y[a[o]].material=b.materials[t]}})),Y},r.OPTIMIZE_WITH_UV=!1,r.INVERT_Y=!1,r})();e.OBJFileLoader=r,e.SceneLoader&&e.SceneLoader.RegisterPlugin(new r)})(BABYLON||(BABYLON={}));