var __decorate=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},BABYLON;!(function(e){var t=(function(){function t(){this.radius=0,this.center=e.Vector2.Zero(),this.extent=e.Vector2.Zero()}return t.CreateFromSize=function(e){var r=new t;return t.CreateFromSizeToRef(e,r),r},t.CreateFromRadius=function(e){var r=new t;return t.CreateFromRadiusToRef(e,r),r},t.CreateFromPoints=function(e){var r=new t;return t.CreateFromPointsToRef(e,r),r},t.CreateFromSizeToRef=function(t,r){t||(t=e.Size.Zero()),r.center.x=+t.width/2,r.center.y=+t.height/2,r.extent.x=r.center.x,r.extent.y=r.center.y,r.radius=r.extent.length()},t.CreateFromRadiusToRef=function(e,t){t.center.x=t.center.y=0;var r=+e;t.extent.x=r,t.extent.y=r,t.radius=r},t.CreateFromPointsToRef=function(e,r){for(var n=Number.MAX_VALUE,i=Number.MAX_VALUE,o=Number.MIN_VALUE,a=Number.MIN_VALUE,s=0,l=e;s<l.length;s++){var u=l[s];n=Math.min(u.x,n),o=Math.max(u.x,o),i=Math.min(u.y,i),a=Math.max(u.y,a)}t.CreateFromMinMaxToRef(n,o,i,a,r)},t.CreateFromMinMaxToRef=function(t,r,n,i,o){var a=r-t,s=i-n;o.center=new e.Vector2(t+a/2,n+s/2),o.extent=new e.Vector2(r-o.center.x,i-o.center.y),o.radius=o.extent.length()},t.prototype.clone=function(){var e=new t;return e.center=this.center.clone(),e.radius=this.radius,e.extent=this.extent.clone(),e},t.prototype.clear=function(){this.center.copyFromFloats(0,0),this.radius=0,this.extent.copyFromFloats(0,0)},t.prototype.copyFrom=function(e){this.center.copyFrom(e.center),this.radius=e.radius,this.extent.copyFrom(e.extent)},t.prototype.max=function(){var t=e.Vector2.Zero();return this.maxToRef(t),t},t.prototype.maxToRef=function(e){e.x=this.center.x+this.extent.x,e.y=this.center.y+this.extent.y},t.prototype.transform=function(e){var r=new t;return this.transformToRef(e,r),r},t.prototype.union=function(e){var r=new t;return this.unionToRef(e,r),r},t.prototype.transformToRef=function(r,n){var i=t._transform;i[0].x=this.center.x+this.extent.x,i[0].y=this.center.y+this.extent.y,i[1].x=this.center.x+this.extent.x,i[1].y=this.center.y-this.extent.y,i[2].x=this.center.x-this.extent.x,i[2].y=this.center.y-this.extent.y,i[3].x=this.center.x-this.extent.x,i[3].y=this.center.y+this.extent.y;for(var o=0;o<4;o++)e.Vector2.TransformToRef(i[o],r,i[o]);t.CreateFromPointsToRef(i,n)},t.prototype.unionToRef=function(e,r){var n=Math.max(this.center.x+this.extent.x,e.center.x+e.extent.x),i=Math.max(this.center.y+this.extent.y,e.center.y+e.extent.y),o=Math.min(this.center.x-this.extent.x,e.center.x-e.extent.x),a=Math.min(this.center.y-this.extent.y,e.center.y-e.extent.y);t.CreateFromMinMaxToRef(o,n,a,i,r)},t.prototype.doesIntersect=function(e){var t=e.subtract(this.center);return t.lengthSquared()<=this.radius*this.radius&&(Math.abs(t.x)<=this.extent.x&&Math.abs(t.y)<=this.extent.y)},t._transform=new Array(e.Vector2.Zero(),e.Vector2.Zero(),e.Vector2.Zero(),e.Vector2.Zero()),t})();e.BoundingInfo2D=t})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(){function t(){this.layoutDirtyOnPropertyChangedMask=0}return t.prototype.updateLayout=function(e){},Object.defineProperty(t.prototype,"isChildPositionAllowed",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.isLocked=function(){return this._isLocked},t.prototype.lock=function(){return!this._isLocked&&(this._isLocked=!0,!0)},t=__decorate([e.className("LayoutEngineBase")],t)})();e.LayoutEngineBase=t;var r=(function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.updateLayout=function(t){if(t._isFlagSet(e.SmartPropertyPrim.flagLayoutDirty)){for(var r=0,n=t.children;r<n.length;r++){var i=n[r];this._doUpdate(i)}t._clearFlags(e.SmartPropertyPrim.flagLayoutDirty)}},r.prototype._doUpdate=function(t){t instanceof e.Canvas2D?t.layoutArea=t.actualSize:t.parent instanceof e.Canvas2D?t.layoutArea=t.owner.actualSize:t.layoutArea=t.parent.contentArea},Object.defineProperty(r.prototype,"isChildPositionAllowed",{get:function(){return!0},enumerable:!0,configurable:!0}),r.Singleton=new r,r=__decorate([e.className("CanvasLayoutEngine")],r)})(t);e.CanvasLayoutEngine=r;var n=(function(t){function r(){t.call(this),this._isHorizontal=!0,this.layoutDirtyOnPropertyChangedMask=e.Prim2DBase.sizeProperty.flagId}return __extends(r,t),Object.defineProperty(r,"Horizontal",{get:function(){return r._horizontal||(r._horizontal=new r,r._horizontal.isHorizontal=!0,r._horizontal.lock()),r._horizontal},enumerable:!0,configurable:!0}),Object.defineProperty(r,"Vertical",{get:function(){return r._vertical||(r._vertical=new r,r._vertical.isHorizontal=!1,r._vertical.lock()),r._vertical},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isHorizontal",{get:function(){return this._isHorizontal},set:function(e){this.isLocked()||(this._isHorizontal=e)},enumerable:!0,configurable:!0}),r.prototype.updateLayout=function(t){if(t._isFlagSet(e.SmartPropertyPrim.flagLayoutDirty)){for(var n=0,i=0,o=this.isHorizontal,a=0,s=0,l=t.children;s<l.length;s++){var u=l[s],c=void 0;u._hasMargin?(u.margin.computeWithAlignment(t.layoutArea,u.actualSize,u.marginAlignment,r.dstOffset,r.dstArea,!0),c=r.dstArea.clone(),u.layoutArea=c):(c=u.layoutArea,u.margin.computeArea(u.actualSize,c)),a=Math.max(a,o?c.height:c.width)}for(var h=0,d=t.children;h<d.length;h++){var u=d[h];u.layoutAreaPos=new e.Vector2(n,i);var c=u.layoutArea;o?(n+=c.width,u.layoutArea=new e.Size(c.width,a)):(i+=c.height,u.layoutArea=new e.Size(a,c.height))}t._clearFlags(e.SmartPropertyPrim.flagLayoutDirty)}},Object.defineProperty(r.prototype,"isChildPositionAllowed",{get:function(){return!1},enumerable:!0,configurable:!0}),r._horizontal=null,r._vertical=null,r.dstOffset=e.Vector2.Zero(),r.dstArea=e.Size.Zero(),r=__decorate([e.className("StackPanelLayoutEngine")],r)})(t);e.StackPanelLayoutEngine=n})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(){function e(){}return e.prototype.isLocked=function(){return this._isLocked},e.prototype.lock=function(){return!!this._isLocked||(this.onLock(),this._isLocked=!0,!1)},e.prototype.onLock=function(){},e})();e.LockableBase=t;var r=(function(t){function r(e,r){void 0===r&&(r=!1),t.call(this),this._color=e,r&&this.lock()}return __extends(r,t),r.prototype.isTransparent=function(){return this._color&&this._color.a<1},Object.defineProperty(r.prototype,"color",{get:function(){return this._color},set:function(e){this.isLocked()||(this._color=e)},enumerable:!0,configurable:!0}),r.prototype.toString=function(){return this._color.toHexString()},r=__decorate([e.className("SolidColorBrush2D")],r)})(t);e.SolidColorBrush2D=r;var n=(function(t){function r(r,n,i,o,a,s){void 0===i&&(i=e.Vector2.Zero()),void 0===o&&(o=0),void 0===a&&(a=1),void 0===s&&(s=!1),t.call(this),this._color1=r,this._color2=n,this._translation=i,this._rotation=o,this._scale=a,s&&this.lock()}return __extends(r,t),r.prototype.isTransparent=function(){return this._color1&&this._color1.a<1||this._color2&&this._color2.a<1},Object.defineProperty(r.prototype,"color1",{get:function(){return this._color1},set:function(e){this.isLocked()||(this._color1=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"color2",{get:function(){return this._color2},set:function(e){this.isLocked()||(this._color2=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"translation",{get:function(){return this._translation},set:function(e){this.isLocked()||(this._translation=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this.isLocked()||(this._rotation=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale",{get:function(){return this._scale},set:function(e){this.isLocked()||(this._scale=e)},enumerable:!0,configurable:!0}),r.prototype.toString=function(){return"C1:"+this._color1+";C2:"+this._color2+";T:"+this._translation.toString()+";R:"+this._rotation+";S:"+this._scale+";"},r.BuildKey=function(e,t,r,n,i){return"C1:"+e+";C2:"+t+";T:"+r.toString()+";R:"+n+";S:"+i+";"},r=__decorate([e.className("GradientColorBrush2D")],r)})(t);e.GradientColorBrush2D=n})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){function t(e,t,r,n,i){return void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===i&&(i=!1),l._hookProperty(e,t,r,n,i,o.PROPKIND_MODEL)}function r(e,t,r,n,i){return void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===i&&(i=!1),l._hookProperty(e,t,r,n,i,o.PROPKIND_INSTANCE)}function n(e,t,r,n,i){return void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===i&&(i=!1),l._hookProperty(e,t,r,n,i,o.PROPKIND_DYNAMIC)}var i=(function(){function e(){}return e})();e.Prim2DClassInfo=i;var o=(function(){function e(){}return e.PROPKIND_MODEL=1,e.PROPKIND_INSTANCE=2,e.PROPKIND_DYNAMIC=3,e})();e.Prim2DPropInfo=o;var a=(function(){function e(){}return e})();e.PropertyChangedInfo=a;var s=(function(){function t(t,r,n){this._baseClass=t,this._type=r,this._subClasses=new Array,this._levelContent=new e.StringDictionary,this._classContentFactory=n}return Object.defineProperty(t.prototype,"classContent",{get:function(){return this._classContent||(this._classContent=this._classContentFactory(this._baseClass?this._baseClass.classContent:null)),this._classContent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"levelContent",{get:function(){return this._levelContent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullContent",{get:function(){if(!this._fullContent){for(var t=new e.StringDictionary,r=this;r;)r.levelContent.forEach((function(e,r){return t.add(e,r)})),r=r._baseClass;this._fullContent=t}return this._fullContent},enumerable:!0,configurable:!0}),t.prototype.getLevelOf=function(e){if(e===this._type)return this;var t=Object.getPrototypeOf(e),r=this.getOrAddType(Object.getPrototypeOf(t),t);return r||this.getLevelOf(t),this.getOrAddType(t,e)},t.prototype.getOrAddType=function(e,r){if(e===this._type){for(var n=0,i=this._subClasses;n<i.length;n++){var o=i[n];if(o.type===r)return o.node}var a=new t(this,r,this._classContentFactory),s={type:r,node:a};return this._subClasses.push(s),s.node}for(var l=0,u=this._subClasses;l<u.length;l++){var o=u[l],s=o.node.getOrAddType(e,r);if(s)return s}return null},t.get=function(e){var t=e.__classTreeInfo;return t?t.getLevelOf(e):null},t.getOrRegister=function(e,r){var n=e.__classTreeInfo;return n||(n=new t(null,e,r),e.__classTreeInfo=n),n},t})();e.ClassTreeInfo=s;var l=(function(){function t(){this._flags=0,this._modelKey=null,this._instanceDirtyFlags=0,this._levelBoundingInfo=new e.BoundingInfo2D,this.animations=new Array}return Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isFlagSet(t.flagIsDisposed)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){return!this.isDisposed&&(this.animations.splice(0),this._setFlags(t.flagIsDisposed),!0)},t.prototype.getAnimatables=function(){return new Array},Object.defineProperty(t.prototype,"modelKey",{get:function(){var r=this;if(!this._isFlagSet(t.flagModelDirty)&&this._modelKey)return this._modelKey;var n="Class:"+e.Tools.getClassName(this)+";",i=this.propDic;return i.forEach((function(t,i){if(i.kind===o.PROPKIND_MODEL){var a=r[i.name];if(a&&a.constructor===Array){var s=a[0];a=s?e.Tools.hashCodeFromStream(e.Tools.arrayOrStringFeeder(a)):0}n+=i.name+":"+(null!=a?i.typeLevelCompare?e.Tools.getClassName(a):a.toString():"[null]")+";"}})),this._clearFlags(t.flagModelDirty),this._modelKey=n,n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDirty",{get:function(){return 0!==this._instanceDirtyFlags||this._areSomeFlagsSet(t.flagModelDirty|t.flagPositioningDirty|t.flagLayoutDirty)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"propDic",{get:function(){if(!this._propInfo){var e=s.get(Object.getPrototypeOf(this));if(!e)throw new Error("Can't access the propDic member in class definition, is this class SmartPropertyPrim based?");this._propInfo=e.fullContent}return this._propInfo},enumerable:!0,configurable:!0}),t._createPropInfo=function(e,t,r,n,a,l,u){var c=s.getOrRegister(e,(function(){return new i})),h=c.getLevelOf(e),d=h.levelContent.get(r.toString());if(d)throw new Error("The ID "+r+" is already taken by another property declaration named: "+d.name);return d=new o,d.id=r,d.flagId=Math.pow(2,r),d.kind=u,d.name=t,d.dirtyBoundingInfo=n,d.dirtyParentBoundingInfo=a,d.typeLevelCompare=l,h.levelContent.add(t,d),d},t._checkUnchanged=function(e,t){if(null===e&&null===t||void 0===e&&void 0===t)return!0;if(null!=e&&null!=t)if("function"==typeof e.equals){if(e.equals(t))return!0}else if(e===t)return!0;return!1},t.prototype._triggerPropertyChanged=function(e,t){this.isDisposed||e&&this._handlePropChanged(void 0,t,e.name,e,e.typeLevelCompare)},t.prototype._boundingBoxDirty=function(){if(this._setFlags(t.flagLevelBoundingInfoDirty),this instanceof e.Prim2DBase)for(var r=this;r&&(r._setFlags(t.flagBoundingInfoDirty),r.isSizeAuto&&(r.onPrimitivePropertyDirty(e.Prim2DBase.sizeProperty.flagId),r._setFlags(t.flagPositioningDirty)),!(r instanceof e.Group2D&&r.isRenderableGroup));)r=r.parent},t.prototype._handlePropChanged=function(r,n,i,a,s){if(a.dirtyBoundingInfo)this._boundingBoxDirty();else if(a.dirtyParentBoundingInfo){var l=this._parent;null!=l&&l._boundingBoxDirty()}var u=t.propChangedInfo;u.oldValue=r,u.newValue=n,u.propertyName=i;var c=a.flagId;if(this.propertyChanged.notifyObservers(u,c),this instanceof e.Group2D&&this.handleGroupChanged(a),this instanceof e.Prim2DBase){var l=this._parent;null!=l&&l.layoutEngine&&0!==(l.layoutEngine.layoutDirtyOnPropertyChangedMask&a.flagId)&&l._setLayoutDirty()}var h=!1;if(s&&null!=r&&null!=n){var d=r.__proto__,p=n.__proto__;h=d===p}h||a.kind!==o.PROPKIND_MODEL?(h||a.kind===o.PROPKIND_INSTANCE||a.kind===o.PROPKIND_DYNAMIC)&&this.onPrimitivePropertyDirty(c):this.isDirty||this._setFlags(t.flagModelDirty)},t.prototype.onPrimitivePropertyDirty=function(e){this.onPrimBecomesDirty(),this._instanceDirtyFlags|=e},t.prototype.handleGroupChanged=function(e){},t.prototype.checkPropertiesDirty=function(e){return 0!==(this._instanceDirtyFlags&e)},t.prototype.clearPropertiesDirty=function(e){return this._instanceDirtyFlags&=~e,this._instanceDirtyFlags},t.prototype._resetPropertiesDirty=function(){this._instanceDirtyFlags=0,this._clearFlags(t.flagPrimInDirtyList|t.flagNeedRefresh)},Object.defineProperty(t.prototype,"levelBoundingInfo",{get:function(){return this._isFlagSet(t.flagLevelBoundingInfoDirty)&&(this.updateLevelBoundingInfo(),this._clearFlags(t.flagLevelBoundingInfoDirty)),this._levelBoundingInfo},enumerable:!0,configurable:!0}),t.prototype.updateLevelBoundingInfo=function(){},t.prototype.onPrimBecomesDirty=function(){},t._hookProperty=function(e,r,n,i,o,a){return function(s,l,u){var c=t._createPropInfo(s,l,e,i,o,n,a);r&&r(c);var h=u.get,d=u.set;u.set=function(e){if(!this.isDisposed){var r=h.call(this);if(!t._checkUnchanged(r,e)){var i=this;d.call(this,e),i._handlePropChanged(r,e,l,c,n)}}}}},t.prototype.addExternalData=function(t,r){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.add(t,r)},t.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},t.prototype.getOrAddExternalDataWithFactory=function(t,r){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.getOrAddWithFactory(t,r)},t.prototype.removeExternalData=function(e){return!!this._externalData&&this._externalData.remove(e)},t.prototype._isFlagSet=function(e){return 0!==(this._flags&e)},t.prototype._areAllFlagsSet=function(e){return(this._flags&e)===e},t.prototype._areSomeFlagsSet=function(e){return 0!==(this._flags&e)},t.prototype._clearFlags=function(e){this._flags&=~e},t.prototype._setFlags=function(e){var t=this._flags;return this._flags|=e,t},t.prototype._changeFlags=function(e,t){t?this._flags|=e:this._flags&=~e},t.propChangedInfo=new a,t.flagIsDisposed=1,t.flagLevelBoundingInfoDirty=2,t.flagModelDirty=4,t.flagLayoutDirty=8,t.flagLevelVisible=16,t.flagBoundingInfoDirty=32,t.flagIsPickable=64,t.flagIsVisible=128,t.flagVisibilityChanged=256,t.flagPositioningDirty=512,t.flagTrackedGroup=1024,t.flagWorldCacheChanged=2048,t.flagChildrenFlatZOrder=4096,t.flagZOrderDirty=8192,t.flagActualOpacityDirty=16384,t.flagPrimInDirtyList=32768,t.flagIsContainer=65536,t.flagNeedRefresh=131072,t.flagActualScaleDirty=262144,t.flagDontInheritParentScale=524288,t.flagGlobalTransformDirty=1048576,t.flagLayoutBoundingInfoDirty=1048576,t=__decorate([e.className("SmartPropertyPrim")],t)})();e.SmartPropertyPrim=l,e.modelLevelProperty=t,e.instanceLevelProperty=r,e.dynamicLevelProperty=n})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(){function e(){this.forceRefreshPrimitive=!1}return e})();e.PrepareRender2DContext=t;var r=(function(){function e(e){this._renderMode=e,this.useInstancing=!1,this.groupInfoPartData=null,this.partDataStartIndex=this.partDataEndIndex=null,this.instancedBuffers=null}return Object.defineProperty(e.prototype,"renderMode",{get:function(){return this._renderMode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeOpaque",{get:function(){return e._renderModeOpaque},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeAlphaTest",{get:function(){return e._renderModeAlphaTest},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeTransparent",{get:function(){return e._renderModeTransparent},enumerable:!0,configurable:!0}),e._renderModeOpaque=1,e._renderModeAlphaTest=2,e._renderModeTransparent=3,e})();e.Render2DContext=r;var n=(function(){function t(){this.primitivePointerPos=e.Vector2.Zero(),this.tilt=e.Vector2.Zero(),this.cancelBubble=!1}return Object.defineProperty(t,"PointerOver",{get:function(){return t._pointerOver},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerEnter",{get:function(){return t._pointerEnter},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerDown",{get:function(){return t._pointerDown},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerMouseWheel",{get:function(){return t._pointerMouseWheel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerMove",{get:function(){return t._pointerMove},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerUp",{get:function(){return t._pointerUp},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerOut",{get:function(){return t._pointerOut},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerLeave",{get:function(){return t._pointerLeave},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerGotCapture",{get:function(){return t._pointerGotCapture},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerLostCapture",{get:function(){return t._pointerLostCapture},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MouseWheelPrecision",{get:function(){return t._mouseWheelPrecision},enumerable:!0,configurable:!0}),t.prototype.updateRelatedTarget=function(e,t){this.relatedTarget=e,this.relatedTargetPointerPos=t},t.getEventTypeName=function(e){switch(e){case t.PointerOver:return"PointerOver";case t.PointerEnter:return"PointerEnter";case t.PointerDown:return"PointerDown";case t.PointerMouseWheel:return"PointerMouseWheel";case t.PointerMove:return"PointerMove";case t.PointerUp:return"PointerUp";case t.PointerOut:return"PointerOut";case t.PointerLeave:return"PointerLeave";case t.PointerGotCapture:return"PointerGotCapture";case t.PointerLostCapture:return"PointerLostCapture"}},t._pointerOver=1,t._pointerEnter=2,t._pointerDown=4,t._pointerMouseWheel=8,t._pointerMove=16,t._pointerUp=32,t._pointerOut=64,t._pointerLeave=128,t._pointerGotCapture=256,t._pointerLostCapture=512,t._mouseWheelPrecision=3,t})();e.PrimitivePointerInfo=n;var i=(function(){function e(t){this._changedCallback=t,this._horizontal=e.AlignLeft,this._vertical=e.AlignBottom}return Object.defineProperty(e,"AlignLeft",{get:function(){return e._AlignLeft},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AlignTop",{get:function(){return e._AlignTop},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AlignRight",{get:function(){return e._AlignRight},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AlignBottom",{get:function(){return e._AlignBottom},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AlignCenter",{get:function(){return e._AlignCenter},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AlignStretch",{get:function(){return e._AlignStretch},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontal",{get:function(){return this._horizontal},set:function(e){this._horizontal!==e&&(this._horizontal=e,this._changedCallback())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertical",{get:function(){return this._vertical},set:function(e){this._vertical!==e&&(this._vertical=e,this._changedCallback())},enumerable:!0,configurable:!0}),e.prototype.setHorizontal=function(t){var r=t.trim().toLocaleLowerCase();switch(r){case"left":return void(this.horizontal=e.AlignLeft);case"right":return void(this.horizontal=e.AlignRight);case"center":return void(this.horizontal=e.AlignCenter);case"stretch":return void(this.horizontal=e.AlignStretch)}},e.prototype.setVertical=function(t){var r=t.trim().toLocaleLowerCase();switch(r){case"top":return void(this.vertical=e.AlignTop);case"bottom":return void(this.vertical=e.AlignBottom);case"center":return void(this.vertical=e.AlignCenter);case"stretch":return void(this.vertical=e.AlignStretch)}},e.prototype.fromString=function(e){for(var t=e.trim().split(","),r=0,n=t;r<n.length;r++){var i=n[r];i=i.toLocaleLowerCase().trim();var o=i.indexOf("h:");o===-1&&(o=i.indexOf("horizontal:")),o===-1?(o=i.indexOf("v:"),o===-1&&(o=i.indexOf("vertical:")),o===-1||(i=i.substr(i.indexOf(":")+1),this.setVertical(i))):(i=i.substr(i.indexOf(":")+1),this.setHorizontal(i))}},e._AlignLeft=1,e._AlignTop=1,e._AlignRight=2,e._AlignBottom=2,e._AlignCenter=3,e._AlignStretch=4,e})();e.PrimitiveAlignment=i;var o=(function(){function e(e,t){this.prim=e,this.intersectionLocation=t}return e})();e.PrimitiveIntersectedInfo=o;var a=(function(){function e(t,r){this._parentAccess=t,this._changedCallback=r,this._pixels=new Array(4),this._percentages=new Array(4),this._setType(0,e.Auto),this._setType(1,e.Auto),this._setType(2,e.Auto),this._setType(3,e.Auto),this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0}return e.prototype.fromString=function(t){this._clear();var r=t.trim().split(",");if(1===r.length&&t.indexOf(":")===-1)return this._setStringValue(r[0],0,!1),this._setStringValue(r[0],1,!1),this._setStringValue(r[0],2,!1),this._setStringValue(r[0],3,!1),void this._changedCallback();for(var n=!1,i=0,o=r;i<o.length;i++){var a=o[i];n=this._extractString(a,!1)||n}if(!n)throw new Error("Can't parse the string to create a PrimitiveMargin object, format must be: 'top: <value>, left:<value>, right:<value>, bottom:<value>");0===(15&this._flags)&&(this._flags|=e.Pixel<<0),0===(240&this._flags)&&(this._flags|=e.Pixel<<4),0===(3840&this._flags)&&(this._flags|=e.Pixel<<8),0===(61440&this._flags)&&(this._flags|=e.Pixel<<12),this._changedCallback()},e.prototype.fromStrings=function(e,t,r,n){return this._clear(),this._setStringValue(e,0,!1),this._setStringValue(t,1,!1),this._setStringValue(r,2,!1),this._setStringValue(n,3,!1),this._changedCallback(),this},e.prototype.fromPixels=function(e,t,r,n){return this._clear(),this._pixels[0]=e,this._pixels[1]=t,this._pixels[2]=r,this._pixels[3]=n,this._changedCallback(),this},e.prototype.fromUniformPixels=function(e){return this._clear(),this._pixels[0]=e,this._pixels[1]=e,this._pixels[2]=e,this._pixels[3]=e,this._changedCallback(),this},e.prototype.auto=function(){return this._clear(),this._flags=e.Auto<<0|e.Auto<<4|e.Auto<<8|e.Auto<<12,this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0,this._changedCallback(),this},e.prototype._clear=function(){this._flags=0,this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0,this._percentages[0]=null,this._percentages[1]=null,this._percentages[2]=null,this._percentages[3]=null},e.prototype._extractString=function(e,t){var r=e.trim().toLocaleLowerCase();return 0===r.indexOf("top:")?(r=r.substr(4).trim(),this._setStringValue(r,0,t)):0===r.indexOf("left:")?(r=r.substr(5).trim(),this._setStringValue(r,1,t)):0===r.indexOf("right:")?(r=r.substr(6).trim(),this._setStringValue(r,2,t)):0===r.indexOf("bottom:")&&(r=r.substr(7).trim(),this._setStringValue(r,3,t))},e.prototype._setStringValue=function(t,r,n){var i=t.trim().toLocaleLowerCase();if("auto"===i){if(this._isType(r,e.Auto))return!0;this._setType(r,e.Auto),this._pixels[r]=0,n&&this._changedCallback()}else{if("inherit"!==i){var o=i.indexOf("%");if(o!==-1){var a=i.substr(0,o),s=Math.round(Number(a))/100;return!(!this._isType(r,e.Percentage)||this._percentages[r]!==s)||(this._setType(r,e.Percentage),!isNaN(s)&&(this._percentages[r]=s,n&&this._changedCallback(),!0))}var l=void 0;o=i.indexOf("px"),l=o!==-1?i.substr(0,o).trim():i;var u=Number(l);return!(!this._isType(r,e.Pixel)||this._pixels[r]!==u)||!isNaN(u)&&(this._pixels[r]=u,this._setType(r,e.Pixel),n&&this._changedCallback(),!0)}if(this._isType(r,e.Inherit))return!0;this._setType(r,e.Inherit),this._pixels[r]=null,n&&this._changedCallback()}},e.prototype._setPixels=function(t,r,n){t=Math.round(t),this._isType(r,e.Pixel)&&this._pixels[r]===t||(this._setType(r,e.Pixel),this._pixels[r]=t,n&&this._changedCallback())},e.prototype._setPercentage=function(t,r,n){t=Math.min(1,t),t=Math.max(0,t),t=Math.round(100*t)/100,this._isType(r,e.Percentage)&&this._percentages[r]===t||(this._setType(r,e.Percentage),this._percentages[r]=t,n&&this._changedCallback())},e.prototype._getStringValue=function(t){var r=this._flags>>4*t&15;switch(r){case e.Auto:return"auto";case e.Pixel:return this._pixels[t]+"px";case e.Percentage:return 100*this._percentages[t]+"%";case e.Inherit:return"inherit"}return""},e.prototype._isType=function(e,t){var r=this._flags>>4*e&15;return r===t},e.prototype._getType=function(t,r){var n=this._flags>>4*t&15;if(r&&n===e.Inherit){var i=this._parentAccess();return i?i._getType(t,!0):e.Auto}return n},e.prototype._setType=function(e,t){this._flags&=~(15<<4*e),this._flags|=t<<4*e},e.prototype.setTop=function(e){"string"==typeof e?this._setStringValue(e,0,!0):this.topPixels=e},e.prototype.setLeft=function(e){"string"==typeof e?this._setStringValue(e,1,!0):this.leftPixels=e},e.prototype.setRight=function(e){"string"==typeof e?this._setStringValue(e,2,!0):this.rightPixels=e},e.prototype.setBottom=function(e){"string"==typeof e?this._setStringValue(e,3,!0):this.bottomPixels=e},Object.defineProperty(e.prototype,"top",{get:function(){return this._getStringValue(0)},set:function(e){this._setStringValue(e,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._getStringValue(1)},set:function(e){this._setStringValue(e,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._getStringValue(2)},set:function(e){this._setStringValue(e,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this._getStringValue(3)},set:function(e){this._setStringValue(e,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topPixels",{get:function(){return this._pixels[0]},set:function(e){this._setPixels(e,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPixels",{get:function(){return this._pixels[1]},set:function(e){this._setPixels(e,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPixels",{get:function(){return this._pixels[2]},set:function(e){this._setPixels(e,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomPixels",{get:function(){return this._pixels[3]},set:function(e){this._setPixels(e,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topPercentage",{get:function(){return this._percentages[0]},set:function(e){this._setPercentage(e,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPercentage",{get:function(){return this._percentages[1]},set:function(e){this._setPercentage(e,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPercentage",{get:function(){return this._percentages[2]},set:function(e){this._setPercentage(e,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomPercentage",{get:function(){return this._percentages[3]},set:function(e){this._setPercentage(e,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topMode",{get:function(){return this._getType(0,!1)},set:function(e){this._setType(0,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftMode",{get:function(){return this._getType(1,!1)},set:function(e){this._setType(1,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightMode",{get:function(){return this._getType(2,!1)},set:function(e){this._setType(2,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomMode",{get:function(){return this._getType(3,!1)},set:function(e){this._setType(3,e)},enumerable:!0,configurable:!0}),e.prototype._computePixels=function(t,r,n){var i=this._getType(t,!1);if(i===e.Inherit)return void this._parentAccess()._computePixels(t,r,n);if(i===e.Percentage){var o=(0===t||3===t?r.height:r.width)*this._percentages[t];this._pixels[t]=o,n&&this._changedCallback()}},e.prototype.computeWithAlignment=function(t,r,n,o,a,s){void 0===s&&(s=!1);var l=this._getType(0,!0),u=this._getType(1,!0),c=this._getType(2,!0),h=this._getType(3,!0),d=r&&null!=r.width,p=r&&null!=r.height,f=d?r.width:0,_=p?r.height:0,g=l===e.Auto,y=u===e.Auto,P=c===e.Auto,b=h===e.Auto;switch(n.horizontal){case i.AlignLeft:y?o.x=0:(this._computePixels(1,t,!0),o.x=this.leftPixels),a.width=f,s&&(a.width+=this.leftPixels);break;case i.AlignRight:P?o.x=Math.round(t.width-f):(this._computePixels(2,t,!0),o.x=Math.round(t.width-(f+this.rightPixels))),a.width=f,s&&(a.width+=this.rightPixels);break;case i.AlignStretch:y?o.x=0:(this._computePixels(1,t,!0),o.x=this.leftPixels);var v=0;P||(this._computePixels(2,t,!0),v=this.rightPixels),a.width=t.width-(o.x+v);break;case i.AlignCenter:y||this._computePixels(1,t,!0),P||this._computePixels(2,t,!0);var m=(y?0:this.leftPixels)-(P?0:this.rightPixels);o.x=Math.round((t.width-f)/2+m),a.width=f}switch(n.vertical){case i.AlignTop:g?o.y=t.height-_:(this._computePixels(0,t,!0),o.y=Math.round(t.height-(_+this.topPixels))),a.height=_,s&&(a.height+=this.topPixels);break;case i.AlignBottom:b?o.y=0:(this._computePixels(3,t,!0),o.y=this.bottomPixels),a.height=_,s&&(a.height+=this.bottomPixels);break;case i.AlignStretch:b?o.y=0:(this._computePixels(3,t,!0),o.y=this.bottomPixels);var C=0;g||(this._computePixels(0,t,!0),C=this.topPixels),a.height=t.height-(o.y+C);break;case i.AlignCenter:g||this._computePixels(0,t,!0),b||this._computePixels(3,t,!0);var m=(b?0:this.bottomPixels)-(g?0:this.topPixels);o.y=Math.round((t.height-_)/2+m),a.height=_}},e.prototype.compute=function(e,t,r){this._computePixels(0,e,!0),this._computePixels(1,e,!0),this._computePixels(2,e,!0),this._computePixels(3,e,!0),t.x=this.leftPixels,r.width=e.width-(t.x+this.rightPixels),t.y=this.bottomPixels,r.height=e.height-(t.y+this.topPixels)},e.prototype.computeArea=function(e,t){this._computePixels(0,e,!0),
this._computePixels(1,e,!0),this._computePixels(2,e,!0),this._computePixels(3,e,!0),t.width=this.leftPixels+e.width+this.rightPixels,t.height=this.bottomPixels+e.height+this.topPixels},e.prototype.enlarge=function(e,t,r){this._computePixels(0,e,!0),this._computePixels(1,e,!0),this._computePixels(2,e,!0),this._computePixels(3,e,!0),t.x=this.leftPixels,r.width=e.width+(t.x+this.rightPixels),t.y=this.bottomPixels,r.height=e.height+(t.y+this.topPixels)},e.Auto=1,e.Inherit=2,e.Percentage=4,e.Pixel=8,e})();e.PrimitiveThickness=a;var s=(function(){function t(){this.findFirstOnly=!1,this.intersectHidden=!1,this.pickPosition=e.Vector2.Zero()}return Object.defineProperty(t.prototype,"isIntersected",{get:function(){return this.intersectedPrimitives&&this.intersectedPrimitives.length>0},enumerable:!0,configurable:!0}),t.prototype.isPrimIntersected=function(e){for(var t=0,r=this.intersectedPrimitives;t<r.length;t++){var n=r[t];if(n.prim===e)return n.intersectionLocation}return null},t.prototype._exit=function(e){e&&(this._globalPickPosition=null)},t})();e.IntersectInfo2D=s;var l=(function(t){function r(n){null==n&&(n={}),t.call(this);var i,o;if(r._isCanvasInit)i=this,o=null,this._canvasPreInit(n);else if(null!=n.parent){if(o=n.parent,i=n.parent.owner,!i)throw new Error("Parent "+o.id+" of "+n.id+" doesn't have a valid owner!");if(!(this instanceof e.Group2D||this instanceof e.Sprite2D&&null!=n.id&&0===n.id.indexOf("__cachedSpriteOfGroup__")||i.cachingStrategy!==e.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS||o!==i))throw new Error("Can't create a primitive with the canvas as direct parent when the caching strategy is TOPLEVELGROUPS. You need to create a Group below the canvas and use it as the parent for the primitive")}this._layoutEngine=e.CanvasLayoutEngine.Singleton,this._size=null,this._scale=new e.Vector2(1,1),this._actualSize=null,this._boundingSize=e.Size.Zero(),this._layoutArea=e.Size.Zero(),this._layoutAreaPos=null,this._layoutBoundingInfo=null,this._marginOffset=e.Vector2.Zero(),this._paddingOffset=e.Vector2.Zero(),this._parentPaddingOffset=e.Vector2.Zero(),this._parentContentArea=e.Size.Zero(),this._lastAutoSizeArea=e.Size.Zero(),this._contentArea=new e.Size(null,null),this._pointerEventObservable=new e.Observable,this._boundingInfo=new e.BoundingInfo2D,this._owner=i,this._parent=null,this._margin=null,this._padding=null,this._marginAlignment=null,this._id=n.id,this.propertyChanged=new e.Observable,this._children=new Array,this._localTransform=new e.Matrix,this._globalTransform=null,this._invGlobalTransform=null,this._globalTransformProcessStep=0,this._globalTransformStep=0,this._renderGroup=null,this._primLinearPosition=0,this._manualZOrder=null,this._zOrder=0,this._zMax=0,this._firstZDirtyIndex=r._bigInt,this._actualOpacity=0,this._actualScale=e.Vector2.Zero();var a=!0,s=!0;if(void 0!==n.isPickable&&(a=n.isPickable),void 0!==n.isContainer&&(s=n.isContainer),n.dontInheritParentScale&&this._setFlags(e.SmartPropertyPrim.flagDontInheritParentScale),this._setFlags((a?e.SmartPropertyPrim.flagIsPickable:0)|e.SmartPropertyPrim.flagBoundingInfoDirty|e.SmartPropertyPrim.flagActualOpacityDirty|(s?e.SmartPropertyPrim.flagIsContainer:0)|e.SmartPropertyPrim.flagActualScaleDirty|e.SmartPropertyPrim.flagLayoutBoundingInfoDirty),null!=n.opacity?this._opacity=n.opacity:this._opacity=1,this._updateRenderMode(),n.childrenFlatZOrder&&this._setFlags(e.SmartPropertyPrim.flagChildrenFlatZOrder),null!=o&&(o.addChild(this),this._hierarchyDepth=o._hierarchyDepth+1,this._patchHierarchy(o.owner)),this.owner&&this instanceof e.Group2D){var l=this;l.detectGroupStates()}if(null!=n.children)for(var u=0,c=n.children;u<c.length;u++){var h=c[u];this.addChild(h),null!=this.owner&&h._patchHierarchy(this.owner)}if(null!=n.zOrder&&(this.zOrder=n.zOrder),null!=n.position?this.position=n.position:null!=n.x||null!=n.y?this.position=new e.Vector2(n.x||0,n.y||0):this._position=null,this.rotation=null==n.rotation?0:n.rotation,null!=n.scale?this.scale=n.scale:(null!=n.scaleX&&(this.scaleX=n.scaleX),null!=n.scaleY&&(this.scaleY=n.scaleY)),this.levelVisible=null==n.isVisible||n.isVisible,this.origin=n.origin||new e.Vector2(.5,.5),null!=n.layoutEngine)if("string"==typeof n.layoutEngine){var d=n.layoutEngine.toLocaleLowerCase().trim();"canvas"===d||"canvaslayoutengine"===d?this.layoutEngine=e.CanvasLayoutEngine.Singleton:0===d.indexOf("stackpanel")||0===d.indexOf("horizontalstackpanel")?this.layoutEngine=e.StackPanelLayoutEngine.Horizontal:0===d.indexOf("verticalstackpanel")&&(this.layoutEngine=e.StackPanelLayoutEngine.Vertical)}else n.layoutEngine instanceof e.LayoutEngineBase&&(this.layoutEngine=n.layoutEngine);n.marginTop&&this.margin.setTop(n.marginTop),n.marginLeft&&this.margin.setLeft(n.marginLeft),n.marginRight&&this.margin.setRight(n.marginRight),n.marginBottom&&this.margin.setBottom(n.marginBottom),n.margin&&("string"==typeof n.margin?this.margin.fromString(n.margin):this.margin.fromUniformPixels(n.margin)),n.marginHAlignment&&(this.marginAlignment.horizontal=n.marginHAlignment),n.marginVAlignment&&(this.marginAlignment.vertical=n.marginVAlignment),n.marginAlignment&&this.marginAlignment.fromString(n.marginAlignment),n.paddingTop&&this.padding.setTop(n.paddingTop),n.paddingLeft&&this.padding.setLeft(n.paddingLeft),n.paddingRight&&this.padding.setRight(n.paddingRight),n.paddingBottom&&this.padding.setBottom(n.paddingBottom),n.padding&&this.padding.fromString(n.padding),this._parentLayoutDirty(),this._positioningDirty()}return __extends(r,t),Object.defineProperty(r.prototype,"actionManager",{get:function(){return this._actionManager||(this._actionManager=new e.ActionManager(this.owner.scene)),this._actionManager},enumerable:!0,configurable:!0}),r.prototype.traverseUp=function(e){for(var t=this;null!=t;){if(e(t))return t;t=t._parent}return null},Object.defineProperty(r.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualPosition",{get:function(){return null!=this._actualPosition?this._actualPosition:null!=this._position?this._position:r._nullPosition},set:function(e){this._actualPosition=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualX",{get:function(){return this.actualPosition.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualY",{get:function(){return this.actualPosition.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"position",{get:function(){return this._position||r._nullPosition},set:function(e){this._checkPositionChange()&&(this._position=e,this._triggerPropertyChanged(r.actualPositionProperty,e))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"x",{get:function(){return this._position?this._position.x:null},set:function(t){this._checkPositionChange()&&(this._position||(this._position=e.Vector2.Zero()),this._position.x!==t&&(this._position.x=t,this._triggerPropertyChanged(r.positionProperty,t),this._triggerPropertyChanged(r.actualPositionProperty,t)))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._position?this._position.y:null},set:function(t){this._checkPositionChange()&&(this._position||(this._position=e.Vector2.Zero()),this._position.y!==t&&(this._position.y=t,this._triggerPropertyChanged(r.positionProperty,t),this._triggerPropertyChanged(r.actualPositionProperty,t)))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){if(!this._size||null==this._size.width||null==this._size.height){if(r.boundinbBoxReentrency)return r.nullSize;if(!this._isFlagSet(e.SmartPropertyPrim.flagBoundingInfoDirty))return this._boundingSize;r.boundinbBoxReentrency=!0;this.boundingInfo;return r.boundinbBoxReentrency=!1,this._boundingSize}return this._size},set:function(e){this._size=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this.size?this.size.width:null},set:function(t){return this.size?void(this.size.width!==t&&(this.size.width=t,this._triggerPropertyChanged(r.sizeProperty,t),this._positioningDirty())):void(this.size=new e.Size(t,0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.size?this.size.height:null},set:function(t){return this.size?void(this.size.height!==t&&(this.size.height=t,this._triggerPropertyChanged(r.sizeProperty,t),this._positioningDirty())):void(this.size=new e.Size(0,t))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale",{get:function(){return this._scale.x},set:function(t){this._scale.x=this._scale.y=t,this._setFlags(e.SmartPropertyPrim.flagActualScaleDirty),this._spreadActualScaleDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this._size},set:function(e){this._actualSize.equals(e)||(this._actualSize=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualZOffset",{get:function(){return null!=this._manualZOrder?this._manualZOrder:(this._isFlagSet(e.SmartPropertyPrim.flagZOrderDirty)&&this._updateZOrder(),1-this._zOrder)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minSize",{get:function(){return this._minSize},set:function(e){this._minSize&&e&&this._minSize.equals(e)||(this._minSize=e,this._parentLayoutDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxSize",{get:function(){return this._maxSize},set:function(e){this._maxSize&&e&&this._maxSize.equals(e)||(this._maxSize=e,this._parentLayoutDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"origin",{get:function(){return this._origin},set:function(e){this._origin=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"levelVisible",{get:function(){return this._isFlagSet(e.SmartPropertyPrim.flagLevelVisible)},set:function(t){this._changeFlags(e.SmartPropertyPrim.flagLevelVisible,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isVisible",{get:function(){return this._isFlagSet(e.SmartPropertyPrim.flagIsVisible)},set:function(t){this._changeFlags(e.SmartPropertyPrim.flagIsVisible,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"zOrder",{get:function(){return this._manualZOrder},set:function(e){this._manualZOrder!==e&&(this._manualZOrder=e,this.onZOrderChanged(),this._actualZOrderChangedObservable&&this._actualZOrderChangedObservable.hasObservers()&&this._actualZOrderChangedObservable.notifyObservers(e))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isManualZOrder",{get:function(){return null!=this._manualZOrder},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"margin",{get:function(){var e=this;return this._margin||(this._margin=new a(function(){return e.parent?e.parent.margin:null},function(){return e._positioningDirty()})),this._margin},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"_hasMargin",{get:function(){return null!==this._margin||null!==this._marginAlignment},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"padding",{get:function(){var e=this;return this._padding||(this._padding=new a(function(){return e.parent?e.parent.padding:null},function(){return e._positioningDirty()})),this._padding},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"_hasPadding",{get:function(){return null!==this._padding},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginAlignment",{get:function(){var e=this;return this._marginAlignment||(this._marginAlignment=new i(function(){return e._positioningDirty()})),this._marginAlignment},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"opacity",{get:function(){return this._opacity},set:function(t){t<0?t=0:t>1&&(t=1),this._opacity!==t&&(this._opacity=t,this._setFlags(e.SmartPropertyPrim.flagActualOpacityDirty),this._spreadActualOpacityChanged(),this._updateRenderMode())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleX",{get:function(){return this._scale.x},set:function(t){this._scale.x=t,this._setFlags(e.SmartPropertyPrim.flagActualScaleDirty),this._spreadActualScaleDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleY",{get:function(){return this._scale.y},set:function(t){this._scale.y=t,this._setFlags(e.SmartPropertyPrim.flagActualScaleDirty),this._spreadActualScaleDirty()},enumerable:!0,configurable:!0}),r.prototype._spreadActualScaleDirty=function(){for(var t=0,r=this._children;t<r.length;t++){var n=r[t];n._setFlags(e.SmartPropertyPrim.flagActualScaleDirty),n._spreadActualScaleDirty()}},Object.defineProperty(r.prototype,"actualScale",{get:function(){if(this._isFlagSet(e.SmartPropertyPrim.flagActualScaleDirty)){for(var t=this._isFlagSet(e.SmartPropertyPrim.flagDontInheritParentScale)?null:this.parent,r=this.scaleX,n=this.scaleY;t;)r*=t.scaleX,n*=t.scaleY,t=t._isFlagSet(e.SmartPropertyPrim.flagDontInheritParentScale)?null:t.parent;this._actualScale.copyFromFloats(r,n),this._clearFlags(e.SmartPropertyPrim.flagActualScaleDirty)}return this._actualScale},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualScaleX",{get:function(){return this.actualScale.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualScaleY",{get:function(){return this.actualScale.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualOpacity",{get:function(){if(this._isFlagSet(e.SmartPropertyPrim.flagActualOpacityDirty)){for(var t=this.parent,r=this.opacity;t;)r*=t.opacity,t=t.parent;this._actualOpacity=r,this._clearFlags(e.SmartPropertyPrim.flagActualOpacityDirty)}return this._actualOpacity},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layoutEngine",{get:function(){return this._layoutEngine||(this._layoutEngine=e.CanvasLayoutEngine.Singleton),this._layoutEngine},set:function(e){this._layoutEngine!==e&&this._changeLayoutEngine(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layoutArea",{get:function(){return this._layoutArea},set:function(t){this._layoutArea.equals(t)||(this._positioningDirty(),this.parent&&this.parent._setFlags(e.SmartPropertyPrim.flagLayoutBoundingInfoDirty),this._layoutArea=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layoutAreaPos",{get:function(){return this._layoutAreaPos||r._nullPosition},set:function(t){this._layoutAreaPos&&this._layoutAreaPos.equals(t)||(this.parent&&this.parent._setFlags(e.SmartPropertyPrim.flagLayoutBoundingInfoDirty),this._positioningDirty(),this._layoutAreaPos=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPickable",{get:function(){return this._isFlagSet(e.SmartPropertyPrim.flagIsPickable)},set:function(t){this._changeFlags(e.SmartPropertyPrim.flagIsPickable,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isContainer",{get:function(){return this._isFlagSet(e.SmartPropertyPrim.flagIsContainer)},set:function(t){this._changeFlags(e.SmartPropertyPrim.flagIsContainer,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hierarchyDepth",{get:function(){return this._hierarchyDepth},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"renderGroup",{get:function(){return this._renderGroup},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalTransform",{get:function(){return this._updateLocalTransform(),this._globalTransform},enumerable:!0,configurable:!0}),r.prototype.getGlobalPosition=function(){var t=new e.Vector2(0,0);return this.getGlobalPositionByRef(t),t},r.prototype.getGlobalPositionByRef=function(e){e.x=this.globalTransform.m[12],e.y=this.globalTransform.m[13]},Object.defineProperty(r.prototype,"invGlobalTransform",{get:function(){return this._updateLocalTransform(),this._invGlobalTransform},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"localTransform",{get:function(){return this._updateLocalTransform(),this._localTransform},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"boundingInfo",{get:function(){if(this._isFlagSet(e.SmartPropertyPrim.flagBoundingInfoDirty)){this.owner&&this.owner.boundingInfoRecomputeCounter.addCount(1,!1),this.isSizedByContent?this._boundingInfo.clear():this._boundingInfo.copyFrom(this.levelBoundingInfo);for(var t=this._boundingInfo,n=new e.BoundingInfo2D,i=0,o=this._children;i<o.length;i++){var a=o[i],s=a.boundingInfo;s.transformToRef(a.localTransform,n),t.unionToRef(n,t)}this._boundingInfo.maxToRef(r._bMax),this._boundingSize.copyFromFloats(this._size&&null!=this._size.width?this._size.width:Math.ceil(r._bMax.x),this._size&&null!=this._size.height?this._size.height:Math.ceil(r._bMax.y)),this._clearFlags(e.SmartPropertyPrim.flagBoundingInfoDirty)}return this._boundingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layoutBoundingInfo",{get:function(){if(this._isFlagSet(e.SmartPropertyPrim.flagLayoutBoundingInfoDirty)){this._layoutBoundingInfo||(this._layoutBoundingInfo=new e.BoundingInfo2D),this.isSizedByContent?this._layoutBoundingInfo.clear():this._layoutBoundingInfo.copyFrom(this.levelBoundingInfo);for(var t=this._layoutBoundingInfo,n=new e.BoundingInfo2D,i=0,o=this._children;i<o.length;i++){var a=o[i],s=void 0;if(a._layoutAreaPos){var l=a._layoutArea;e.BoundingInfo2D.CreateFromMinMaxToRef(0,l.width,0,l.height,r._tpsBB),s=r._tpsBB}else s=a.boundingInfo;s.transformToRef(a.localTransform,n),t.unionToRef(n,t)}this._clearFlags(e.SmartPropertyPrim.flagLayoutBoundingInfoDirty)}return this._layoutBoundingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isSizeAuto",{get:function(){return null==this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isSizedByContent",{get:function(){return null==this._size&&this._children.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPositionAuto",{get:function(){return null==this._position},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointerEventObservable",{get:function(){return this._pointerEventObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"zActualOrderChangedObservable",{get:function(){return this._actualZOrderChangedObservable||(this._actualZOrderChangedObservable=new e.Observable),this._actualZOrderChangedObservable},enumerable:!0,configurable:!0}),r.prototype.findById=function(e){if(this._id===e)return this;for(var t=0,r=this._children;t<r.length;t++){var n=r[t],i=n.findById(e);if(null!=i)return i}},r.prototype.onZOrderChanged=function(){},r.prototype.levelIntersect=function(e){return!1},r.prototype.setPointerEventCapture=function(e){return this.owner._setPointerCapture(e,this)},r.prototype.releasePointerEventsCapture=function(e){return this.owner._releasePointerCapture(e,this)},r.prototype.intersect=function(t){if(!t)return!1;var r=!t._globalPickPosition;if(r&&(t._globalPickPosition=e.Vector2.Zero(),e.Vector2.TransformToRef(t.pickPosition,this.globalTransform,t._globalPickPosition),t._localPickPosition=t.pickPosition.clone(),t.intersectedPrimitives=new Array,t.topMostIntersectedPrimitive=null),!t.intersectHidden&&!this.isVisible)return!1;var n=this.id;if(null!=n&&0===n.indexOf("__cachedSpriteOfGroup__")){var i=this.getExternalData("__cachedGroup__");return i.intersect(t)}var a=!1;if(this instanceof e.Group2D){var s=this;a=s.isCachedGroup}if(a&&!this.levelBoundingInfo.doesIntersect(t._localPickPosition))return t._exit(r),!1;if(this.isPickable&&!this.boundingInfo.doesIntersect(t._localPickPosition))return t._exit(r),!1;var l=!1;if(this.isPickable&&(l=this.levelIntersect(t))){var u=new o(this,t._localPickPosition.clone());if(t.intersectedPrimitives.push(u),(!t.topMostIntersectedPrimitive||t.topMostIntersectedPrimitive.prim.actualZOffset>u.prim.actualZOffset)&&(t.topMostIntersectedPrimitive=u),t.findFirstOnly)return t._exit(r),!0}if(!l||!t.findFirstOnly)for(var c=0,h=this._children;c<h.length;c++){var d=h[c];if((d.isPickable||!d.isContainer)&&(t.intersectHidden||d.isVisible)&&(e.Vector2.TransformToRef(t._globalPickPosition,d.invGlobalTransform,t._localPickPosition),d.intersect(t)&&t.findFirstOnly))return t._exit(r),!0}return t._exit(r),t.isIntersected},r.prototype.moveChild=function(t,r){if(t.parent!==this)return!1;var n=this._children.indexOf(t),i=r?this._children.indexOf(r):-1;return this._isFlagSet(e.SmartPropertyPrim.flagChildrenFlatZOrder)||(this._setFlags(e.SmartPropertyPrim.flagZOrderDirty),this._firstZDirtyIndex=Math.min(this._firstZDirtyIndex,i+1)),this._children.splice(i+1,0,this._children.splice(n,1)[0]),!0},r.prototype.moveChildToTop=function(e){return this.moveChild(e,this._children[this._children.length-1])},r.prototype.moveChildToBottom=function(e){return this.moveChild(e,null)},r.prototype.moveToTop=function(){return null!=this.parent&&this.parent.moveChildToTop(this)},r.prototype.moveToBottom=function(){return null!=this.parent&&this.parent.moveChildToBottom(this)},r.prototype.addChild=function(t){t._parent=this,this._boundingBoxDirty();var r=this._isFlagSet(e.SmartPropertyPrim.flagChildrenFlatZOrder);r?(t._setFlags(e.SmartPropertyPrim.flagChildrenFlatZOrder),t._setZOrder(this._zOrder,!0),t._zMax=this._zOrder):this._setFlags(e.SmartPropertyPrim.flagZOrderDirty);var n=this._children.push(t);this._firstZDirtyIndex=Math.min(this._firstZDirtyIndex,n-1)},r.prototype.dispose=function(){if(!t.prototype.dispose.call(this))return!1;if(this._actionManager&&(this._actionManager.dispose(),this._actionManager=null),this._parent){if(this instanceof e.Group2D){var r=this;if(r.isRenderableGroup){var n=this.parent.traverseUp((function(t){return t instanceof e.Group2D&&t.isRenderableGroup}));if(null!=n){var i=n._renderableData._childrenRenderableGroups,o=i.indexOf(r);o!==-1&&i.splice(o,1)}}}var a=this._parent._children.indexOf(this);void 0!==a&&this._parent._children.splice(a,1),this._parent=null}if(this._children)for(;this._children.length>0;)this._children[this._children.length-1].dispose();return!0},r.prototype.onPrimBecomesDirty=function(){this._renderGroup&&!this._isFlagSet(e.SmartPropertyPrim.flagPrimInDirtyList)&&(this._renderGroup._addPrimToDirtyList(this),this._setFlags(e.SmartPropertyPrim.flagPrimInDirtyList))},r.prototype._needPrepare=function(){return this._areSomeFlagsSet(e.SmartPropertyPrim.flagVisibilityChanged|e.SmartPropertyPrim.flagModelDirty|e.SmartPropertyPrim.flagNeedRefresh)||0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep},r.prototype._prepareRender=function(e){this._prepareRenderPre(e),this._prepareRenderPost(e)},r.prototype._prepareRenderPre=function(e){},r.prototype._prepareRenderPost=function(t){if(this instanceof e.Group2D){var n=this;if(n.isRenderableGroup)return}this._children.length>0&&(this._globalTransformProcessStep!==this._globalTransformStep||this.checkPropertiesDirty(r.isVisibleProperty.flagId))&&this._children.forEach((function(r){r instanceof e.Group2D&&r.isRenderableGroup||r._prepareRender(t)})),this._clearFlags(e.SmartPropertyPrim.flagModelDirty),this._instanceDirtyFlags=0},r.prototype._canvasPreInit=function(e){},r.CheckParent=function(e){},r.prototype.updateCachedStatesOf=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];i.updateCachedStates(t)}},r.prototype._parentLayoutDirty=function(){this._parent&&!this._parent.isDisposed&&this._parent._setLayoutDirty()},r.prototype._setLayoutDirty=function(){this.onPrimBecomesDirty(),this._setFlags(e.SmartPropertyPrim.flagLayoutDirty)},r.prototype._checkPositionChange=function(){return!this.parent||this.parent.layoutEngine.isChildPositionAllowed!==!1||(console.log("Can't manually set the position of "+this.id+", the Layout Engine of its parent doesn't allow it"),!1)},r.prototype._positioningDirty=function(){this.onPrimBecomesDirty(),this._setFlags(e.SmartPropertyPrim.flagPositioningDirty)},r.prototype._spreadActualOpacityChanged=function(){for(var t=0,r=this._children;t<r.length;t++){var n=r[t];n._setFlags(e.SmartPropertyPrim.flagActualOpacityDirty),n._updateRenderMode(),n.onPrimBecomesDirty(),n._spreadActualOpacityChanged()}},r.prototype._changeLayoutEngine=function(e){this._layoutEngine=e},r.prototype._updateLocalTransform=function(){var t=r.actualPositionProperty.flagId|r.rotationProperty.flagId|r.scaleProperty.flagId|r.scaleXProperty.flagId|r.scaleYProperty.flagId|r.originProperty.flagId;if(this.checkPropertiesDirty(t)){this.owner&&this.owner.addupdateLocalTransformCounter(1);var n,i=e.Quaternion.RotationAxis(new e.Vector3(0,0,1),this._rotation),o=this._position?this.position:this.layoutAreaPos;if(0===this._origin.x&&0===this._origin.y)n=e.Matrix.Compose(new e.Vector3(this._scale.x,this._scale.y,1),i,new e.Vector3(o.x+this._marginOffset.x,o.y+this._marginOffset.y,0)),this._localTransform=n;else{var a=this.actualSize;e.Matrix.TranslationToRef(-a.width*this._origin.x,-a.height*this._origin.y,0,r._t0),i.toRotationMatrix(r._t1),r._t0.multiplyToRef(r._t1,r._t2),e.Matrix.ScalingToRef(this._scale.x,this._scale.y,1,r._t0),r._t2.multiplyToRef(r._t0,r._t1),e.Matrix.TranslationToRef(a.width*this._origin.x+o.x+this._marginOffset.x,a.height*this._origin.y+o.y+this._marginOffset.y,0,r._t2),r._t1.multiplyToRef(r._t2,this._localTransform)}return this.clearPropertiesDirty(t),this._setFlags(e.SmartPropertyPrim.flagGlobalTransformDirty),!0}return!1},r.prototype.updateCachedStates=function(t){if(!this.isDisposed){this.owner.addCachedGroupRenderCounter(1),this._parent&&(this._parent._globalTransformProcessStep!==this.owner._globalTransformProcessStep||this._parent._areSomeFlagsSet(e.SmartPropertyPrim.flagLayoutDirty|e.SmartPropertyPrim.flagPositioningDirty|e.SmartPropertyPrim.flagZOrderDirty))&&this._parent.updateCachedStates(!1),this._isFlagSet(e.SmartPropertyPrim.flagZOrderDirty)&&this._updateZOrder();var n=this.checkPropertiesDirty(r.sizeProperty.flagId);if(!this._isFlagSet(e.SmartPropertyPrim.flagLayoutDirty)&&!this._isFlagSet(e.SmartPropertyPrim.flagPositioningDirty)&&n){var i=this.size;i&&(null!=this.size.width&&(this.actualSize.width=this.size.width),null!=this.size.height&&(this.actualSize.height=this.size.height),this.clearPropertiesDirty(r.sizeProperty.flagId))}var o=this._isFlagSet(e.SmartPropertyPrim.flagPositioningDirty),a=o&&!this._isFlagSet(e.SmartPropertyPrim.flagPositioningDirty);this._isFlagSet(e.SmartPropertyPrim.flagLayoutDirty)&&(this.owner.addUpdateLayoutCounter(1),this._layoutEngine.updateLayout(this),this._clearFlags(e.SmartPropertyPrim.flagLayoutDirty));var s=!1;if(this.isSizeAuto&&(s=this._lastAutoSizeArea?!this._lastAutoSizeArea.equals(this.actualSize):null!==this.actualSize),!a&&(s||n||this._isFlagSet(e.SmartPropertyPrim.flagPositioningDirty)||this._parent&&!this._parent.contentArea.equals(this._parentContentArea))&&(this._updatePositioning(),this._clearFlags(e.SmartPropertyPrim.flagPositioningDirty),n&&this.clearPropertiesDirty(r.sizeProperty.flagId),a=!0),a&&this._parent&&this._parentContentArea.copyFrom(this._parent.contentArea),this===this.owner||this._globalTransformProcessStep!==this.owner._globalTransformProcessStep){this.owner.addUpdateGlobalTransformCounter(1);var l=this.isVisible;this.isVisible=(!this._parent||this._parent.isVisible)&&this.levelVisible,this._changeFlags(e.SmartPropertyPrim.flagVisibilityChanged,l!==this.isVisible);var u=this._updateLocalTransform(),c=!1,h=r._v0;this._parent&&(h=this._parent._paddingOffset,c=!h.equals(this._parentPaddingOffset));var d=null!=this._parent&&this._parent._globalTransformStep!==this._parentTransformStep;if(!this._globalTransform||u||d||c||this._areSomeFlagsSet(e.SmartPropertyPrim.flagGlobalTransformDirty)){var p=this._parent?this._parent._globalTransform:null,f=void 0;r._transMtx.copyFrom(this._localTransform),r._transMtx.m[12]+=h.x,r._transMtx.m[13]+=h.y,f=r._transMtx,this._globalTransform=this._parent?f.multiply(p):f.clone(),this._invGlobalTransform=e.Matrix.Invert(this._globalTransform),this._globalTransformStep=this.owner._globalTransformProcessStep+1,this._parentTransformStep=this._parent?this._parent._globalTransformStep:0,this._clearFlags(e.SmartPropertyPrim.flagGlobalTransformDirty)}this._globalTransformProcessStep=this.owner._globalTransformProcessStep}if(t)for(var _=0,g=this._children;_<g.length;_++){var y=g[_];y.updateCachedStates(!(y instanceof e.Group2D&&y.isRenderableGroup))}}},r.prototype._updatePositioning=function(){this.owner&&this.owner.addUpdatePositioningCounter(1),this._hasMargin||null!=this.actualSize.width&&null!=this.actualSize.height||(null==this.actualSize.width&&(this.marginAlignment.horizontal=i.AlignStretch),null==this.actualSize.height&&(this.marginAlignment.vertical=i.AlignStretch)),this._hasMargin&&(this.margin.computeWithAlignment(this.layoutArea,this.size||this.actualSize,this.marginAlignment,this._marginOffset,r._size),this.actualSize=r._size.clone());var t=this.isSizeAuto;if(this._hasPadding)if(t){var n=this.size.clone();this._getActualSizeFromContentToRef(n,r._icArea),this.padding.enlarge(r._icArea,this._paddingOffset,r._size),this._contentArea.copyFrom(n),this.actualSize=r._size.clone(),this._hasMargin&&this.margin.computeWithAlignment(this.layoutArea,r._size,this.marginAlignment,this._marginOffset,r._size)}else this._getInitialContentAreaToRef(this.actualSize,r._icPos,r._icArea),r._icArea.width=Math.max(0,r._icArea.width),r._icArea.height=Math.max(0,r._icArea.height),this.padding.compute(r._icArea,this._paddingOffset,r._size),this._paddingOffset.x+=r._icPos.x,this._paddingOffset.y+=r._icPos.y,this._contentArea.copyFrom(r._size);else this._getInitialContentAreaToRef(this.actualSize,r._icPos,r._icArea),r._icArea.width=Math.max(0,r._icArea.width),r._icArea.height=Math.max(0,r._icArea.height),this._paddingOffset.copyFrom(r._icPos),this._contentArea.copyFrom(r._icArea);if(!this._position){var o=new e.Vector2(this.layoutAreaPos.x+this._marginOffset.x,this.layoutAreaPos.y+this._marginOffset.y);this.actualPosition=o}t&&(this._lastAutoSizeArea=this.actualSize)},Object.defineProperty(r.prototype,"contentArea",{get:function(){return this._isFlagSet(e.SmartPropertyPrim.flagPositioningDirty)&&(this._updatePositioning(),this._clearFlags(e.SmartPropertyPrim.flagPositioningDirty)),this._contentArea},enumerable:!0,configurable:!0}),r.prototype._patchHierarchy=function(t){if(this._owner=t,null==this._renderGroup){if(this instanceof e.Group2D){var r=this;r.detectGroupStates(),r._trackedNode&&!r._isFlagSet(e.SmartPropertyPrim.flagTrackedGroup)&&r.owner._registerTrackedNode(this)}if(this._renderGroup=this.traverseUp((function(t){return t instanceof e.Group2D&&t.isRenderableGroup})),this._parent&&this._parentLayoutDirty(),this._renderGroup&&this.isDirty){var n=this._renderGroup._renderableData._primDirtyList,i=n.indexOf(this);i===-1&&n.push(this)}for(var o=0,a=this._children;o<a.length;o++){var s=a[o];s._hierarchyDepth=this._hierarchyDepth+1,s._patchHierarchy(t)}}},r.prototype._updateZOrder=function(){var t=this._primLinearPosition,n=0,i=this._zOrder,o=this._children.length;if(this._firstZDirtyIndex>0&&this._firstZDirtyIndex-1<o){var a=this._children[this._firstZDirtyIndex-1];t=a._primLinearPosition,n=this._firstZDirtyIndex-1,i=a._zOrder}var s=t;r._totalCount=0;for(var l=n;l<o;l++){var u=this._children[l];t=u._updatePrimitiveLinearPosition(t)}var c=(this._zMax-i)/(r._totalCount*(r._zRebuildReentrency?1:1.2));if(c<e.Canvas2D._zMinDelta){if(r._zRebuildReentrency){var h=this._parent;return null==h?(console.log("Can't compute Z-Order for "+this.id+"'s children, zDelta is too small, Z-Order is now in an unstable state"),
void(r._zRebuildReentrency=!1)):(h._firstZDirtyIndex=0,h._updateZOrder())}r._zRebuildReentrency=!0,this._firstZDirtyIndex=0,this._updateZOrder(),r._zRebuildReentrency=!1}for(var l=n;l<o;l++){var u=this._children[l];u._updatePrimitiveZOrder(s,i,c)}for(var d=0,p=r._zOrderChangedNotifList;d<p.length;d++){var h=p[d];h._actualZOrderChangedObservable.notifyObservers(h.actualZOffset)}r._zOrderChangedNotifList.splice(0),this._firstZDirtyIndex=r._bigInt,this._clearFlags(e.SmartPropertyPrim.flagZOrderDirty)},r.prototype._updatePrimitiveLinearPosition=function(t){if(this.isManualZOrder)return t;if(this._primLinearPosition=++t,r._totalCount++,!this._isFlagSet(e.SmartPropertyPrim.flagChildrenFlatZOrder))for(var n=0,i=this._children;n<i.length;n++){var o=i[n];t=o._updatePrimitiveLinearPosition(t)}return t},r.prototype._updatePrimitiveZOrder=function(t,n,i){if(this.isManualZOrder)return null;var o=n+(this._primLinearPosition-t)*i,a=this._isFlagSet(e.SmartPropertyPrim.flagChildrenFlatZOrder);this._setZOrder(o,!1),this._isFlagSet(e.SmartPropertyPrim.flagZOrderDirty)&&(this._firstZDirtyIndex=r._bigInt,this._clearFlags(e.SmartPropertyPrim.flagZOrderDirty));var s=o;if(a){if(this._children.length>0)for(var l=0,u=this._children;l<u.length;l++){var c=u[l];c._updatePrimitiveFlatZOrder(this._zOrder)}}else for(var h=0,d=this._children;h<d.length;h++){var c=d[h],p=c._updatePrimitiveZOrder(t,n,i);null!=p&&(s=p)}return this._zMax=a?o:s+i,s},r.prototype._updatePrimitiveFlatZOrder=function(t){if(!this.isManualZOrder){this._setZOrder(t,!1),this._zMax=t,this._isFlagSet(e.SmartPropertyPrim.flagZOrderDirty)&&(this._firstZDirtyIndex=r._bigInt,this._clearFlags(e.SmartPropertyPrim.flagZOrderDirty));for(var n=0,i=this._children;n<i.length;n++){var o=i[n];o._updatePrimitiveFlatZOrder(t)}}},r.prototype._setZOrder=function(e,t){e!==this._zOrder&&(this._zOrder=e,this.onPrimBecomesDirty(),this.onZOrderChanged(),this._actualZOrderChangedObservable&&this._actualZOrderChangedObservable.hasObservers()&&(t?this._actualZOrderChangedObservable.notifyObservers(e):r._zOrderChangedNotifList.push(this)))},r.prototype._updateRenderMode=function(){},r.prototype._getInitialContentAreaToRef=function(e,t,r){r.copyFrom(e),t.x=t.y=0},r.prototype._getActualSizeFromContentToRef=function(e,t){t.copyFrom(e)},r.PRIM2DBASE_PROPCOUNT=16,r._bigInt=Math.pow(2,30),r._nullPosition=e.Vector2.Zero(),r.boundinbBoxReentrency=!1,r.nullSize=e.Size.Zero(),r._bMax=e.Vector2.Zero(),r._tpsBB=new e.BoundingInfo2D,r._isCanvasInit=!1,r._t0=new e.Matrix,r._t1=new e.Matrix,r._t2=new e.Matrix,r._v0=e.Vector2.Zero(),r._transMtx=e.Matrix.Zero(),r._icPos=e.Vector2.Zero(),r._icArea=e.Size.Zero(),r._size=e.Size.Zero(),r._zOrderChangedNotifList=new Array,r._zRebuildReentrency=!1,r._totalCount=0,__decorate([e.instanceLevelProperty(1,(function(e){return r.actualPositionProperty=e}),!1,!1,!0)],r.prototype,"actualPosition",null),__decorate([e.dynamicLevelProperty(2,(function(e){return r.positionProperty=e}),!1,!1,!0)],r.prototype,"position",null),__decorate([e.dynamicLevelProperty(3,(function(e){return r.sizeProperty=e}),!1,!0)],r.prototype,"size",null),__decorate([e.instanceLevelProperty(4,(function(e){return r.rotationProperty=e}),!1,!0)],r.prototype,"rotation",null),__decorate([e.instanceLevelProperty(5,(function(e){return r.scaleProperty=e}),!1,!0)],r.prototype,"scale",null),__decorate([e.dynamicLevelProperty(6,(function(e){return r.originProperty=e}),!1,!0)],r.prototype,"origin",null),__decorate([e.dynamicLevelProperty(7,(function(e){return r.levelVisibleProperty=e}))],r.prototype,"levelVisible",null),__decorate([e.instanceLevelProperty(8,(function(e){return r.isVisibleProperty=e}))],r.prototype,"isVisible",null),__decorate([e.instanceLevelProperty(9,(function(e){return r.zOrderProperty=e}))],r.prototype,"zOrder",null),__decorate([e.dynamicLevelProperty(10,(function(e){return r.marginProperty=e}))],r.prototype,"margin",null),__decorate([e.dynamicLevelProperty(11,(function(e){return r.paddingProperty=e}))],r.prototype,"padding",null),__decorate([e.dynamicLevelProperty(12,(function(e){return r.marginAlignmentProperty=e}))],r.prototype,"marginAlignment",null),__decorate([e.instanceLevelProperty(13,(function(e){return r.opacityProperty=e}))],r.prototype,"opacity",null),__decorate([e.instanceLevelProperty(14,(function(e){return r.scaleXProperty=e}),!1,!0)],r.prototype,"scaleX",null),__decorate([e.instanceLevelProperty(15,(function(e){return r.scaleYProperty=e}),!1,!0)],r.prototype,"scaleY",null),r=__decorate([e.className("Prim2DBase")],r)})(e.SmartPropertyPrim);e.Prim2DBase=l})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(){function t(t,r,n){this._partCount=n,this.owner=t,this.modelRenderCache=r,this.modelRenderCache.addRef(),this.partIndexFromId=new e.StringDictionary,this._usedShaderCategories=new Array(n),this._strides=new Array(n),this._opaqueData=null,this._alphaTestData=null,this._transparentData=null,this.opaqueDirty=this.alphaTestDirty=this.transparentDirty=this.transparentOrderDirty=!1}return t.prototype.dispose=function(){if(this._isDisposed)return!1;this.modelRenderCache&&(this.modelRenderCache.dispose(),this.modelRenderCache=null);var e=this.owner.owner.engine;return this._opaqueData&&(this._opaqueData.forEach((function(t){return t.dispose(e)})),this._opaqueData=null),this._alphaTestData&&(this._alphaTestData.forEach((function(t){return t.dispose(e)})),this._alphaTestData=null),this._transparentData&&(this._transparentData.forEach((function(t){return t.dispose(e)})),this._transparentData=null),this.partIndexFromId=null,this._isDisposed=!0,!0},Object.defineProperty(t.prototype,"hasOpaqueData",{get:function(){return null!=this._opaqueData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasAlphaTestData",{get:function(){return null!=this._alphaTestData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasTransparentData",{get:function(){return null!=this._transparentData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"opaqueData",{get:function(){if(!this._opaqueData){this._opaqueData=new Array(this._partCount);for(var e=0;e<this._partCount;e++)this._opaqueData[e]=new n(this._strides[e])}return this._opaqueData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaTestData",{get:function(){if(!this._alphaTestData){this._alphaTestData=new Array(this._partCount);for(var e=0;e<this._partCount;e++)this._alphaTestData[e]=new n(this._strides[e])}return this._alphaTestData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transparentData",{get:function(){if(!this._transparentData){this._transparentData=new Array(this._partCount);for(var e=0;e<this._partCount;e++){var t=this.modelRenderCache._partData[e]._zBiasOffset;this._transparentData[e]=new i(this._strides[e],t)}}return this._transparentData},enumerable:!0,configurable:!0}),t.prototype.sortTransparentData=function(){if(this.transparentOrderDirty){for(var e=0;e<this._transparentData.length;e++){var t=this._transparentData[e];t._partData.sort()}this.transparentOrderDirty=!1}},Object.defineProperty(t.prototype,"usedShaderCategories",{get:function(){return this._usedShaderCategories},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strides",{get:function(){return this._strides},enumerable:!0,configurable:!0}),t})();e.GroupInstanceInfo=t;var r=(function(){function t(){this.groupInsanceInfo=null,this.startZ=0,this.endZ=0,this.startDataIndex=e.Prim2DBase._bigInt,this.endDataIndex=0,this.partBuffers=null}return t.prototype.dispose=function(e){this.partBuffers&&(this.partBuffers.forEach((function(t){return e._releaseBuffer(t)})),this.partBuffers.splice(0),this.partBuffers=null)},t})();e.TransparentSegment=r;var n=(function(){function t(t){this._partData=null,this._partBuffer=null,this._partBufferSize=0,this._partData=new e.DynamicFloatArray(t/4,50),this._isDisposed=!1}return t.prototype.dispose=function(e){return!this._isDisposed&&(this._partBuffer&&(e._releaseBuffer(this._partBuffer),this._partBuffer=null),this._partData=null,void(this._isDisposed=!0))},t})();e.GroupInfoPartData=n;var i=(function(e){function t(t,r){e.call(this,t),this._partData.compareValueOffset=r,this._partData.sortingAscending=!1}return __extends(t,e),t})(n);e.TransparentGroupInfoPartData=i;var o=(function(){function t(e,t){this._engine=e,this._modelKey=t,this._nextKey=1,this._refCounter=1,this._partData=null}return t.prototype.dispose=function(){if(0!==--this._refCounter)return!1;var e=this._engine.getExternalData("__BJSCANVAS2D__");return e&&e.DisposeModelRenderCache(this),!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._refCounter<=0},enumerable:!0,configurable:!0}),t.prototype.addRef=function(){return++this._refCounter},Object.defineProperty(t.prototype,"modelKey",{get:function(){return this._modelKey},enumerable:!0,configurable:!0}),t.prototype.render=function(e,t){return!0},t.prototype.getPartIndexFromId=function(e){for(var t=0;t<this._partData.length;t++)if(this._partData[t]._partId===e)return t;return null},t.prototype.loadInstancingAttributes=function(e,t){var r=this.getPartIndexFromId(e);if(null===r)return null;var n=this._partsClassInfo[r],i=this._partData[r]._partUsedCategories,o=n.classContent.getInstancingAttributeInfos(t,i);return o},t.prototype.setupUniforms=function(e,r,n,i){var o=this._partData[r],a=o._partDataStride/4*i,s=this._partsClassInfo[r];s.fullContent.forEach((function(r,i){if(!i.category||o._partUsedCategories.indexOf(i.category)!==-1)switch(i.dataType){case 4:var s=i.instanceOffset.get(o._partJoinedUsedCategories);e.setFloat(i.attributeName,n.buffer[a+s]);break;case 0:var s=i.instanceOffset.get(o._partJoinedUsedCategories);t.v2.x=n.buffer[a+s+0],t.v2.y=n.buffer[a+s+1],e.setVector2(i.attributeName,t.v2);break;case 5:case 1:var s=i.instanceOffset.get(o._partJoinedUsedCategories);t.v3.x=n.buffer[a+s+0],t.v3.y=n.buffer[a+s+1],t.v3.z=n.buffer[a+s+2],e.setVector3(i.attributeName,t.v3);break;case 6:case 2:var s=i.instanceOffset.get(o._partJoinedUsedCategories);t.v4.x=n.buffer[a+s+0],t.v4.y=n.buffer[a+s+1],t.v4.z=n.buffer[a+s+2],t.v4.w=n.buffer[a+s+3],e.setVector4(i.attributeName,t.v4)}}))},t.v2=e.Vector2.Zero(),t.v3=e.Vector3.Zero(),t.v4=e.Vector4.Zero(),t})();e.ModelRenderCache=o;var a=(function(){function e(){}return e})();e.ModelRenderCachePartData=a})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){function t(t,i){return function(o,a,s){var l=e.ClassTreeInfo.getOrRegister(o,(function(e){return new r(e)})),u=l.getLevelOf(o),c=a;i=i||c;var h=u.levelContent.get(c);if(h)throw new Error("The ID "+c+" is already taken by another instance data");h=new n,h.attributeName=i,h.category=t||null,h.category&&(h.delimitedCategory=";"+h.category+";"),u.levelContent.add(c,h),s.get=function(){return null},s.set=function(e){if(!h.category||r._CurCategories.indexOf(h.delimitedCategory)!==-1){h.size?h.instanceOffset.contains(r._CurCategories)||u.classContent.mapProperty(h,!1):(h.setSize(e),u.classContent.mapProperty(h,!0));var t=this;if(t.dataBuffer&&t.dataElements){var n=t.dataElements[t.curElement].offset+h.instanceOffset.get(r._CurCategories);h.writeData(t.dataBuffer.buffer,n,e)}}}}}var r=(function(){function t(t){this._baseInfo=t,this._nextOffset=new e.StringDictionary,this._attributes=new Array}return t.prototype.mapProperty=function(e,r){var n=this._nextOffset.getOrAdd(t._CurCategories,0);e.instanceOffset.add(t._CurCategories,this._getBaseOffset(t._CurCategories)+n),this._nextOffset.set(t._CurCategories,n+e.size/4),r&&this._attributes.push(e)},t.prototype.getInstancingAttributeInfos=function(t,r){for(var n=";"+r.join(";")+";",i=new Array,o=this;o;){for(var a=0,s=o._attributes;a<s.length;a++){var l=s[a];if(!l.category||r.indexOf(l.category)!==-1){var u=t.getAttributeLocationByName(l.attributeName),c=new e.InstancingAttributeInfo;c.index=u,c.attributeSize=l.size/4,c.offset=4*l.instanceOffset.get(n),c.attributeName=l.attributeName,i.push(c)}}o=o._baseInfo}return i},t.prototype.getShaderAttributes=function(e){for(var t=new Array,r=this;r;){for(var n=0,i=r._attributes;n<i.length;n++){var o=i[n];o.category&&e.indexOf(o.category)===-1||t.push(o.attributeName)}r=r._baseInfo}return t},t.prototype._getBaseOffset=function(e){for(var t=0,r=this._baseInfo;r;)t+=r._nextOffset.getOrAdd(e,0),r=r._baseInfo;return t},t})();e.InstanceClassInfo=r;var n=(function(){function t(){this.instanceOffset=new e.StringDictionary}return t.prototype.setSize=function(t){if(t instanceof e.Vector2)return this.size=8,void(this.dataType=0);if(t instanceof e.Vector3)return this.size=12,void(this.dataType=1);if(t instanceof e.Vector4)return this.size=16,void(this.dataType=2);if(t instanceof e.Matrix)throw new Error("Matrix type is not supported by WebGL Instance Buffer, you have to use four Vector4 properties instead");return"number"==typeof t?(this.size=4,void(this.dataType=4)):t instanceof e.Color3?(this.size=12,void(this.dataType=5)):t instanceof e.Color4?(this.size=16,void(this.dataType=6)):t instanceof e.Size?(this.size=8,void(this.dataType=7)):void 0},t.prototype.writeData=function(e,t,r){switch(this.dataType){case 0:var n=r;e[t+0]=n.x,e[t+1]=n.y;break;case 1:var n=r;e[t+0]=n.x,e[t+1]=n.y,e[t+2]=n.z;break;case 2:var n=r;e[t+0]=n.x,e[t+1]=n.y,e[t+2]=n.z,e[t+3]=n.w;break;case 5:var n=r;e[t+0]=n.r,e[t+1]=n.g,e[t+2]=n.b;break;case 6:var n=r;e[t+0]=n.r,e[t+1]=n.g,e[t+2]=n.b,e[t+3]=n.a;break;case 4:var n=r;e[t]=n;break;case 3:for(var n=r,i=0;i<16;i++)e[t+i]=n.m[i];break;case 7:var o=r;e[t+0]=o.width,e[t+1]=o.height}},t})();e.InstancePropInfo=n,e.instanceData=t;var i=(function(){function r(e,t){this.id=e,this.curElement=0,this._dataElementCount=t,this.renderMode=0,this.arrayLengthChanged=!1}return Object.defineProperty(r.prototype,"zBias",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"transformX",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"transformY",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"opacity",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),r.prototype.getClassTreeInfo=function(){return this.typeInfo||(this.typeInfo=e.ClassTreeInfo.get(Object.getPrototypeOf(this))),this.typeInfo},r.prototype.allocElements=function(){if(this.dataBuffer&&!this.dataElements){for(var e=new Array(this.dataElementCount),t=0;t<this.dataElementCount;t++)e[t]=this.dataBuffer.allocElement();this.dataElements=e}},r.prototype.freeElements=function(){if(this.dataElements){for(var e=0,t=this.dataElements;e<t.length;e++){var r=t[e];this.dataBuffer.freeElement(r)}this.dataElements=null}},Object.defineProperty(r.prototype,"dataElementCount",{get:function(){return this._dataElementCount},set:function(e){e!==this._dataElementCount&&(this.arrayLengthChanged=!0,this.freeElements(),this._dataElementCount=e,this.allocElements())},enumerable:!0,configurable:!0}),__decorate([t()],r.prototype,"zBias",null),__decorate([t()],r.prototype,"transformX",null),__decorate([t()],r.prototype,"transformY",null),__decorate([t()],r.prototype,"opacity",null),r})();e.InstanceDataBase=i;var o=(function(t){function n(e){t.call(this,e),this._transparentPrimitiveInfo=null}return __extends(n,t),Object.defineProperty(n.prototype,"isAlphaTest",{get:function(){return this._useTextureAlpha()||this._isPrimAlphaTest()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isTransparent",{get:function(){return this.actualOpacity<1||this._shouldUseAlphaFromTexture()||this._isPrimTransparent()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"renderMode",{get:function(){return this._renderMode},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.renderGroup&&this.renderGroup._setCacheGroupDirty(),this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),this._instanceDataParts&&this._cleanupInstanceDataParts(),this._modelRenderCache&&(this._modelRenderCache.dispose(),this._modelRenderCache=null),this._instanceDataParts&&(this._instanceDataParts.forEach((function(e){e.freeElements()})),this._instanceDataParts=null),!0)},n.prototype._cleanupInstanceDataParts=function(){for(var e=null,t=0,r=this._instanceDataParts;t<r.length;t++){var n=r[t];n.freeElements(),e=n.groupInstanceInfo}if(e){var i=0;if(e.hasOpaqueData){var o=e.opaqueData[0];i+=o._partData.usedElementCount,e.opaqueDirty=!0}if(e.hasAlphaTestData){var a=e.alphaTestData[0];i+=a._partData.usedElementCount,e.alphaTestDirty=!0}if(e.hasTransparentData){var s=e.transparentData[0];i+=s._partData.usedElementCount,e.transparentDirty=!0}0===i&&null!=e.modelRenderCache&&(this.renderGroup._renderableData._renderGroupInstancesInfo.remove(e.modelRenderCache.modelKey),e.dispose()),this._modelRenderCache&&(this._modelRenderCache.dispose(),this._modelRenderCache=null)}this._instanceDataParts=null},n.prototype._prepareRenderPre=function(r){t.prototype._prepareRenderPre.call(this,r),this._isFlagSet(e.SmartPropertyPrim.flagModelDirty)&&this._instanceDataParts&&this._cleanupInstanceDataParts();var n=!1;this._modelRenderCache&&!this._isFlagSet(e.SmartPropertyPrim.flagModelDirty)||(n=this._createModelRenderCache());var i=null,o=!1;this._instanceDataParts||(o=!0,i=this._createModelDataParts()),n&&this.setupModelRenderCache(this._modelRenderCache),(this._areSomeFlagsSet(e.SmartPropertyPrim.flagVisibilityChanged|e.SmartPropertyPrim.flagNeedRefresh)||r.forceRefreshPrimitive||o||0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep||this._mustUpdateInstance())&&this._updateInstanceDataParts(i)},n.prototype._createModelRenderCache=function(){var t=this,r=!1;return this._modelRenderCache&&this._modelRenderCache.dispose(),this._modelRenderCache=this.owner._engineData.GetOrAddModelCache(this.modelKey,(function(e){var n=t.createModelRenderCache(e);return r=!0,n})),this._clearFlags(e.SmartPropertyPrim.flagModelDirty),r||this._modelRenderCache.addRef(),r},n.prototype._createModelDataParts=function(){var t=this,r=this.createInstanceDataParts();this._instanceDataParts=r,this._modelRenderCache._partData||this._setupModelRenderCache(r);var n=this.renderGroup._renderableData._renderGroupInstancesInfo.getOrAddWithFactory(this.modelKey,(function(r){for(var n=new e.GroupInstanceInfo(t.renderGroup,t._modelRenderCache,t._modelRenderCache._partData.length),i=0;i<t._modelRenderCache._partData.length;i++){var o=t._instanceDataParts[i];n.partIndexFromId.add(o.id.toString(),i),n.usedShaderCategories[i]=";"+t.getUsedShaderCategories(o).join(";")+";",n.strides[i]=t._modelRenderCache._partData[i]._partDataStride}return n})),i=0,o=null;this.isTransparent?(o=n.transparentData,i=e.Render2DContext.RenderModeTransparent):this.isAlphaTest?(o=n.alphaTestData,i=e.Render2DContext.RenderModeAlphaTest):(o=n.opaqueData,i=e.Render2DContext.RenderModeOpaque);for(var a=0;a<r.length;a++){var s=r[a];s.dataBuffer=o[a]._partData,s.allocElements(),s.renderMode=i,s.groupInstanceInfo=n}return n},n.prototype._setupModelRenderCache=function(t){var n=new Array;this._modelRenderCache._partData=new Array;for(var i=0,o=t;i<o.length;i++){var a=o[i],s=new e.ModelRenderCachePartData;this._modelRenderCache._partData.push(s);var l=this.getUsedShaderCategories(a),u=a.getClassTreeInfo(),c=this.isVisible;this.isVisible=!0;var h=";"+l.join(";")+";";s._partJoinedUsedCategories=h,r._CurCategories=h;var d=this.beforeRefreshForLayoutConstruction(a);this.refreshInstanceDataPart(a)||console.log("Layout construction for "+e.Tools.getClassName(this._instanceDataParts[0])+" failed because refresh returned false"),this.afterRefreshForLayoutConstruction(a,d),this.isVisible=c;var p=0;u.fullContent.forEach((function(t,r){r.category&&l.indexOf(r.category)===-1||("zBias"===r.attributeName&&(s._zBiasOffset=r.instanceOffset.get(h)),r.size?p+=r.size:console.log("ERROR: Couldn't detect the size of the Property "+r.attributeName+" from type "+e.Tools.getClassName(u.type)+". Property is ignored."))})),s._partDataStride=p,s._partUsedCategories=l,s._partId=a.id,n.push(u)}this._modelRenderCache._partsClassInfo=n},n.prototype.onZOrderChanged=function(){if(this.isTransparent&&this._transparentPrimitiveInfo){this.renderGroup._renderableData.transparentPrimitiveZChanged(this._transparentPrimitiveInfo);var e=this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey);e.transparentOrderDirty=!0}},n.prototype._mustUpdateInstance=function(){return!1},n.prototype._useTextureAlpha=function(){return!1},n.prototype._shouldUseAlphaFromTexture=function(){return!1},n.prototype._isPrimAlphaTest=function(){return!1},n.prototype._isPrimTransparent=function(){return!1},n.prototype._updateInstanceDataParts=function(t){var n=this.renderGroup._renderableData;t||(t=n._renderGroupInstancesInfo.get(this.modelKey));var i=this.isTransparent,o=this.isAlphaTest,a=!1,s=!1;if(this._instanceDataParts.length>0){var l=this._instanceDataParts[0],u=l.renderMode,c=this.renderMode;if(u!==c){a=u===e.Render2DContext.RenderModeTransparent,s=!0;var h=void 0;switch(c){case e.Render2DContext.RenderModeTransparent:h=t.transparentData;break;case e.Render2DContext.RenderModeAlphaTest:h=t.alphaTestData;break;default:h=t.opaqueData}for(var d=0;d<this._instanceDataParts.length;d++){var p=this._instanceDataParts[d];p.freeElements(),p.dataBuffer=h[d]._partData,p.renderMode=c}}}var f=this._isFlagSet(e.SmartPropertyPrim.flagVisibilityChanged);(i||a)&&(f||s)&&(this.isVisible&&!a?this._transparentPrimitiveInfo||(this._transparentPrimitiveInfo=n.addNewTransparentPrimitiveInfo(this,t)):this._transparentPrimitiveInfo&&(n.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),t.transparentOrderDirty=!0);for(var _=!1,g=0,y=this._instanceDataParts;g<y.length;g++){var p=y[g],P=!1;!p.dataElements&&(f||s||this.isVisible)&&(p.allocElements(),P=!0),r._CurCategories=t.usedShaderCategories[t.partIndexFromId.get(p.id.toString())],p.arrayLengthChanged=!1,this.refreshInstanceDataPart(p)||(p.dataElements&&p.freeElements(),this.isVisible&&n._primNewDirtyList.push(this)),_=_||p.arrayLengthChanged||P}this._instanceDirtyFlags=0,i?(t.transparentDirty=!0,_&&(n._transparentListChanged=!0)):o?t.alphaTestDirty=!0:t.opaqueDirty=!0,this._clearFlags(e.SmartPropertyPrim.flagVisibilityChanged)},n.prototype._updateTransparentSegmentIndices=function(t){for(var r=e.Prim2DBase._bigInt,n=0,i=0,o=this._instanceDataParts;i<o.length;i++){var a=o[i];if(a&&a.dataElements){a.dataBuffer.pack();for(var s=0,l=a.dataElements;s<l.length;s++){var u=l[s];r=Math.min(r,u.offset),n=Math.max(n,u.offset)}t.startDataIndex=Math.min(t.startDataIndex,r/a.dataBuffer.stride),t.endDataIndex=Math.max(t.endDataIndex,n/a.dataBuffer.stride+1)}}},n.prototype._getNextPrimZOrder=function(){for(var e=this._instanceDataParts.length,t=0;t<e;t++){var r=this._instanceDataParts[t];if(r){var n=r.dataBuffer.stride,i=r.dataElements[r.dataElements.length-1].offset;return r.dataBuffer.totalElementCount*n<=i?null:r.dataBuffer[i+n+this.modelRenderCache._partData[t]._zBiasOffset]}}return null},n.prototype._getPrevPrimZOrder=function(){for(var e=this._instanceDataParts.length,t=0;t<e;t++){var r=this._instanceDataParts[t];if(r){var n=r.dataBuffer.stride,i=r.dataElements[0].offset;return 0===i?null:r.dataBuffer[i-n+this.modelRenderCache._partData[t]._zBiasOffset]}}return null},n.prototype.transformPointWithOriginByRef=function(e,t,r){var n=this.actualSize;r.x=e.x-(this.origin.x+(t?t.x:0))*n.width,r.y=e.y-(this.origin.y+(t?t.y:0))*n.height},n.prototype.transformPointWithOriginToRef=function(e,t,r){return this.transformPointWithOriginByRef(e,t,r),r},n.prototype.getDataPartEffectInfo=function(t,r,n,i){void 0===n&&(n=null),void 0===i&&(i=null);var o=e.Tools.first(this._instanceDataParts,(function(e){return e.id===t}));if(!o)return null;var a=this.owner.supportInstancedArray;if(null!=i){if(i&&a===!1)return null;a=i}var s=o.getClassTreeInfo(),l=this.getUsedShaderCategories(o),u=s.classContent.getShaderAttributes(l),c="";return l.forEach((function(e){c+="#define "+e+"\n"})),a&&(c+="#define Instanced\n"),{attributes:a?r.concat(u):r,uniforms:a?null!=n?n:[]:null!=n?u.concat(n):null!=u?u:[],defines:c}},Object.defineProperty(n.prototype,"modelRenderCache",{get:function(){return this._modelRenderCache},enumerable:!0,configurable:!0}),n.prototype.createModelRenderCache=function(e){return null},n.prototype.setupModelRenderCache=function(e){},n.prototype.createInstanceDataParts=function(){return null},n.prototype.getUsedShaderCategories=function(e){return[]},n.prototype.beforeRefreshForLayoutConstruction=function(e){},n.prototype.afterRefreshForLayoutConstruction=function(e,t){},n.prototype.applyActualScaleOnTransform=function(){return!0},n.prototype.refreshInstanceDataPart=function(e){return!!this.isVisible&&(e.isVisible=this.isVisible,1===e.dataElementCount&&(e.curElement=0,this.updateInstanceDataPart(e)),!0)},n.prototype.updateInstanceDataPart=function(t,r){void 0===r&&(r=null);var i=this._globalTransform.multiply(this.renderGroup.invGlobalTransform),o=this._areSomeFlagsSet(e.SmartPropertyPrim.flagDontInheritParentScale)?n._uV:this.renderGroup.actualScale,a=this.renderGroup.viewportSize,s=this.actualZOffset,l=0,u=0;r&&(l=r.x*i.m[0]+r.y*i.m[4],u=r.x*i.m[1]+r.y*i.m[5]);var c=a.width,h=a.height,d=1/s,p=new e.Vector4(i.m[0]*o.x*2/c,2*i.m[4]/c,0,(i.m[12]+l)*o.x*2/c-1),f=new e.Vector4(2*i.m[1]/h,i.m[5]*o.y*2/h,0,(i.m[13]+u)*o.y*2/h-1);if(!this.applyActualScaleOnTransform()){var _=this.actualScale;p.x/=_.x,f.y/=_.y}t.transformX=p,t.transformY=f,t.opacity=this.actualOpacity,t.zBias=new e.Vector2(s,d)},n.prototype._updateRenderMode=function(){this.isTransparent?this._renderMode=e.Render2DContext.RenderModeTransparent:this.isAlphaTest?this._renderMode=e.Render2DContext.RenderModeAlphaTest:this._renderMode=e.Render2DContext.RenderModeOpaque},n.RENDERABLEPRIM2D_PROPCOUNT=e.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,n._uV=new e.Vector2(1,1),__decorate([e.dynamicLevelProperty(e.Prim2DBase.PRIM2DBASE_PROPCOUNT+0,(function(e){return n.isAlphaTestProperty=e}))],n.prototype,"isAlphaTest",null),__decorate([e.dynamicLevelProperty(e.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,(function(e){return n.isTransparentProperty=e}))],n.prototype,"isTransparent",null),n=__decorate([e.className("RenderablePrim2D")],n)})(e.Prim2DBase);e.RenderablePrim2D=o})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(t){function r(r){t.call(this,r),r||(r={});var n=null;r.border&&(n="string"==typeof r.border?e.Canvas2D.GetBrushFromString(r.border):r.border);var i=null;r.fill&&(i="string"==typeof r.fill?e.Canvas2D.GetBrushFromString(r.fill):r.fill),this._isTransparent=!1,this._oldTransparent=!1,this.border=n,this.fill=i,this._updateTransparencyStatus(),this.borderThickness=r.borderThickness}return __extends(r,t),Object.defineProperty(r.prototype,"border",{get:function(){return this._border},set:function(e){this._border=e,this._updateTransparencyStatus()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fill",{get:function(){return this._fill},set:function(e){this._fill=e,this._updateTransparencyStatus()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderThickness",{get:function(){return this._borderThickness},set:function(e){this._borderThickness=e},enumerable:!0,configurable:!0}),r.prototype.getUsedShaderCategories=function(n){var i=t.prototype.getUsedShaderCategories.call(this,n);if(n.id===r.SHAPE2D_FILLPARTID){var o=this.fill;o instanceof e.SolidColorBrush2D&&i.push(r.SHAPE2D_CATEGORY_FILLSOLID),o instanceof e.GradientColorBrush2D&&i.push(r.SHAPE2D_CATEGORY_FILLGRADIENT)}if(n.id===r.SHAPE2D_BORDERPARTID){i.push(r.SHAPE2D_CATEGORY_BORDER);var a=this.border;a instanceof e.SolidColorBrush2D&&i.push(r.SHAPE2D_CATEGORY_BORDERSOLID),a instanceof e.GradientColorBrush2D&&i.push(r.SHAPE2D_CATEGORY_BORDERGRADIENT)}return i},r.prototype.applyActualScaleOnTransform=function(){return!1},r.prototype.refreshInstanceDataPart=function(n){if(!t.prototype.refreshInstanceDataPart.call(this,n))return!1;if(n.id===r.SHAPE2D_FILLPARTID){var i=n;if(this.fill){var o=this.fill;if(o instanceof e.SolidColorBrush2D)i.fillSolidColor=o.color;else if(o instanceof e.GradientColorBrush2D){i.fillGradientColor1=o.color1,i.fillGradientColor2=o.color2;var a=e.Matrix.Compose(new e.Vector3(o.scale,o.scale,o.scale),e.Quaternion.RotationAxis(new e.Vector3(0,0,1),o.rotation),new e.Vector3(o.translation.x,o.translation.y,0)),s=new e.Vector4(a.m[1],a.m[5],a.m[9],a.m[13]);i.fillGradientTY=s}}}else if(n.id===r.SHAPE2D_BORDERPARTID){var i=n;if(this.border){i.borderThickness=this.borderThickness;var l=this.border;if(l instanceof e.SolidColorBrush2D)i.borderSolidColor=l.color;else if(l instanceof e.GradientColorBrush2D){i.borderGradientColor1=l.color1,i.borderGradientColor2=l.color2;var a=e.Matrix.Compose(new e.Vector3(l.scale,l.scale,l.scale),e.Quaternion.RotationAxis(new e.Vector3(0,0,1),l.rotation),new e.Vector3(l.translation.x,l.translation.y,0)),s=new e.Vector4(a.m[1],a.m[5],a.m[9],a.m[13]);i.borderGradientTY=s}}}return!0},r.prototype._updateTransparencyStatus=function(){this._isTransparent=this._border&&this._border.isTransparent()||this._fill&&this._fill.isTransparent()||this.actualOpacity<1,this._isTransparent!==this._oldTransparent&&(this._oldTransparent=this._isTransparent,this._updateRenderMode())},r.prototype._mustUpdateInstance=function(){var e=this._oldTransparent!==this._isTransparent;return e&&(this._updateRenderMode(),this._oldTransparent=this._isTransparent),e},r.prototype._isPrimTransparent=function(){return this._isTransparent},r.SHAPE2D_BORDERPARTID=1,r.SHAPE2D_FILLPARTID=2,r.SHAPE2D_CATEGORY_BORDER="Border",r.SHAPE2D_CATEGORY_BORDERSOLID="BorderSolid",r.SHAPE2D_CATEGORY_BORDERGRADIENT="BorderGradient",r.SHAPE2D_CATEGORY_FILLSOLID="FillSolid",r.SHAPE2D_CATEGORY_FILLGRADIENT="FillGradient",r.SHAPE2D_PROPCOUNT=e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,__decorate([e.modelLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,(function(e){return r.borderProperty=e}),!0)],r.prototype,"border",null),__decorate([e.modelLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,(function(e){return r.fillProperty=e}),!0)],r.prototype,"fill",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,(function(e){return r.borderThicknessProperty=e}))],r.prototype,"borderThickness",null),r=__decorate([e.className("Shape2D")],r)})(e.RenderablePrim2D);e.Shape2D=t;var r=(function(r){function n(){r.apply(this,arguments)}return __extends(n,r),Object.defineProperty(n.prototype,"fillSolidColor",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fillGradientColor1",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fillGradientColor2",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fillGradientTY",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderThickness",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderSolidColor",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderGradientColor1",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderGradientColor2",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderGradientTY",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_FILLSOLID)],n.prototype,"fillSolidColor",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_FILLGRADIENT)],n.prototype,"fillGradientColor1",null),
__decorate([e.instanceData(t.SHAPE2D_CATEGORY_FILLGRADIENT)],n.prototype,"fillGradientColor2",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_FILLGRADIENT)],n.prototype,"fillGradientTY",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_BORDER)],n.prototype,"borderThickness",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_BORDERSOLID)],n.prototype,"borderSolidColor",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_BORDERGRADIENT)],n.prototype,"borderGradientColor1",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_BORDERGRADIENT)],n.prototype,"borderGradientColor2",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_BORDERGRADIENT)],n.prototype,"borderGradientTY",null),n})(e.InstanceDataBase);e.Shape2DInstanceData=r})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(t){function n(r){null==r&&(r={}),null==r.origin&&(r.origin=new e.Vector2(0,0)),t.call(this,r);var i=r.size||r.width||r.height?r.size||new e.Size(r.width||0,r.height||0):null;this._trackedNode=null==r.trackNode?null:r.trackNode,this._trackedNode&&this.owner&&this.owner._registerTrackedNode(this),this._cacheBehavior=null==r.cacheBehavior?n.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY:r.cacheBehavior;var o=this._renderableData;o&&(o._noResizeOnScale=0!==(this.cacheBehavior&n.GROUPCACHEBEHAVIOR_NORESIZEONSCALE)),this.size=i,this._viewportPosition=e.Vector2.Zero(),this._viewportSize=e.Size.Zero()}return __extends(n,t),n._createCachedCanvasGroup=function(t){var r=new n({parent:t,id:"__cachedCanvasGroup__",position:e.Vector2.Zero(),origin:e.Vector2.Zero(),size:null,isVisible:!0,isPickable:!1,dontInheritParentScale:!0});return r},n.prototype.applyCachedTexture=function(t,r){if(this._bindCacheTarget(),t)for(var n=t.uvs,i=this._renderableData._cacheNodeUVs,o=0;o<4;o++)n[2*o+0]=i[o].x,n[2*o+1]=i[o].y;r&&(r.diffuseTexture=this._renderableData._cacheTexture,r.emissiveColor=new e.Color3(1,1,1)),this._renderableData._cacheTexture.hasAlpha=!0,this._unbindCacheTarget()},Object.defineProperty(n.prototype,"cachedRect",{get:function(){return this._renderableData?this._renderableData._cacheNode:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cachedUVs",{get:function(){return this._renderableData?this._renderableData._cacheNodeUVs:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cachedUVsChanged",{get:function(){return this._renderableData?(this._renderableData._cacheNodeUVsChangedObservable||(this._renderableData._cacheNodeUVsChangedObservable=new e.Observable),this._renderableData._cacheNodeUVsChangedObservable):null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cacheTexture",{get:function(){return this._renderableData?this._renderableData._cacheTexture:null},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(null!=this._trackedNode&&(this.owner._unregisterTrackedNode(this),this._trackedNode=null),this._renderableData&&(this._renderableData.dispose(this.owner),this._renderableData=null),!0)},Object.defineProperty(n.prototype,"isRenderableGroup",{get:function(){return this._isRenderableGroup},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isCachedGroup",{get:function(){return this._isCachedGroup},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this._size},set:function(e){this._size=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewportSize",{get:function(){return this._viewportSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"actualSize",{get:function(){var t;if(this._actualSize)return this._actualSize;if(this._size)t=new e.Size(Math.ceil(this._size.width),Math.ceil(this._size.height));else{var r=this.layoutBoundingInfo.max();t=new e.Size(Math.ceil(r.x),Math.ceil(r.y))}return t.equals(this._actualSize)||(this.onPrimitivePropertyDirty(n.actualSizeProperty.flagId),this._actualSize=t,this.handleGroupChanged(n.actualSizeProperty)),t},set:function(e){this._actualSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cacheBehavior",{get:function(){return this._cacheBehavior},enumerable:!0,configurable:!0}),n.prototype._addPrimToDirtyList=function(e){this._renderableData._primDirtyList.push(e)},n.prototype._renderCachedCanvas=function(){this.owner._addGroupRenderCount(1),this.updateCachedStates(!0);var t=new e.PrepareRender2DContext;this._prepareGroupRender(t),this._groupRender()},Object.defineProperty(n.prototype,"trackedNode",{get:function(){return this._trackedNode},set:function(t){null!=t?(this._isFlagSet(e.SmartPropertyPrim.flagTrackedGroup)||this.owner._registerTrackedNode(this),this._trackedNode=t):(this._isFlagSet(e.SmartPropertyPrim.flagTrackedGroup)&&this.owner._unregisterTrackedNode(this),this._trackedNode=null)},enumerable:!0,configurable:!0}),n.prototype.levelIntersect=function(e){return!0},n.prototype.updateLevelBoundingInfo=function(){var t;t=this.size?this.size:new e.Size(0,0),e.BoundingInfo2D.CreateFromSizeToRef(t,this._levelBoundingInfo)},n.prototype._prepareGroupRender=function(t){var r=null,n=this._renderableData;(n._primDirtyList.length>0||t.forceRefreshPrimitive)&&(r=n._primDirtyList.sort((function(e,t){return e.hierarchyDepth-t.hierarchyDepth})),this.updateCachedStatesOf(r,!0));var i=this.actualSize,o=this.actualScale,a=Math.ceil(i.width*o.x),s=Math.ceil(i.height*o.y);if(this instanceof e.Canvas2D){var l=this;null!=l.designSize&&(a=this.owner.engine.getRenderWidth(),s=this.owner.engine.getRenderHeight())}if(!this._isCachedGroup){var u=this._globalTransform.getTranslation(),c=this.owner._renderingSize;s=Math.min(s,c.height-u.y),a=Math.min(a,c.width-u.x);var h=u.x,d=u.y;this._viewportPosition.x=h,this._viewportPosition.y=d}if(this._viewportSize.width===a&&this._viewportSize.height===s||(t.forceRefreshPrimitive=!0,this._viewportSize.width=a,this._viewportSize.height=s),n._primDirtyList.length>0||t.forceRefreshPrimitive){if(this._cacheGroupDirty=this._isCachedGroup,n._primNewDirtyList.splice(0),t.forceRefreshPrimitive)for(var p=0,f=this._children;p<f.length;p++){var _=f[p];_._prepareRender(t)}else r||(r=n._primDirtyList.sort((function(e,t){return e.hierarchyDepth-t.hierarchyDepth}))),r.forEach((function(e){!e.isDisposed&&e._needPrepare()&&e._prepareRender(t)}));n._primDirtyList.forEach((function(t){n._primNewDirtyList.indexOf(t)===-1?t._resetPropertiesDirty():t._setFlags(e.SmartPropertyPrim.flagNeedRefresh)})),n._primDirtyList.splice(0),n._primDirtyList=n._primDirtyList.concat(n._primNewDirtyList)}n._childrenRenderableGroups.forEach((function(e){e._prepareGroupRender(t)}))},n.prototype._groupRender=function(){for(var t=this,r=this.owner.engine,n=0,i=0,o=this._renderableData._childrenRenderableGroups;i<o.length;i++){var a=o[i];a._groupRender()}if(!this.isCachedGroup||this._cacheGroupDirty){if(this.owner._addGroupRenderCount(1),this.isCachedGroup)this._bindCacheTarget();else var s=r.setDirectViewport(this._viewportPosition.x,this._viewportPosition.y,this._viewportSize.width,this._viewportSize.height);var l=r.getAlphaTesting()===!0,u=r.getDepthWrite()===!0;r.setAlphaTesting(!1),r.setDepthWrite(!0);var c=new e.Render2DContext(e.Render2DContext.RenderModeOpaque);this._renderableData._renderGroupInstancesInfo.forEach((function(e,i){var o=t._prepareContext(r,c,i);if(null!==o&&(!t.owner.supportInstancedArray||o>0)){var a=!i.modelRenderCache.render(i,c);i.opaqueDirty=a,n+=a?1:0}})),r.setAlphaTesting(!0),r.setDepthWrite(!0),c=new e.Render2DContext(e.Render2DContext.RenderModeAlphaTest),this._renderableData._renderGroupInstancesInfo.forEach((function(e,i){var o=t._prepareContext(r,c,i);if(null!==o&&(!t.owner.supportInstancedArray||o>0)){var a=!i.modelRenderCache.render(i,c);i.opaqueDirty=a,n+=a?1:0}})),r.setAlphaTesting(!0),r.setDepthWrite(!1),this._renderableData._transparentListChanged&&this._updateTransparentData(),n+=this._renderTransparentData(),this._cacheGroupDirty=0!==n,this.isCachedGroup?this._unbindCacheTarget():s&&r.setViewport(s),r.setAlphaTesting(l),r.setDepthWrite(u)}},n.prototype._setCacheGroupDirty=function(){this._cacheGroupDirty=!0},n.prototype._updateTransparentData=function(){this.owner._addUpdateTransparentDataCount(1);var t=this._renderableData;t._transparentPrimitives.sort((function(e,t){return t._primitive.actualZOffset-e._primitive.actualZOffset}));for(var r=function(e,r){var n=t._transparentPrimitives[r];return e.groupInsanceInfo===n._groupInstanceInfo&&(n._transparentSegment=e,n._primitive._updateTransparentSegmentIndices(e),!0)},n=0,i=t._transparentSegments;n<i.length;n++){var o=i[n];o.dispose(this.owner.engine)}t._transparentSegments.splice(0);for(var a=null,s=0;s<t._transparentPrimitives.length;s++){var l=t._transparentPrimitives[s];if(l._groupInstanceInfo.transparentOrderDirty&&l._groupInstanceInfo.sortTransparentData(),l._transparentSegment=null,a&&r(a,s),!l._transparentSegment){var o=new e.TransparentSegment;o.groupInsanceInfo=l._groupInstanceInfo;var u=l._primitive;o.startZ=u.actualZOffset,u._updateTransparentSegmentIndices(o),o.endZ=o.startZ,l._transparentSegment=o,t._transparentSegments.push(o)}a=l._transparentSegment}t._transparentListChanged=!1},n.prototype._renderTransparentData=function(){for(var t=0,r=new e.Render2DContext(e.Render2DContext.RenderModeTransparent),n=this._renderableData,i=this.owner.supportInstancedArray,o=n._transparentSegments.length,a=0;a<o;a++){r.instancedBuffers=null;var s=n._transparentSegments[a],l=s.groupInsanceInfo,u=l.modelRenderCache,c=this.owner.engine,h=s.endDataIndex-s.startDataIndex;if(i&&h>=5){if(s.partBuffers){if(l.transparentDirty)for(var d=0;d<l.transparentData.length;d++){var p=l.transparentData[d],f=p._partData,_=f.pack(),g=f.stride,y=s.partBuffers[d],P=_.subarray(s.startDataIndex*g,s.endDataIndex*g);c.bindArrayBuffer(y),c.updateArrayBuffer(P)}}else{for(var b=new Array,d=0;d<l.transparentData.length;d++){var p=l.transparentData[d],f=p._partData,_=f.pack(),g=f.stride,v=h*g*4,y=c.createInstancesBuffer(v),P=_.subarray(s.startDataIndex*g,s.endDataIndex*g);c.updateArrayBuffer(P),b.push(y)}s.partBuffers=b}r.useInstancing=!0,r.instancesCount=h,r.instancedBuffers=s.partBuffers,r.groupInfoPartData=l.transparentData;var m=!u.render(l,r);t+=m?1:0}else{r.useInstancing=!1,r.partDataStartIndex=s.startDataIndex,r.partDataEndIndex=s.endDataIndex,r.groupInfoPartData=l.transparentData;var m=!u.render(l,r);t+=m?1:0}}return t},n.prototype._prepareContext=function(t,r,n){var i,o,a=null;switch(r.renderMode){case e.Render2DContext.RenderModeOpaque:if(!n.hasOpaqueData)return null;i=function(e){n.opaqueDirty=e},o=function(){return n.opaqueDirty},r.groupInfoPartData=n.opaqueData,a=n.opaqueData;break;case e.Render2DContext.RenderModeAlphaTest:if(!n.hasAlphaTestData)return null;i=function(e){n.alphaTestDirty=e},o=function(){return n.alphaTestDirty},r.groupInfoPartData=n.alphaTestData,a=n.alphaTestData;break;default:throw new Error("_prepareContext is only for opaque or alphaTest")}var s=0;if(this.owner.supportInstancedArray){r.useInstancing=!0;for(var l=0;l<a.length;l++){var u=a[l],c=u._partData,h=c.pack();s+=c.usedElementCount;var d=c.usedElementCount*c.stride*4;!u._partBuffer||u._partBufferSize<d?(u._partBuffer&&t.deleteInstancesBuffer(u._partBuffer),u._partBuffer=t.createInstancesBuffer(d),u._partBufferSize=d,i(!1),t.updateArrayBuffer(h)):o()&&(t.bindArrayBuffer(u._partBuffer),t.updateArrayBuffer(h))}i(!1)}else if(r.partDataStartIndex=0,r.groupInfoPartData.length>0){for(var l=0;!r.groupInfoPartData[l];)l++;r.partDataEndIndex=r.groupInfoPartData[l]._partData.usedElementCount}return s},n.prototype._setRenderingScale=function(e){this._renderableData._renderingScale!==e&&(this._renderableData._renderingScale=e)},n.prototype._bindCacheTarget=function(){var t,r,i,o=this._renderableData,a=o._renderingScale,s=o._noResizeOnScale,l=null==this.parent;i=s?l?n._uV:this.parent.actualScale:this.actualScale,n._s.width=Math.ceil(this.actualSize.width*i.x*a),n._s.height=Math.ceil(this.actualSize.height*i.y*a);var u=!n._s.equals(o._cacheSize);if(o._cacheNode){var c=o._cacheNode.contentSize;if(c.width<n._s.width||c.height<n._s.height){var h=this.owner.isScreenSpace?1.07:1;t=Math.floor(n._s.width*h),r=Math.floor(n._s.height*h),o._cacheTexture.freeRect(o._cacheNode),o._cacheNode=null}}if(!o._cacheNode){var d=this.owner._allocateGroupCache(this,this.parent&&this.parent.renderGroup,t?new e.Size(t,r):null,o._useMipMap,o._anisotropicLevel);o._cacheNode=d.node,o._cacheTexture=d.texture,o._cacheRenderSprite=d.sprite,u=!0}u&&(o._cacheSize.copyFrom(n._s),o._cacheNodeUVs=o._cacheNode.getUVsForCustomSize(o._cacheSize),o._cacheNodeUVsChangedObservable&&o._cacheNodeUVsChangedObservable.hasObservers()&&o._cacheNodeUVsChangedObservable.notifyObservers(o._cacheNodeUVs),this._setFlags(e.SmartPropertyPrim.flagWorldCacheChanged));var p=o._cacheNode;o._cacheTexture.bindTextureForPosSize(p.pos,n._s,!0)},n.prototype._unbindCacheTarget=function(){this._renderableData._cacheTexture&&this._renderableData._cacheTexture.unbindTexture()},n.prototype.handleGroupChanged=function(t){var r=this._renderableData;if(r){var i=r._cacheRenderSprite;this.isCachedGroup&&i&&(t.id===e.Prim2DBase.actualPositionProperty.id?(i.actualPosition=this.actualPosition.clone(),null!=i.position&&(i.position=i.actualPosition.clone())):t.id===e.Prim2DBase.rotationProperty.id?i.rotation=this.rotation:t.id===e.Prim2DBase.scaleProperty.id?i.scale=this.scale:t.id===e.Prim2DBase.originProperty.id?i.origin=this.origin.clone():t.id===n.actualSizeProperty.id&&(i.size=this.actualSize.clone()))}},n.prototype.detectGroupStates=function(){var t=this instanceof e.Canvas2D,i=this.owner.cachingStrategy;if(i===e.Canvas2D.CACHESTRATEGY_DONTCACHE)this._isRenderableGroup=t,this._isCachedGroup=!1;else if(i===e.Canvas2D.CACHESTRATEGY_CANVAS)t?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup="__cachedCanvasGroup__"===this.id,this._isCachedGroup=!1);else if(i===e.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS)t?(this._isRenderableGroup=!0,this._isCachedGroup=!1):1===this.hierarchyDepth?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup=!1,this._isCachedGroup=!1);else if(i===e.Canvas2D.CACHESTRATEGY_ALLGROUPS){var o=this.cacheBehavior&n.GROUPCACHEBEHAVIOR_OPTIONMASK;o!==n.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE&&o!==n.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP||(this._isRenderableGroup=o===n.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE,this._isCachedGroup=!1),o===n.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY&&(this._isRenderableGroup=!0,this._isCachedGroup=!0)}if(this._isRenderableGroup&&(this._renderableData||(this._renderableData=new r)),this._isCachedGroup){this._renderableData._noResizeOnScale=0!==(this.cacheBehavior&n.GROUPCACHEBEHAVIOR_NORESIZEONSCALE);for(var a=this.parent;a;){if(a instanceof n&&a._isRenderableGroup){a._renderableData._childrenRenderableGroups.indexOf(this)===-1&&a._renderableData._childrenRenderableGroups.push(this);break}a=a.parent}}},n.GROUP2D_PROPCOUNT=e.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,n.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY=0,n.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE=1,n.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP=2,n.GROUPCACHEBEHAVIOR_NORESIZEONSCALE=256,n.GROUPCACHEBEHAVIOR_OPTIONMASK=255,n._uV=new e.Vector2(1,1),n._s=e.Size.Zero(),__decorate([e.instanceLevelProperty(e.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,(function(e){return n.sizeProperty=e}),!1,!0)],n.prototype,"size",null),__decorate([e.instanceLevelProperty(e.Prim2DBase.PRIM2DBASE_PROPCOUNT+2,(function(e){return n.actualSizeProperty=e}))],n.prototype,"actualSize",null),n=__decorate([e.className("Group2D")],n)})(e.Prim2DBase);e.Group2D=t;var r=(function(){function t(){this._primDirtyList=new Array,this._primNewDirtyList=new Array,this._childrenRenderableGroups=new Array,this._renderGroupInstancesInfo=new e.StringDictionary,this._transparentPrimitives=new Array,this._transparentSegments=new Array,this._transparentListChanged=!1,this._cacheNode=null,this._cacheTexture=null,this._cacheRenderSprite=null,this._renderingScale=1,this._cacheNodeUVs=null,this._cacheNodeUVsChangedObservable=null,this._cacheSize=e.Size.Zero(),this._useMipMap=!1,this._anisotropicLevel=1,this._noResizeOnScale=!1}return t.prototype.dispose=function(e){var t=e.engine;if(this._cacheRenderSprite&&(this._cacheRenderSprite.dispose(),this._cacheRenderSprite=null),this._cacheTexture&&this._cacheNode&&(this._cacheTexture.freeRect(this._cacheNode),this._cacheTexture=null,this._cacheNode=null),this._primDirtyList&&(this._primDirtyList.splice(0),this._primDirtyList=null),this._renderGroupInstancesInfo&&(this._renderGroupInstancesInfo.forEach((function(e,t){t.dispose()})),this._renderGroupInstancesInfo=null),this._cacheNodeUVsChangedObservable&&(this._cacheNodeUVsChangedObservable.clear(),this._cacheNodeUVsChangedObservable=null),this._transparentSegments){for(var r=0,n=this._transparentSegments;r<n.length;r++){var i=n[r];i.dispose(t)}this._transparentSegments.splice(0),this._transparentSegments=null}},t.prototype.addNewTransparentPrimitiveInfo=function(e,t){var r=new n;return r._primitive=e,r._groupInstanceInfo=t,r._transparentSegment=null,this._transparentPrimitives.push(r),this._transparentListChanged=!0,r},t.prototype.removeTransparentPrimitiveInfo=function(e){var t=this._transparentPrimitives.indexOf(e);t!==-1&&(this._transparentPrimitives.splice(t,1),this._transparentListChanged=!0)},t.prototype.transparentPrimitiveZChanged=function(e){this._transparentListChanged=!0},t})();e.RenderableGroupData=r;var n=(function(){function e(){}return e})();e.TransparentPrimitiveInfo=n})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(t){function r(e,r){t.call(this,e,r),this.effectsReady=!1,this.fillVB=null,this.fillIB=null,this.fillIndicesCount=0,this.instancingFillAttributes=null,this.effectFill=null,this.effectFillInstanced=null,this.borderVB=null,this.borderIB=null,this.borderIndicesCount=0,this.instancingBorderAttributes=null,this.effectBorder=null,this.effectBorderInstanced=null}return __extends(r,t),r.prototype.render=function(t,r){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var n=t.owner.owner,i=n.engine,o=0;this.effectFill&&this.effectBorder&&(o=i.getDepthFunction(),i.setDepthFunctionToLessOrEqual());var a=i.getAlphaMode();if(this.effectFill){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_FILLPARTID.toString()),l=r.groupInfoPartData[s];r.renderMode!==e.Render2DContext.RenderModeOpaque&&i.setAlphaMode(e.Engine.ALPHA_COMBINE,!0);var u=r.useInstancing?this.effectFillInstanced:this.effectFill;if(i.enableEffect(u),i.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,u),r.useInstancing){this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_FILLPARTID,u));var c=r.instancedBuffers?r.instancedBuffers[s]:l._partBuffer,h=r.instancedBuffers?r.instancesCount:l._partData.usedElementCount;n._addDrawCallCount(1,r.renderMode),i.updateAndBindInstancesBuffer(c,null,this.instancingFillAttributes),i.draw(!0,0,this.fillIndicesCount,h),i.unbindInstanceAttributes()}else{n._addDrawCallCount(r.partDataEndIndex-r.partDataStartIndex,r.renderMode);for(var d=r.partDataStartIndex;d<r.partDataEndIndex;d++)this.setupUniforms(u,s,l._partData,d),i.draw(!0,0,this.fillIndicesCount)}}if(this.effectBorder){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_BORDERPARTID.toString()),l=r.groupInfoPartData[s];r.renderMode!==e.Render2DContext.RenderModeOpaque&&i.setAlphaMode(e.Engine.ALPHA_COMBINE,!0);var u=r.useInstancing?this.effectBorderInstanced:this.effectBorder;if(i.enableEffect(u),i.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,u),r.useInstancing){this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_BORDERPARTID,u));var c=r.instancedBuffers?r.instancedBuffers[s]:l._partBuffer,h=r.instancedBuffers?r.instancesCount:l._partData.usedElementCount;n._addDrawCallCount(1,r.renderMode),i.updateAndBindInstancesBuffer(c,null,this.instancingBorderAttributes),i.draw(!0,0,this.borderIndicesCount,h),i.unbindInstanceAttributes()}else{n._addDrawCallCount(r.partDataEndIndex-r.partDataStartIndex,r.renderMode);for(var d=r.partDataStartIndex;d<r.partDataEndIndex;d++)this.setupUniforms(u,s,l._partData,d),i.draw(!0,0,this.borderIndicesCount)}}return i.setAlphaMode(a,!0),this.effectFill&&this.effectBorder&&i.setDepthFunction(o),!0},r.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill=null,this.effectFillInstanced=null,this.effectBorder=null,this.effectBorderInstanced=null,this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),!0)},r})(e.ModelRenderCache);e.Rectangle2DRenderCache=t;var r=(function(t){function r(e){t.call(this,e,1)}return __extends(r,t),Object.defineProperty(r.prototype,"properties",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),__decorate([e.instanceData()],r.prototype,"properties",null),r})(e.Shape2DInstanceData);e.Rectangle2DInstanceData=r;var n=(function(n){function i(t){if(null==t&&(t={}),n.call(this,t),null!=t.size)this.size=t.size;else if(t.width||t.height){var r=new e.Size(t.width,t.height);this.size=r}var i=null==t.roundRadius?0:t.roundRadius,o=null==t.borderThickness?1:t.borderThickness;this.roundRadius=i,this.borderThickness=o}return __extends(i,n),Object.defineProperty(i.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(e){this._actualSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"notRounded",{get:function(){return this._notRounded},set:function(e){this._notRounded=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"roundRadius",{get:function(){return this._roundRadius},set:function(e){this._roundRadius=e,this.notRounded=0===e,this._positioningDirty()},enumerable:!0,configurable:!0}),i.prototype.levelIntersect=function(e){if(this.notRounded)return!0;var t=this.size;i._i0.x=e._localPickPosition.x,i._i0.y=e._localPickPosition.y;var r=this.roundRadius,n=r*r;return i._i1.x=r,i._i1.y=r,i._i0.x<=i._i1.x&&i._i0.y<=i._i1.y?(i._i2.x=i._i0.x-i._i1.x,i._i2.y=i._i0.y-i._i1.y,i._i2.lengthSquared()<=n):(i._i1.x=r,i._i1.y=t.height-r,i._i0.x<=i._i1.x&&i._i0.y>=i._i1.y?(i._i2.x=i._i0.x-i._i1.x,i._i2.y=i._i0.y-i._i1.y,i._i2.lengthSquared()<=n):(i._i1.x=t.width-r,i._i1.y=t.height-r,i._i0.x>=i._i1.x&&i._i0.y>=i._i1.y?(i._i2.x=i._i0.x-i._i1.x,i._i2.y=i._i0.y-i._i1.y,i._i2.lengthSquared()<=n):(i._i1.x=t.width-r,i._i1.y=r,!(i._i0.x>=i._i1.x&&i._i0.y<=i._i1.y)||(i._i2.x=i._i0.x-i._i1.x,i._i2.y=i._i0.y-i._i1.y,i._i2.lengthSquared()<=n))))},i.prototype.updateLevelBoundingInfo=function(){e.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},i.prototype.createModelRenderCache=function(e){var r=new t(this.owner.engine,e);return r},i.prototype.setupModelRenderCache=function(t){var r=t,n=this.owner.engine;if(this.fill){for(var o=4*(this.notRounded?1:i.roundSubdivisions)+1,a=new Float32Array(o),s=0;s<o;s++)a[s]=s;r.fillVB=n.createVertexBuffer(a);for(var l=o-1,u=new Float32Array(3*l),s=0;s<l;s++)u[3*s+0]=0,u[3*s+2]=s+1,u[3*s+1]=s+2;u[3*l-2]=1,r.fillIB=n.createIndexBuffer(u),r.fillIndicesCount=3*l;var c=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["index"],null,!0);c&&(r.effectFillInstanced=n.createEffect("rect2d",c.attributes,c.uniforms,[],c.defines,null)),c=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["index"],null,!1),r.effectFill=n.createEffect("rect2d",c.attributes,c.uniforms,[],c.defines,null)}if(this.border){for(var o=4*(this.notRounded?1:i.roundSubdivisions)*2,a=new Float32Array(o),s=0;s<o;s++)a[s]=s;r.borderVB=n.createVertexBuffer(a);for(var l=o,h=l/2,u=new Float32Array(3*l),s=0;s<h;s++){var d=s,p=(s+1)%h;u[6*s+0]=h+p,u[6*s+1]=h+d,u[6*s+2]=d,u[6*s+3]=p,u[6*s+4]=h+p,u[6*s+5]=d}r.borderIB=n.createIndexBuffer(u),r.borderIndicesCount=3*l;var c=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["index"],null,!0);c&&(r.effectBorderInstanced=n.createEffect("rect2d",c.attributes,c.uniforms,[],c.defines,null)),c=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["index"],null,!1),r.effectBorder=n.createEffect("rect2d",c.attributes,c.uniforms,[],c.defines,null)}return r},i.prototype._getInitialContentAreaToRef=function(e,t,r){if(this._notRounded)n.prototype._getInitialContentAreaToRef.call(this,e,t,r);else{var i=Math.round(1.3*(this.roundRadius-this.roundRadius/Math.sqrt(2)));t.x=t.y=i,r.width=Math.max(0,e.width-2*i),r.height=Math.max(0,e.height-2*i)}},i.prototype._getActualSizeFromContentToRef=function(e,t){if(this._notRounded)n.prototype._getActualSizeFromContentToRef.call(this,e,t);else{var r=Math.round(1.3*(this.roundRadius-this.roundRadius/Math.sqrt(2)));t.copyFrom(e),t.width+=2*r,t.height+=2*r}},i.prototype.createInstanceDataParts=function(){var t=new Array;return this.border&&t.push(new r(e.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&t.push(new r(e.Shape2D.SHAPE2D_FILLPARTID)),t},i.prototype.refreshInstanceDataPart=function(t){if(!n.prototype.refreshInstanceDataPart.call(this,t))return!1;if(t.id===e.Shape2D.SHAPE2D_BORDERPARTID){var r=t,i=this.actualSize,o=this.actualScale;r.properties=new e.Vector3(i.width*o.x,i.height*o.y,this.roundRadius||0)}else if(t.id===e.Shape2D.SHAPE2D_FILLPARTID){var r=t,i=this.actualSize,o=this.actualScale;r.properties=new e.Vector3(i.width*o.x,i.height*o.y,this.roundRadius||0)}return!0},i._i0=e.Vector2.Zero(),i._i1=e.Vector2.Zero(),i._i2=e.Vector2.Zero(),i.roundSubdivisions=16,__decorate([e.instanceLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+1,(function(e){return i.actualSizeProperty=e}),!1,!0)],i.prototype,"actualSize",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+2,(function(e){return i.notRoundedProperty=e}))],i.prototype,"notRounded",null),__decorate([e.instanceLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+3,(function(e){return i.roundRadiusProperty=e}))],i.prototype,"roundRadius",null),i=__decorate([e.className("Rectangle2D")],i)})(e.Shape2D);e.Rectangle2D=n})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(t){function r(e,r){t.call(this,e,r),this.effectsReady=!1,this.fillVB=null,this.fillIB=null,this.fillIndicesCount=0,this.instancingFillAttributes=null,this.effectFillInstanced=null,this.effectFill=null,this.borderVB=null,this.borderIB=null,this.borderIndicesCount=0,this.instancingBorderAttributes=null,this.effectBorderInstanced=null,this.effectBorder=null}return __extends(r,t),r.prototype.render=function(t,r){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var n=t.owner.owner,i=n.engine,o=0;this.effectFill&&this.effectBorder&&(o=i.getDepthFunction(),i.setDepthFunctionToLessOrEqual());var a=i.getAlphaMode();if(this.effectFill){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_FILLPARTID.toString()),l=r.groupInfoPartData[s];r.renderMode!==e.Render2DContext.RenderModeOpaque&&i.setAlphaMode(e.Engine.ALPHA_COMBINE,!0);var u=r.useInstancing?this.effectFillInstanced:this.effectFill;if(i.enableEffect(u),i.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,u),r.useInstancing){this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_FILLPARTID,u));var c=r.instancedBuffers?r.instancedBuffers[s]:l._partBuffer,h=r.instancedBuffers?r.instancesCount:l._partData.usedElementCount;n._addDrawCallCount(1,r.renderMode),i.updateAndBindInstancesBuffer(c,null,this.instancingFillAttributes),i.draw(!0,0,this.fillIndicesCount,h),i.unbindInstanceAttributes()}else{n._addDrawCallCount(r.partDataEndIndex-r.partDataStartIndex,r.renderMode);for(var d=r.partDataStartIndex;d<r.partDataEndIndex;d++)this.setupUniforms(u,s,l._partData,d),i.draw(!0,0,this.fillIndicesCount)}}if(this.effectBorder){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_BORDERPARTID.toString()),l=r.groupInfoPartData[s];r.renderMode!==e.Render2DContext.RenderModeOpaque&&i.setAlphaMode(e.Engine.ALPHA_COMBINE,!0);var u=r.useInstancing?this.effectBorderInstanced:this.effectBorder;if(i.enableEffect(u),i.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,u),r.useInstancing){this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_BORDERPARTID,u));var c=r.instancedBuffers?r.instancedBuffers[s]:l._partBuffer,h=r.instancedBuffers?r.instancesCount:l._partData.usedElementCount;n._addDrawCallCount(1,r.renderMode),i.updateAndBindInstancesBuffer(c,null,this.instancingBorderAttributes),i.draw(!0,0,this.borderIndicesCount,h),i.unbindInstanceAttributes()}else{n._addDrawCallCount(r.partDataEndIndex-r.partDataStartIndex,r.renderMode);for(var d=r.partDataStartIndex;d<r.partDataEndIndex;d++)this.setupUniforms(u,s,l._partData,d),i.draw(!0,0,this.borderIndicesCount)}}return i.setAlphaMode(a,!0),this.effectFill&&this.effectBorder&&i.setDepthFunction(o),!0},r.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill=null,this.effectFillInstanced=null,this.effectBorder=null,this.effectBorderInstanced=null,this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),!0)},r})(e.ModelRenderCache);e.Ellipse2DRenderCache=t;var r=(function(t){function r(e){t.call(this,e,1)}return __extends(r,t),Object.defineProperty(r.prototype,"properties",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),__decorate([e.instanceData()],r.prototype,"properties",null),r})(e.Shape2DInstanceData);e.Ellipse2DInstanceData=r;var n=(function(n){function i(t){if(null==t&&(t={}),n.call(this,t),null!=t.size)this.size=t.size;else if(t.width||t.height){var r=new e.Size(t.width,t.height);this.size=r}var i=null==t.subdivisions?64:t.subdivisions;this.subdivisions=i}return __extends(i,n),Object.defineProperty(i.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(e){this._actualSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subdivisions",{get:function(){return this._subdivisions},set:function(e){this._subdivisions=e},enumerable:!0,configurable:!0}),i.prototype.levelIntersect=function(e){var t=this.size.width/2,r=this.size.height/2,n=e._localPickPosition.x-t,i=e._localPickPosition.y-r;return n*n/(t*t)+i*i/(r*r)<=1},i.prototype.updateLevelBoundingInfo=function(){e.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},i.prototype.createModelRenderCache=function(e){var r=new t(this.owner.engine,e);return r},i.prototype.setupModelRenderCache=function(t){var r=t,n=this.owner.engine;if(this.fill){for(var i=this.subdivisions+1,o=new Float32Array(i),a=0;a<i;a++)o[a]=a;r.fillVB=n.createVertexBuffer(o);for(var s=i-1,l=new Float32Array(3*s),a=0;a<s;a++)l[3*a+0]=0,l[3*a+2]=a+1,l[3*a+1]=a+2;l[3*s-2]=1,r.fillIB=n.createIndexBuffer(l),r.fillIndicesCount=3*s;var u=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["index"],null,!0);u&&(r.effectFillInstanced=n.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},u.attributes,u.uniforms,[],u.defines,null)),u=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["index"],null,!1),r.effectFill=n.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},u.attributes,u.uniforms,[],u.defines,null)}if(this.border){for(var i=2*this.subdivisions,o=new Float32Array(i),a=0;a<i;a++)o[a]=a;
r.borderVB=n.createVertexBuffer(o);for(var s=i,c=s/2,l=new Float32Array(3*s),a=0;a<c;a++){var h=a,d=(a+1)%c;l[6*a+0]=c+d,l[6*a+1]=c+h,l[6*a+2]=h,l[6*a+3]=d,l[6*a+4]=c+d,l[6*a+5]=h}r.borderIB=n.createIndexBuffer(l),r.borderIndicesCount=3*s;var u=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["index"],null,!0);u&&(r.effectBorderInstanced=n.createEffect("ellipse2d",u.attributes,u.uniforms,[],u.defines,null)),u=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["index"],null,!1),r.effectBorder=n.createEffect("ellipse2d",u.attributes,u.uniforms,[],u.defines,null)}return r},i.prototype.createInstanceDataParts=function(){var t=new Array;return this.border&&t.push(new r(e.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&t.push(new r(e.Shape2D.SHAPE2D_FILLPARTID)),t},i.prototype.refreshInstanceDataPart=function(t){if(!n.prototype.refreshInstanceDataPart.call(this,t))return!1;if(t.id===e.Shape2D.SHAPE2D_BORDERPARTID){var r=t,i=this.actualSize,o=this.actualScale;r.properties=new e.Vector3(i.width*o.x,i.height*o.y,this.subdivisions)}else if(t.id===e.Shape2D.SHAPE2D_FILLPARTID){var r=t,i=this.actualSize,o=this.actualScale;r.properties=new e.Vector3(i.width*o.x,i.height*o.y,this.subdivisions)}return!0},__decorate([e.instanceLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+1,(function(e){return i.acutalSizeProperty=e}),!1,!0)],i.prototype,"actualSize",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+2,(function(e){return i.subdivisionsProperty=e}))],i.prototype,"subdivisions",null),i=__decorate([e.className("Ellipse2D")],i)})(e.Shape2D);e.Ellipse2D=n})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(t){function r(){t.apply(this,arguments),this.effectsReady=!1,this.vb=null,this.ib=null,this.instancingAttributes=null,this.texture=null,this.effect=null,this.effectInstanced=null}return __extends(r,t),r.prototype.render=function(t,r){if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0}var i=t.owner.owner,o=i.engine,a=o.getAlphaMode(),s=r.useInstancing?this.effectInstanced:this.effect;o.enableEffect(s),s.setTexture("diffuseSampler",this.texture),o.bindBuffersDirectly(this.vb,this.ib,[1],4,s),r.renderMode!==e.Render2DContext.RenderModeOpaque&&o.setAlphaMode(e.Engine.ALPHA_COMBINE,!0),s.setBool("alphaTest",r.renderMode===e.Render2DContext.RenderModeAlphaTest);var l=r.groupInfoPartData[0];if(r.useInstancing){this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(n.SPRITE2D_MAINPARTID,s));var u=r.instancedBuffers?r.instancedBuffers[0]:l._partBuffer,c=r.instancedBuffers?r.instancesCount:l._partData.usedElementCount;i._addDrawCallCount(1,r.renderMode),o.updateAndBindInstancesBuffer(u,null,this.instancingAttributes),o.draw(!0,0,6,c),o.unbindInstanceAttributes()}else{i._addDrawCallCount(r.partDataEndIndex-r.partDataStartIndex,r.renderMode);for(var h=r.partDataStartIndex;h<r.partDataEndIndex;h++)this.setupUniforms(s,0,l._partData,h),o.draw(!0,0,6)}return o.setAlphaMode(a,!0),!0},r.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.effect=null,this.effectInstanced=null,!0)},r})(e.ModelRenderCache);e.Sprite2DRenderCache=t;var r=(function(t){function r(e){t.call(this,e,1)}return __extends(r,t),Object.defineProperty(r.prototype,"topLeftUV",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sizeUV",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textureSize",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"properties",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),__decorate([e.instanceData()],r.prototype,"topLeftUV",null),__decorate([e.instanceData()],r.prototype,"sizeUV",null),__decorate([e.instanceData()],r.prototype,"scaleFactor",null),__decorate([e.instanceData()],r.prototype,"textureSize",null),__decorate([e.instanceData()],r.prototype,"properties",null),r})(e.InstanceDataBase);e.Sprite2DInstanceData=r;var n=(function(n){function i(t,r){var o=this;r||(r={}),n.call(this,r),this.texture=t,this.texture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.texture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.size=r.spriteSize,this.spriteLocation=r.spriteLocation||new e.Vector2(0,0),this.spriteScaleFactor=r.spriteScaleFactor||new e.Vector2(1,1),this.spriteFrame=0,this.invertY=null!=r.invertY&&r.invertY,this.alignToPixel=null==r.alignToPixel||r.alignToPixel,this.useAlphaFromTexture=!0,null!=r.spriteSize&&t.isReady()||(t.isReady()?this.size=t.getBaseSize():t.onLoadObservable.add((function(){null==r.spriteSize&&(o.size=t.getBaseSize()),o._positioningDirty(),o._instanceDirtyFlags|=e.Prim2DBase.originProperty.flagId|i.textureProperty.flagId})))}return __extends(i,n),Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,this._oldTextureHasAlpha=this._texture&&this.texture.hasAlpha},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useAlphaFromTexture",{get:function(){return this._useAlphaFromTexture},set:function(e){this._useAlphaFromTexture!==e&&(this._useAlphaFromTexture=e,this._updateRenderMode())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(e){this._actualSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"spriteLocation",{get:function(){return this._location},set:function(e){this._location=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"spriteFrame",{get:function(){return this._spriteFrame},set:function(e){this._spriteFrame=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"invertY",{get:function(){return this._invertY},set:function(e){this._invertY=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"spriteScaleFactor",{get:function(){return this._spriteScaleFactor},set:function(e){this._spriteScaleFactor=e},enumerable:!0,configurable:!0}),i.prototype.scaleToSize=function(e){var t=this.size;if(null==t||!this.texture.isReady()){if(!this.texture.isReady()){var r=this;return void this.texture.onLoadObservable.add((function(){r.scaleToSize(e)}))}t=this.texture.getBaseSize()}this.scale=Math.max(e.height/t.height,e.width/t.width)},Object.defineProperty(i.prototype,"alignToPixel",{get:function(){return this._alignToPixel},set:function(e){this._alignToPixel=e},enumerable:!0,configurable:!0}),i.prototype.updateLevelBoundingInfo=function(){e.BoundingInfo2D.CreateFromSizeToRef(this.size,this._levelBoundingInfo)},i.prototype.getAnimatables=function(){var e=new Array;return this.texture&&this.texture.animations&&this.texture.animations.length>0&&e.push(this.texture),e},i.prototype.levelIntersect=function(e){return!0},i._createCachedCanvasSprite=function(t,r,n,o){var a=new i(r,{parent:t,id:"__cachedCanvasSprite__",position:e.Vector2.Zero(),origin:e.Vector2.Zero(),spriteSize:n,spriteLocation:o,alignToPixel:!0});return a},i.prototype.createModelRenderCache=function(e){var r=new t(this.owner.engine,e);return r},i.prototype.setupModelRenderCache=function(e){for(var t=e,r=this.owner.engine,n=new Float32Array(4),o=0;o<4;o++)n[o]=o;t.vb=r.createVertexBuffer(n);var a=new Float32Array(6);a[0]=0,a[1]=2,a[2]=1,a[3]=0,a[4]=3,a[5]=2,t.ib=r.createIndexBuffer(a),t.texture=this.texture;var s=this.getDataPartEffectInfo(i.SPRITE2D_MAINPARTID,["index"],["alphaTest"],!0);return s&&(t.effectInstanced=r.createEffect("sprite2d",s.attributes,s.uniforms,["diffuseSampler"],s.defines,null)),s=this.getDataPartEffectInfo(i.SPRITE2D_MAINPARTID,["index"],["alphaTest"],!1),t.effect=r.createEffect("sprite2d",s.attributes,s.uniforms,["diffuseSampler"],s.defines,null),t},i.prototype.createInstanceDataParts=function(){return[new r(i.SPRITE2D_MAINPARTID)]},i.prototype.beforeRefreshForLayoutConstruction=function(e){i.layoutConstructMode=!0},i.prototype.afterRefreshForLayoutConstruction=function(e,t){i.layoutConstructMode=!1},i.prototype.refreshInstanceDataPart=function(t){if(!n.prototype.refreshInstanceDataPart.call(this,t))return!1;if(!this.texture.isReady()&&!i.layoutConstructMode)return!1;if(t.id===i.SPRITE2D_MAINPARTID){var r=this._instanceDataParts[0];if(i.layoutConstructMode)r.topLeftUV=e.Vector2.Zero(),r.sizeUV=e.Vector2.Zero(),r.properties=e.Vector3.Zero(),r.textureSize=e.Vector2.Zero(),r.scaleFactor=e.Vector2.Zero();else{var o=this.texture.getBaseSize(),a=this.spriteLocation,s=this.actualSize,l=this.spriteScaleFactor;r.topLeftUV=new e.Vector2(a.x/o.width,a.y/o.height);var u=new e.Vector2(s.width/o.width,s.height/o.height);r.sizeUV=u,r.scaleFactor=l,i._prop.x=this.spriteFrame,i._prop.y=this.invertY?1:0,i._prop.z=this.alignToPixel?1:0,r.properties=i._prop,r.textureSize=new e.Vector2(o.width,o.height)}}return!0},i.prototype._mustUpdateInstance=function(){var e=this._oldTextureHasAlpha!==(null!=this.texture&&this.texture.hasAlpha);return this._oldTextureHasAlpha=null!=this.texture&&this.texture.hasAlpha,e&&this._updateRenderMode(),e},i.prototype._useTextureAlpha=function(){return null!=this.texture&&this.texture.hasAlpha},i.prototype._shouldUseAlphaFromTexture=function(){return null!=this.texture&&this.texture.hasAlpha&&this.useAlphaFromTexture},i.SPRITE2D_MAINPARTID=1,i._prop=e.Vector3.Zero(),i.layoutConstructMode=!1,__decorate([e.modelLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,(function(e){return i.textureProperty=e}))],i.prototype,"texture",null),__decorate([e.dynamicLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,(function(e){return i.useAlphaFromTextureProperty=e}))],i.prototype,"useAlphaFromTexture",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,(function(e){return i.actualSizeProperty=e}),!1,!0)],i.prototype,"actualSize",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,(function(e){return i.spriteLocationProperty=e}))],i.prototype,"spriteLocation",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,(function(e){return i.spriteFrameProperty=e}))],i.prototype,"spriteFrame",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+6,(function(e){return i.invertYProperty=e}))],i.prototype,"invertY",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+7,(function(e){return i.spriteScaleFactorProperty=e}))],i.prototype,"spriteScaleFactor",null),i=__decorate([e.className("Sprite2D")],i)})(e.RenderablePrim2D);e.Sprite2D=n})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(t){function r(){t.apply(this,arguments),this.effectsReady=!1,this.vb=null,this.ib=null,this.instancingAttributes=null,this.fontTexture=null,this.effect=null,this.effectInstanced=null}return __extends(r,t),r.prototype.render=function(t,r){if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0}var i=t.owner.owner,o=i.engine;this.fontTexture.update();var a=r.useInstancing?this.effectInstanced:this.effect;o.enableEffect(a),a.setTexture("diffuseSampler",this.fontTexture),o.bindBuffersDirectly(this.vb,this.ib,[1],4,a);var s=o.getAlphaMode();o.setAlphaMode(e.Engine.ALPHA_COMBINE,!0);var l=r.groupInfoPartData[0];if(r.useInstancing){this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(n.TEXT2D_MAINPARTID,a));var u=r.instancedBuffers?r.instancedBuffers[0]:l._partBuffer,c=r.instancedBuffers?r.instancesCount:l._partData.usedElementCount;i._addDrawCallCount(1,r.renderMode),o.updateAndBindInstancesBuffer(u,null,this.instancingAttributes),o.draw(!0,0,6,c),o.unbindInstanceAttributes()}else{i._addDrawCallCount(r.partDataEndIndex-r.partDataStartIndex,r.renderMode);for(var h=r.partDataStartIndex;h<r.partDataEndIndex;h++)this.setupUniforms(a,0,l._partData,h),o.draw(!0,0,6)}return o.setAlphaMode(s,!0),!0},r.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.fontTexture&&(this.fontTexture.decCachedFontTextureCounter(),this.fontTexture=null),this.effect=null,this.effectInstanced=null,!0)},r})(e.ModelRenderCache);e.Text2DRenderCache=t;var r=(function(t){function r(e,r){t.call(this,e,r)}return __extends(r,t),Object.defineProperty(r.prototype,"topLeftUV",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sizeUV",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textureSize",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"color",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"superSampleFactor",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),__decorate([e.instanceData()],r.prototype,"topLeftUV",null),__decorate([e.instanceData()],r.prototype,"sizeUV",null),__decorate([e.instanceData()],r.prototype,"textureSize",null),__decorate([e.instanceData()],r.prototype,"color",null),__decorate([e.instanceData()],r.prototype,"superSampleFactor",null),r})(e.InstanceDataBase);e.Text2DInstanceData=r;var n=(function(n){function i(t,r){r||(r={}),n.call(this,r),this.fontName=null==r.fontName?"12pt Arial":r.fontName,this._fontSuperSample=null!=r.fontSuperSample&&r.fontSuperSample,this.defaultFontColor=null==r.defaultFontColor?new e.Color4(1,1,1,1):r.defaultFontColor,this._tabulationSize=null==r.tabulationSize?4:r.tabulationSize,this._textSize=null,this.text=t,this.size=null==r.size?null:r.size,this._updateRenderMode()}return __extends(i,n),Object.defineProperty(i.prototype,"fontName",{get:function(){return this._fontName},set:function(e){if(this._fontName)throw new Error("Font Name change is not supported right now.");this._fontName=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"defaultFontColor",{get:function(){return this._defaultFontColor},set:function(e){this._defaultFontColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e,this._textSize=null,this._size=null,this._updateCharCount();this.textSize},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return null!=this._size?this._size:this.textSize},set:function(e){this._size=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textSize",{get:function(){if(!this._textSize){if(!this.owner)return i.nullSize;var t=this.fontTexture.measureText(this._text,this._tabulationSize);t.equals(this._textSize)||(this.onPrimitivePropertyDirty(e.Prim2DBase.sizeProperty.flagId),this._positioningDirty()),this._textSize=t}return this._textSize},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontTexture",{get:function(){return this._fontTexture?this._fontTexture:null==this.fontName||null==this.owner||null==this.owner.scene?null:(this._fontTexture=e.FontTexture.GetCachedFontTexture(this.owner.scene,this.fontName,this._fontSuperSample),this._fontTexture)},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){return!!n.prototype.dispose.call(this)&&(this._fontTexture&&(e.FontTexture.ReleaseCachedFontTexture(this.owner.scene,this.fontName,this._fontSuperSample),this._fontTexture=null),!0)},i.prototype.updateLevelBoundingInfo=function(){e.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},i.prototype.levelIntersect=function(e){return!0},i.prototype.createModelRenderCache=function(e){var r=new t(this.owner.engine,e);return r},i.prototype.setupModelRenderCache=function(e){var t=e,r=this.owner.engine;t.fontTexture=this.fontTexture,t.fontTexture.incCachedFontTextureCounter();for(var n=new Float32Array(4),o=0;o<4;o++)n[o]=o;t.vb=r.createVertexBuffer(n);var a=new Float32Array(6);a[0]=0,a[1]=2,a[2]=1,a[3]=0,a[4]=3,a[5]=2,t.ib=r.createIndexBuffer(a);var s=this.getDataPartEffectInfo(i.TEXT2D_MAINPARTID,["index"],null,!0);return s&&(t.effectInstanced=r.createEffect("text2d",s.attributes,s.uniforms,["diffuseSampler"],s.defines,null)),s=this.getDataPartEffectInfo(i.TEXT2D_MAINPARTID,["index"],null,!1),t.effect=r.createEffect("text2d",s.attributes,s.uniforms,["diffuseSampler"],s.defines,null),t},i.prototype.createInstanceDataParts=function(){return[new r(i.TEXT2D_MAINPARTID,this._charCount)]},i.prototype.beforeRefreshForLayoutConstruction=function(e){if(!this._charCount){var t=this._text;return this.text="A",t}},i.prototype.afterRefreshForLayoutConstruction=function(e,t){void 0!==t&&(this.text=t)},i.prototype.refreshInstanceDataPart=function(t){if(!n.prototype.refreshInstanceDataPart.call(this,t))return!1;if(t.id===i.TEXT2D_MAINPARTID){var r=t,o=this.fontTexture,a=o.isSuperSampled?.5:1,s=o.getSize(),l=e.Vector2.Zero(),u=this.fontTexture.lineHeight;l.y=(this.textSize.height/u-1)*u;var c=0;r.dataElementCount=this._charCount,r.curElement=0;for(var h=0,d=this.text;h<d.length;h++){var p=d[h];if("\n"===p&&(l.x=0,l.y-=o.lineHeight),"\t"!==p){if(!(p<" ")){this.updateInstanceDataPart(r,l);var f=o.getChar(p);l.x+=f.charWidth,r.topLeftUV=f.topLeftUV;var _=f.bottomRightUV.subtract(f.topLeftUV);r.sizeUV=_,r.textureSize=new e.Vector2(s.width,s.height),r.color=this.defaultFontColor,r.superSampleFactor=a,++r.curElement}}else{var g=c+this._tabulationSize;g-=g%this._tabulationSize,l.x+=(g-c)*o.spaceWidth,c=g}}}return!0},i.prototype._updateCharCount=function(){for(var e=0,t=0,r=this._text;t<r.length;t++){var n=r[t];"\r"===n||"\n"===n||"\t"===n||n<" "||++e}this._charCount=e},i.prototype._useTextureAlpha=function(){return null!=this.fontTexture&&this.fontTexture.hasAlpha},i.prototype._shouldUseAlphaFromTexture=function(){return!0},i.TEXT2D_MAINPARTID=1,__decorate([e.modelLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,(function(e){return i.fontProperty=e}),!1,!0)],i.prototype,"fontName",null),__decorate([e.dynamicLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,(function(e){return i.defaultFontColorProperty=e}))],i.prototype,"defaultFontColor",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,(function(e){return i.textProperty=e}),!1,!0)],i.prototype,"text",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,(function(e){return i.sizeProperty=e}))],i.prototype,"size",null),i=__decorate([e.className("Text2D")],i)})(e.RenderablePrim2D);e.Text2D=n})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(t){function r(e,r){t.call(this,e,r),this.effectsReady=!1,this.fillVB=null,this.fillIB=null,this.fillIndicesCount=0,this.instancingFillAttributes=null,this.effectFill=null,this.effectFillInstanced=null,this.borderVB=null,this.borderIB=null,this.borderIndicesCount=0,this.instancingBorderAttributes=null,this.effectBorder=null,this.effectBorderInstanced=null}return __extends(r,t),r.prototype.render=function(t,r){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var n=t.owner.owner,i=n.engine,o=0;this.effectFill&&this.effectBorder&&(o=i.getDepthFunction(),i.setDepthFunctionToLessOrEqual());var a=i.getAlphaMode();if(this.effectFill){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_FILLPARTID.toString()),l=r.groupInfoPartData[s];r.renderMode!==e.Render2DContext.RenderModeOpaque&&i.setAlphaMode(e.Engine.ALPHA_COMBINE,!0);var u=r.useInstancing?this.effectFillInstanced:this.effectFill;if(i.enableEffect(u),i.bindBuffersDirectly(this.fillVB,this.fillIB,[2],8,u),r.useInstancing){this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_FILLPARTID,u));var c=r.instancedBuffers?r.instancedBuffers[s]:l._partBuffer,h=r.instancedBuffers?r.instancesCount:l._partData.usedElementCount;n._addDrawCallCount(1,r.renderMode),i.updateAndBindInstancesBuffer(c,null,this.instancingFillAttributes),i.draw(!0,0,this.fillIndicesCount,h),i.unbindInstanceAttributes()}else{n._addDrawCallCount(r.partDataEndIndex-r.partDataStartIndex,r.renderMode);for(var d=r.partDataStartIndex;d<r.partDataEndIndex;d++)this.setupUniforms(u,s,l._partData,d),i.draw(!0,0,this.fillIndicesCount)}}if(this.effectBorder){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_BORDERPARTID.toString()),l=r.groupInfoPartData[s];r.renderMode!==e.Render2DContext.RenderModeOpaque&&i.setAlphaMode(e.Engine.ALPHA_COMBINE,!0);var u=r.useInstancing?this.effectBorderInstanced:this.effectBorder;if(i.enableEffect(u),i.bindBuffersDirectly(this.borderVB,this.borderIB,[2],8,u),r.useInstancing){this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_BORDERPARTID,u));var c=r.instancedBuffers?r.instancedBuffers[s]:l._partBuffer,h=r.instancedBuffers?r.instancesCount:l._partData.usedElementCount;n._addDrawCallCount(1,r.renderMode),i.updateAndBindInstancesBuffer(c,null,this.instancingBorderAttributes),i.draw(!0,0,this.borderIndicesCount,h),i.unbindInstanceAttributes()}else{n._addDrawCallCount(r.partDataEndIndex-r.partDataStartIndex,r.renderMode);for(var d=r.partDataStartIndex;d<r.partDataEndIndex;d++)this.setupUniforms(u,s,l._partData,d),i.draw(!0,0,this.borderIndicesCount)}}return i.setAlphaMode(a,!0),this.effectFill&&this.effectBorder&&i.setDepthFunction(o),!0},r.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill=null,this.effectFillInstanced=null,this.effectBorder=null,this.effectBorderInstanced=null,this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),!0)},r})(e.ModelRenderCache);e.Lines2DRenderCache=t;var r=(function(t){function r(e){t.call(this,e,1)}return __extends(r,t),Object.defineProperty(r.prototype,"boundingMin",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"boundingMax",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),__decorate([e.instanceData(e.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],r.prototype,"boundingMin",null),__decorate([e.instanceData(e.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],r.prototype,"boundingMax",null),r})(e.Shape2DInstanceData);e.Lines2DInstanceData=r;var n=(function(n){function i(t,r){r||(r={}),n.call(this,r),this._fillVB=null,this._fillIB=null,this._borderVB=null,this._borderIB=null,this._size=e.Size.Zero(),this._boundingMin=null,this._boundingMax=null;var i=null==r.fillThickness?1:r.fillThickness,o=null==r.startCap?0:r.startCap,a=null==r.endCap?0:r.endCap,s=null!=r.closed&&r.closed;this.points=t,this.fillThickness=i,this.startCap=o,this.endCap=a,this.closed=s}return __extends(i,n),Object.defineProperty(i,"NoCap",{get:function(){return i._noCap},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RoundCap",{get:function(){return i._roundCap},enumerable:!0,configurable:!0}),Object.defineProperty(i,"TriangleCap",{get:function(){return i._triangleCap},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SquareAnchorCap",{get:function(){return i._squareAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RoundAnchorCap",{get:function(){return i._roundAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(i,"DiamondAnchorCap",{get:function(){return i._diamondAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ArrowCap",{get:function(){return i._arrowCap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"points",{get:function(){return this._points},set:function(e){this._points=e,this._contour=null,this._boundingBoxDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillThickness",{get:function(){return this._fillThickness},set:function(e){this._fillThickness=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"closed",{get:function(){return this._closed},set:function(e){this._closed=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"startCap",{get:function(){return this._startCap},set:function(e){this._startCap=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"endCap",{get:function(){return this._endCap},set:function(e){this._endCap=e},enumerable:!0,configurable:!0}),i.prototype.levelIntersect=function(t){var r=this;null==this._contour&&this._computeLines2D();var n=this.points.length,o=this.closed?n+1:n,a=t._localPickPosition;this.transformPointWithOriginToRef(this._contour[0],null,i._prevA),this.transformPointWithOriginToRef(this._contour[1],null,i._prevB);for(var s=1;s<o;s++){if(this.transformPointWithOriginToRef(this._contour[s%n*2+0],null,i._curA),this.transformPointWithOriginToRef(this._contour[s%n*2+1],null,i._curB),e.Vector2.PointInTriangle(a,i._prevA,i._prevB,i._curA))return!0;if(e.Vector2.PointInTriangle(a,i._curA,i._prevB,i._curB))return!0;i._prevA.x=i._curA.x,i._prevA.y=i._curA.y,i._prevB.x=i._curB.x,i._prevB.y=i._curB.y}var l=function(t,n){for(var o=t.length,s=0;s<o;s+=3)if(i._curA.x=n[2*t[s+0]+0],i._curA.y=n[2*t[s+0]+1],r.transformPointWithOriginToRef(i._curA,null,i._curB),i._curA.x=n[2*t[s+1]+0],i._curA.y=n[2*t[s+1]+1],r.transformPointWithOriginToRef(i._curA,null,i._prevA),i._curA.x=n[2*t[s+2]+0],i._curA.y=n[2*t[s+2]+1],r.transformPointWithOriginToRef(i._curA,null,i._prevB),e.Vector2.PointInTriangle(a,i._prevA,i._prevB,i._curB))return!0;return!1};if(this._startCapTriIndices){if(this._startCapTriIndices&&l(this._startCapTriIndices,this._startCapContour))return!0;if(this._endCapTriIndices&&l(this._endCapTriIndices,this._endCapContour))return!0}return!1},Object.defineProperty(i.prototype,"boundingMin",{get:function(){return this._boundingMin||this._computeLines2D(),this._boundingMin},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"boundingMax",{get:function(){return this._boundingMax||this._computeLines2D(),this._boundingMax},enumerable:!0,configurable:!0}),i.prototype.getUsedShaderCategories=function(t){var r=n.prototype.getUsedShaderCategories.call(this,t),i=r.indexOf(e.Shape2D.SHAPE2D_CATEGORY_BORDER);return i!==-1&&r.splice(i,1),r},i.prototype.updateLevelBoundingInfo=function(){this._boundingMin||this._computeLines2D(),e.BoundingInfo2D.CreateFromMinMaxToRef(this._boundingMin.x,this._boundingMax.x,this._boundingMin.y,this._boundingMax.y,this._levelBoundingInfo)},i.prototype.createModelRenderCache=function(e){var r=new t(this.owner.engine,e);return r},i.prototype._perp=function(e,t){t.x=e.y,t.y=-e.x},i.prototype._direction=function(e,t,r){e.subtractToRef(t,r),r.normalize()},i.prototype._computeMiter=function(t,r,n,o){return n.addToRef(o,t),t.normalize(),r.x=-t.y,r.y=t.x,i._miterTps.x=-n.y,i._miterTps.y=n.x,1/e.Vector2.Dot(r,i._miterTps)},i.prototype._intersect=function(e,t,r,n,i,o,a,s){var l=(e-r)*(o-s)-(t-n)*(i-a);if(0===l)return!1;var u=((i-a)*(e*n-t*r)-(e-r)*(i*s-o*a))/l;return!(u<Math.min(e,r)||u>Math.max(e,r))&&!(u<Math.min(i,a)||u>Math.max(i,a))},i.prototype._updateMinMax=function(e,t){t>=e.length||(this._boundingMin.x=Math.min(this._boundingMin.x,e[t]),this._boundingMax.x=Math.max(this._boundingMax.x,e[t]),this._boundingMin.y=Math.min(this._boundingMin.y,e[t+1]),this._boundingMax.y=Math.max(this._boundingMax.y,e[t+1]))},i.prototype._store=function(t,r,n,o,a,s,l,u,c){var h=null!=u&&!isNaN(u),d=n*(h?8:4);if(!(d>=t.length)){0===n?this._perp(s,i._startDir):n===o-1&&(this._perp(s,i._endDir),i._endDir.x*=-1,i._endDir.y*=-1);var p=!1;if(t[d+0]=a.x+s.x*l,t[d+1]=a.y+s.y*l,t[d+2]=a.x+s.x*-l,t[d+3]=a.y+s.y*-l,this._updateMinMax(t,d),this._updateMinMax(t,d+2),void 0!==c){var f=c*(h?8:4);if(this._intersect(t[d+0],t[d+1],t[f+0],t[f+1],t[d+2],t[d+3],t[f+2],t[f+3])){p=!0;var _=t[d+0];t[d+0]=t[d+2],t[d+2]=_,_=t[d+1],t[d+1]=t[d+3],t[d+3]=_}}if(h){var g=l+u;t[d+4]=a.x+s.x*(p?-g:g),t[d+5]=a.y+s.y*(p?-g:g),t[d+6]=a.x+s.x*(p?g:-g),t[d+7]=a.y+s.y*(p?g:-g),this._updateMinMax(t,d+4),this._updateMinMax(t,d+6)}r&&(d+=h?4:0,r.push(new e.Vector2(t[d+0],t[d+1])),r.push(new e.Vector2(t[d+2],t[d+3])))}},i.prototype._getCapSize=function(e,t){void 0===t&&(t=!1);var r=i._roundCapSubDiv,n=0,o=0;switch(e){case i.NoCap:!this.closed&&t?(n=4,o=6):n=o=0;break;case i.RoundCap:t?(n=r,o=3*(r-2)):(n=r/2+1,o=r/2*3);break;case i.ArrowCap:t?(n=12,o=24):(n=3,o=3);break;case i.TriangleCap:t?(n=6,o=12):(n=3,o=3);break;case i.DiamondAnchorCap:t?(n=10,o=24):(n=5,o=9);break;case i.SquareAnchorCap:t?(n=12,o=30):(n=4,o=6);break;case i.RoundAnchorCap:t?(n=2*r,o=6*(r-1)):(n=r+1,o=3*(r+1))}return{vbsize:2*n,ibsize:o}},i.prototype._storeVertex=function(e,t,r,n,o,a,s){var l=Math.cos(o),u=Math.sin(o);i._tpsV.x=l*a.x+-u*a.y+n.x,i._tpsV.y=u*a.x+l*a.y+n.y;var c=t+2*r;return e[c+0]=i._tpsV.x,e[c+1]=i._tpsV.y,s&&(s.push(i._tpsV.x),s.push(i._tpsV.y)),this._updateMinMax(e,c),(t+2*r)/2},i.prototype._storeIndex=function(e,t,r,n){e[t+r]=n},i.prototype._buildCap=function(t,r,n,o,a,s,l,u,c,h){var d=i._roundCapSubDiv,p=new e.Vector2(1,0),f=Math.atan2(c.y,c.x)-Math.atan2(p.y,p.x),_=s/2,g=s,y=null!=l,P=l;switch(u){case i.NoCap:if(y&&!this.closed){var b=0,v=0,m=this._storeVertex(t,r,b++,a,f,new e.Vector2(0,_+P),h),C=this._storeVertex(t,r,b++,a,f,new e.Vector2(P,_+P),h),D=this._storeVertex(t,r,b++,a,f,new e.Vector2(P,(-(_+P))),h),x=this._storeVertex(t,r,b++,a,f,new e.Vector2(0,(-(_+P))),h);this._storeIndex(n,o,v++,m),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,D),this._storeIndex(n,o,v++,m),this._storeIndex(n,o,v++,D),this._storeIndex(n,o,v++,x)}break;case i.ArrowCap:_*=2;case i.TriangleCap:if(y){var I=u===i.TriangleCap?P:Math.sqrt(P*P*2),m=this._storeVertex(t,r,0,a,f,new e.Vector2(0,_),null),C=this._storeVertex(t,r,1,a,f,new e.Vector2(_,0),null),D=this._storeVertex(t,r,2,a,f,new e.Vector2(0,(-_)),null),x=this._storeVertex(t,r,3,a,f,new e.Vector2(0,_+I),h),S=this._storeVertex(t,r,4,a,f,new e.Vector2(_+I,0),h),O=this._storeVertex(t,r,5,a,f,new e.Vector2(0,(-(_+I))),h),v=0;if(this._storeIndex(n,o,v++,m),this._storeIndex(n,o,v++,x),this._storeIndex(n,o,v++,S),this._storeIndex(n,o,v++,m),this._storeIndex(n,o,v++,S),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,O),this._storeIndex(n,o,v++,D),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,O),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,S),u===i.ArrowCap){var A=s/2,T=this._storeVertex(t,r,9,a,f,new e.Vector2(0,(-(A+P))),null),R=this._storeVertex(t,r,11,a,f,new e.Vector2((-P),(-(_+I))),h),B=this._storeVertex(t,r,10,a,f,new e.Vector2((-P),(-(A+P))),h),w=this._storeVertex(t,r,6,a,f,new e.Vector2(0,A+P),null),E=this._storeVertex(t,r,7,a,f,new e.Vector2((-P),A+P),h),M=this._storeVertex(t,r,8,a,f,new e.Vector2((-P),_+I),h);this._storeIndex(n,o,v++,w),this._storeIndex(n,o,v++,E),this._storeIndex(n,o,v++,M),this._storeIndex(n,o,v++,w),this._storeIndex(n,o,v++,M),this._storeIndex(n,o,v++,x),this._storeIndex(n,o,v++,T),this._storeIndex(n,o,v++,R),this._storeIndex(n,o,v++,B),this._storeIndex(n,o,v++,T),this._storeIndex(n,o,v++,O),this._storeIndex(n,o,v++,R)}}else{var m=this._storeVertex(t,r,0,a,f,new e.Vector2(0,_),h),C=this._storeVertex(t,r,1,a,f,new e.Vector2(_,0),h),D=this._storeVertex(t,r,2,a,f,new e.Vector2(0,(-_)),h);
this._storeIndex(n,o,0,m),this._storeIndex(n,o,1,C),this._storeIndex(n,o,2,D)}break;case i.RoundCap:if(y)for(var L=-Math.PI/2,z=Math.PI/(d/2-1),v=0,V=0;V<d/2;V++){var m=this._storeVertex(t,r,2*V+0,a,f,new e.Vector2(Math.cos(L)*_,Math.sin(L)*_),null),C=this._storeVertex(t,r,2*V+1,a,f,new e.Vector2(Math.cos(L)*(_+P),Math.sin(L)*(_+P)),h);V>0&&(this._storeIndex(n,o,v++,m-2),this._storeIndex(n,o,v++,C-2),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,m-2),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,m)),L+=z}else{var F=this._storeVertex(t,r,0,a,f,new e.Vector2(0,0),null),L=-Math.PI/2,z=Math.PI/(d/2-1);this._storeVertex(t,r,1,a,f,new e.Vector2(Math.cos(L)*_,Math.sin(L)*_),null),L+=z;for(var V=1;V<d/2;V++){var C=this._storeVertex(t,r,V+1,a,f,new e.Vector2(Math.cos(L)*_,Math.sin(L)*_),h);this._storeIndex(n,o,3*V+0,F),this._storeIndex(n,o,3*V+1,C-1),this._storeIndex(n,o,3*V+2,C),L+=z}}break;case i.SquareAnchorCap:var b=0,F=y?null:h,m=this._storeVertex(t,r,b++,a,f,new e.Vector2(0,g),F),C=this._storeVertex(t,r,b++,a,f,new e.Vector2(2*g,g),F),D=this._storeVertex(t,r,b++,a,f,new e.Vector2(2*g,(-g)),F),x=this._storeVertex(t,r,b++,a,f,new e.Vector2(0,(-g)),F);if(y){var S=this._storeVertex(t,r,b++,a,f,new e.Vector2(0,_+P),null),O=this._storeVertex(t,r,b++,a,f,new e.Vector2((-P),_+P),h),w=this._storeVertex(t,r,b++,a,f,new e.Vector2((-P),g+P),h),E=this._storeVertex(t,r,b++,a,f,new e.Vector2(2*g+P,g+P),h),M=this._storeVertex(t,r,b++,a,f,new e.Vector2(2*g+P,(-(g+P))),h),T=this._storeVertex(t,r,b++,a,f,new e.Vector2((-P),(-(g+P))),h),B=this._storeVertex(t,r,b++,a,f,new e.Vector2((-P),(-(_+P))),h),R=this._storeVertex(t,r,b++,a,f,new e.Vector2(0,(-(_+P))),null),v=0;this._storeIndex(n,o,v++,O),this._storeIndex(n,o,v++,m),this._storeIndex(n,o,v++,S),this._storeIndex(n,o,v++,O),this._storeIndex(n,o,v++,w),this._storeIndex(n,o,v++,m),this._storeIndex(n,o,v++,m),this._storeIndex(n,o,v++,w),this._storeIndex(n,o,v++,E),this._storeIndex(n,o,v++,m),this._storeIndex(n,o,v++,E),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,E),this._storeIndex(n,o,v++,M),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,M),this._storeIndex(n,o,v++,D),this._storeIndex(n,o,v++,D),this._storeIndex(n,o,v++,M),this._storeIndex(n,o,v++,T),this._storeIndex(n,o,v++,D),this._storeIndex(n,o,v++,T),this._storeIndex(n,o,v++,x),this._storeIndex(n,o,v++,T),this._storeIndex(n,o,v++,B),this._storeIndex(n,o,v++,x),this._storeIndex(n,o,v++,B),this._storeIndex(n,o,v++,R),this._storeIndex(n,o,v++,x)}else this._storeIndex(n,o,0,m),this._storeIndex(n,o,1,C),this._storeIndex(n,o,2,D),this._storeIndex(n,o,3,m),this._storeIndex(n,o,4,D),this._storeIndex(n,o,5,x);break;case i.RoundAnchorCap:var N=Math.sqrt(g*g-_*_),G=new e.Vector2(N,0),L=e.Tools.ToRadians(-150),z=e.Tools.ToRadians(300)/(d-1);if(y)for(var v=0,V=0;V<d;V++){var m=this._storeVertex(t,r,2*V+0,a,f,new e.Vector2(N+Math.cos(L)*g,Math.sin(L)*g),null),C=this._storeVertex(t,r,2*V+1,a,f,new e.Vector2(N+Math.cos(L)*(g+P),Math.sin(L)*(g+P)),h);V>0&&(this._storeIndex(n,o,v++,m-2),this._storeIndex(n,o,v++,C-2),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,m-2),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,m)),L+=z}else{var F=this._storeVertex(t,r,0,a,f,G,null);this._storeVertex(t,r,1,a,f,new e.Vector2(N+Math.cos(L)*g,Math.sin(L)*g),null),L+=z;for(var V=1;V<d;V++){var C=this._storeVertex(t,r,V+1,a,f,new e.Vector2(N+Math.cos(L)*g,Math.sin(L)*g),h);this._storeIndex(n,o,3*V+0,F),this._storeIndex(n,o,3*V+1,C-1),this._storeIndex(n,o,3*V+2,C),L+=z}this._storeIndex(n,o,3*d+0,F),this._storeIndex(n,o,3*d+1,F+1),this._storeIndex(n,o,3*d+2,F+d)}break;case i.DiamondAnchorCap:var b=0,F=y?null:h,m=this._storeVertex(t,r,b++,a,f,new e.Vector2(0,_),F),C=this._storeVertex(t,r,b++,a,f,new e.Vector2(_,g),F),D=this._storeVertex(t,r,b++,a,f,new e.Vector2(3*_,0),F),x=this._storeVertex(t,r,b++,a,f,new e.Vector2(_,(-g)),F),S=this._storeVertex(t,r,b++,a,f,new e.Vector2(0,(-_)),F);if(y){var I=Math.sqrt(P*P*2),O=this._storeVertex(t,r,b++,a,f,new e.Vector2((-I),_),h),w=this._storeVertex(t,r,b++,a,f,new e.Vector2(_,g+I),h),E=this._storeVertex(t,r,b++,a,f,new e.Vector2(3*_+I,0),h),M=this._storeVertex(t,r,b++,a,f,new e.Vector2(_,(-(g+I))),h),T=this._storeVertex(t,r,b++,a,f,new e.Vector2((-I),(-_)),h),v=0;this._storeIndex(n,o,v++,O),this._storeIndex(n,o,v++,w),this._storeIndex(n,o,v++,m),this._storeIndex(n,o,v++,m),this._storeIndex(n,o,v++,w),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,w),this._storeIndex(n,o,v++,E),this._storeIndex(n,o,v++,C),this._storeIndex(n,o,v++,E),this._storeIndex(n,o,v++,D),this._storeIndex(n,o,v++,D),this._storeIndex(n,o,v++,E),this._storeIndex(n,o,v++,M),this._storeIndex(n,o,v++,D),this._storeIndex(n,o,v++,M),this._storeIndex(n,o,v++,x),this._storeIndex(n,o,v++,x),this._storeIndex(n,o,v++,M),this._storeIndex(n,o,v++,T),this._storeIndex(n,o,v++,x),this._storeIndex(n,o,v++,T),this._storeIndex(n,o,v++,S)}else this._storeIndex(n,o,0,m),this._storeIndex(n,o,1,C),this._storeIndex(n,o,2,D),this._storeIndex(n,o,3,m),this._storeIndex(n,o,4,D),this._storeIndex(n,o,5,S),this._storeIndex(n,o,6,S),this._storeIndex(n,o,7,D),this._storeIndex(n,o,8,x)}return null},i.prototype._buildLine=function(t,r,n,i){var o=e.Vector2.Zero(),a=e.Vector2.Zero(),s=e.Vector2.Zero(),l=e.Vector2.Zero(),u=null;this.closed&&this.points.push(this.points[0]);for(var c=this.points.length,h=1;h<c;h++){var d=this.points[h-1],p=this.points[h],f=h<this.points.length-1?this.points[h+1]:null;if(this._direction(p,d,o),u||(u=e.Vector2.Zero(),this._perp(o,u)),1===h&&this._store(t,r,0,c,this.points[0],u,n,i),f){this._direction(f,p,a);var _=this._computeMiter(s,l,o,a);this._store(t,r,h,c,this.points[h],l,_*n,_*i,h-1)}else this._perp(o,u),this._store(t,r,h,c,this.points[h],u,n,i,h-1)}if(this.points.length>2&&this.closed){var g=this.points[c-2],y=this.points[0],P=this.points[1];this._direction(y,g,o),this._direction(P,y,a),this._perp(o,u);var b=this._computeMiter(s,l,o,a);if(this._store(t,null,0,c,this.points[0],l,b*n,b*i,1),r){var v=null==i?0:4;r[0].x=t[v+0],r[0].y=t[v+1],r[1].x=t[v+2],r[1].y=t[v+3]}}this.closed&&this.points.splice(c-1)},i.prototype.setupModelRenderCache=function(t){var r=t,n=this.owner.engine;if(null===this._fillVB&&this._computeLines2D(),this.fill){r.fillVB=n.createVertexBuffer(this._fillVB),r.fillIB=n.createIndexBuffer(this._fillIB),r.fillIndicesCount=this._fillIB.length;var i=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["position"],null,!0);i&&(r.effectFillInstanced=n.createEffect("lines2d",i.attributes,i.uniforms,[],i.defines,null)),i=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["position"],null,!1),r.effectFill=n.createEffect("lines2d",i.attributes,i.uniforms,[],i.defines,null)}if(this.border){r.borderVB=n.createVertexBuffer(this._borderVB),r.borderIB=n.createIndexBuffer(this._borderIB),r.borderIndicesCount=this._borderIB.length;var i=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["position"],null,!0);i&&(r.effectBorderInstanced=n.createEffect({vertex:"lines2d",fragment:"lines2d"},i.attributes,i.uniforms,[],i.defines,null)),i=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["position"],null,!1),r.effectBorder=n.createEffect({vertex:"lines2d",fragment:"lines2d"},i.attributes,i.uniforms,[],i.defines,null)}return this._fillVB=null,this._fillIB=null,this._borderVB=null,this._borderIB=null,r},i.prototype._computeLines2D=function(){this._boundingMin=new e.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),this._boundingMax=new e.Vector2(Number.MIN_VALUE,Number.MIN_VALUE);var t=new Array,r=new Array,n=new Array;if(this.fill){var o=this._getCapSize(this.startCap),a=this._getCapSize(this.endCap),s=this.points.length,l=2*s*2+o.vbsize+a.vbsize;this._fillVB=new Float32Array(l);var u=this._fillVB,c=this.fillThickness/2,h=this.points.length;this._buildLine(u,this.border?null:t,c);var d=2*h,p=2*(s-(this.closed?0:1));this._fillIB=new Float32Array(3*p+o.ibsize+a.ibsize);for(var f=this._fillIB,_=0;_<p;_+=2)f[3*_+0]=_+0,f[3*_+1]=_+1,f[3*_+2]=(_+2)%d,f[3*_+3]=_+1,f[3*_+4]=(_+3)%d,f[3*_+5]=(_+2)%d;this._buildCap(u,2*s*2,f,3*p,this.points[0],this.fillThickness,null,this.startCap,i._startDir,this.border?null:r),this._buildCap(u,2*s*2+o.vbsize,f,3*p+o.ibsize,this.points[h-1],this.fillThickness,null,this.endCap,i._endDir,this.border?null:r)}if(this.border){var o=this._getCapSize(this.startCap,!0),a=this._getCapSize(this.endCap,!0),s=this.points.length,l=2*s*2*2+o.vbsize+a.vbsize;this._borderVB=new Float32Array(l);var u=this._borderVB,c=this.fillThickness/2,g=this.borderThickness,h=this.points.length;this._buildLine(u,t,c,g);var d=2*h*2,p=2*(s-(this.closed?0:1))*2;this._borderIB=new Float32Array(3*p+o.ibsize+a.ibsize);for(var f=this._borderIB,_=0;_<p;_+=4)f[3*_+0]=_+0,f[3*_+1]=_+2,f[3*_+2]=(_+6)%d,f[3*_+3]=_+0,f[3*_+4]=(_+6)%d,f[3*_+5]=(_+4)%d,f[3*_+6]=_+3,f[3*_+7]=_+1,f[3*_+8]=(_+5)%d,f[3*_+9]=_+3,f[3*_+10]=(_+5)%d,f[3*_+11]=(_+7)%d;this._buildCap(u,2*s*2*2,f,3*p,this.points[0],this.fillThickness,this.borderThickness,this.startCap,i._startDir,r),this._buildCap(u,2*s*2*2+o.vbsize,f,3*p+o.ibsize,this.points[h-1],this.fillThickness,this.borderThickness,this.endCap,i._endDir,n)}if(this._contour=t,r.length>0){var y=Earcut.earcut(r,null,2);this._startCapTriIndices=y,this._startCapContour=r}else this._startCapTriIndices=null,this._startCapContour=null;if(n.length>0){var P=Earcut.earcut(n,null,2);this._endCapContour=n,this._endCapTriIndices=P}else this._endCapContour=null,this._endCapTriIndices=null;var b=this._boundingMax.subtract(this._boundingMin);this._size.width=b.x,this._size.height=b.y},Object.defineProperty(i.prototype,"size",{get:function(){return null==this._size&&this._computeLines2D(),this._size},enumerable:!0,configurable:!0}),i.prototype.createInstanceDataParts=function(){var t=new Array;return this.border&&t.push(new r(e.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&t.push(new r(e.Shape2D.SHAPE2D_FILLPARTID)),t},i.prototype.applyActualScaleOnTransform=function(){return!0},i.prototype.refreshInstanceDataPart=function(t){if(!n.prototype.refreshInstanceDataPart.call(this,t))return!1;if(t.id===e.Shape2D.SHAPE2D_BORDERPARTID){var r=t;this.border instanceof e.GradientColorBrush2D&&(r.boundingMin=this.boundingMin,r.boundingMax=this.boundingMax)}else if(t.id===e.Shape2D.SHAPE2D_FILLPARTID){var r=t;this.fill instanceof e.GradientColorBrush2D&&(r.boundingMin=this.boundingMin,r.boundingMax=this.boundingMax)}return!0},i._prevA=e.Vector2.Zero(),i._prevB=e.Vector2.Zero(),i._curA=e.Vector2.Zero(),i._curB=e.Vector2.Zero(),i._miterTps=e.Vector2.Zero(),i._startDir=e.Vector2.Zero(),i._endDir=e.Vector2.Zero(),i._tpsV=e.Vector2.Zero(),i._noCap=0,i._roundCap=1,i._triangleCap=2,i._squareAnchorCap=3,i._roundAnchorCap=4,i._diamondAnchorCap=5,i._arrowCap=6,i._roundCapSubDiv=36,__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+1,(function(e){return i.pointsProperty=e}))],i.prototype,"points",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+2,(function(e){return i.fillThicknessProperty=e}))],i.prototype,"fillThickness",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+3,(function(e){return i.closedProperty=e}))],i.prototype,"closed",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+4,(function(e){return i.startCapProperty=e}))],i.prototype,"startCap",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+5,(function(e){return i.endCapProperty=e}))],i.prototype,"endCap",null),i=__decorate([e.className("Lines2D")],i)})(e.Shape2D);e.Lines2D=n})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(){function t(){this._modelCache=new e.StringDictionary}return t.prototype.GetOrAddModelCache=function(e,t){return this._modelCache.getOrAddWithFactory(e,t)},t.prototype.DisposeModelRenderCache=function(e){return!!e.isDisposed&&(this._modelCache.remove(e.modelKey),!0)},t})();e.Canvas2DEngineBoundData=t;var r=(function(r){function n(i,o){var a=this;r.call(this,o),this.worldSpaceToNodeLocal=function(t){var r=a._worldSpaceNode;if(r){var n=r.getWorldMatrix().clone();n.invert();var i=e.Vector3.TransformCoordinates(t,n),o=new e.Vector2(i.x,i.y),s=a.actualSize;return o.x+=.5*s.width,o.y+=.5*s.height,o}},this.worldSpaceCacheChanged=function(){var t=a.worldSpaceCanvasNode,r=e.VertexData.ExtractFromMesh(t);r.uvs=new Float32Array(8);var n=t.material,i=a._renderableData._cacheTexture;n.diffuseTexture!==i&&(n.diffuseTexture=i,i.hasAlpha=!0);for(var o=a._renderableData._cacheNodeUVs,s=0;s<4;s++)r.uvs[2*s+0]=o[s].x,r.uvs[2*s+1]=o[s].y;r.applyToMesh(t)},this._notifDebugMode=!1,this._mapCounter=0,this._drawCallsOpaqueCounter=new e.PerfCounter,this._drawCallsAlphaTestCounter=new e.PerfCounter,this._drawCallsTransparentCounter=new e.PerfCounter,this._groupRenderCounter=new e.PerfCounter,this._updateTransparentDataCounter=new e.PerfCounter,this._cachedGroupRenderCounter=new e.PerfCounter,this._updateCachedStateCounter=new e.PerfCounter,this._updateLayoutCounter=new e.PerfCounter,this._updatePositioningCounter=new e.PerfCounter,this._updateLocalTransformCounter=new e.PerfCounter,this._updateGlobalTransformCounter=new e.PerfCounter,this._boundingInfoRecomputeCounter=new e.PerfCounter,this._cachedCanvasGroup=null,this._profileInfoText=null,e.Prim2DBase._isCanvasInit=!1,o||(o={}),this._cachingStrategy!==n.CACHESTRATEGY_TOPLEVELGROUPS&&(this._background=new e.Rectangle2D({parent:this,id:"###CANVAS BACKGROUND###",size:o.size}),this._background.zOrder=1,this._background.isPickable=!1,this._background.origin=e.Vector2.Zero(),this._background.levelVisible=!1,null!=o.backgroundRoundRadius&&(this.backgroundRoundRadius=o.backgroundRoundRadius),null!=o.backgroundBorder&&("string"==typeof o.backgroundBorder?this.backgroundBorder=n.GetBrushFromString(o.backgroundBorder):this.backgroundBorder=o.backgroundBorder),null!=o.backgroundBorderThickNess&&(this.backgroundBorderThickness=o.backgroundBorderThickNess),null!=o.backgroundFill&&("string"==typeof o.backgroundFill?this.backgroundFill=n.GetBrushFromString(o.backgroundFill):this.backgroundFill=o.backgroundFill),this.propertyChanged.add((function(e,t){"size"===e.propertyName&&(a._background.size=a.size)}),e.Group2D.sizeProperty.flagId),this._background._patchHierarchy(this));var s=i.getEngine();this.__engineData=s.getOrAddExternalDataWithFactory("__BJSCANVAS2D__",(function(e){return new t})),this._primPointerInfo=new e.PrimitivePointerInfo,this._capturedPointers=new e.StringDictionary,this._pickStartingPosition=e.Vector2.Zero(),this._hierarchyLevelMaxSiblingCount=50,this._hierarchyDepth=0,this._zOrder=0,this._zMax=1,this._scene=i,this._engine=s,this._renderingSize=new e.Size(0,0),this._designSize=o.designSize||null,this._designUseHorizAxis=o.designUseHorizAxis===!0,this._trackedGroups=new Array,this._maxAdaptiveWorldSpaceCanvasSize=null,this._groupCacheMaps=new e.StringDictionary,this._patchHierarchy(this);var l=null==o.enableInteraction||o.enableInteraction;this._fitRenderingDevice=!o.size,o.size||(o.size=new e.Size(s.getRenderWidth(),s.getRenderHeight())),i.onDisposeObservable.add((function(e,t){a.dispose()})),this._isScreenSpace?this._afterRenderObserver=this._scene.onAfterRenderObservable.add((function(e,t){a._engine.clear(null,!1,!0,!0),a._render()})):this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add((function(e,t){a._render()})),this._supprtInstancedArray=null!==this._engine.getCaps().instancedArrays,this._setupInteraction(l),n._INSTANCES.push(this)}return __extends(n,r),Object.defineProperty(n.prototype,"drawCallsOpaqueCounter",{get:function(){return this._drawCallsOpaqueCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"drawCallsAlphaTestCounter",{get:function(){return this._drawCallsAlphaTestCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"drawCallsTransparentCounter",{get:function(){return this._drawCallsTransparentCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"groupRenderCounter",{get:function(){return this._groupRenderCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"updateTransparentDataCounter",{get:function(){return this._updateTransparentDataCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cachedGroupRenderCounter",{get:function(){return this._cachedGroupRenderCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"updateCachedStateCounter",{get:function(){return this._updateCachedStateCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"updateLayoutCounter",{get:function(){return this._updateLayoutCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"updatePositioningCounter",{get:function(){return this._updatePositioningCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"updateLocalTransformCounter",{get:function(){return this._updateLocalTransformCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"updateGlobalTransformCounter",{get:function(){return this._updateGlobalTransformCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boundingInfoRecomputeCounter",{get:function(){return this._boundingInfoRecomputeCounter},enumerable:!0,configurable:!0}),Object.defineProperty(n,"instances",{get:function(){return n._INSTANCES},enumerable:!0,configurable:!0}),n.prototype._canvasPreInit=function(e){var t=null==e.cachingStrategy?n.CACHESTRATEGY_DONTCACHE:e.cachingStrategy;this._cachingStrategy=t,this._isScreenSpace=null==e.isScreenSpace||e.isScreenSpace},n.prototype._setupInteraction=function(e){var t=this;if(e!==this._interactionEnabled)if(this._interactionEnabled=e,this._isScreenSpace){if(!e)return void(this._scenePrePointerObserver&&(this.scene.onPrePointerObservable.remove(this._scenePrePointerObserver),this._scenePrePointerObserver=null));this._scenePrePointerObserver=this.scene.onPrePointerObservable.add((function(e,r){if(t.isVisible!==!1){var n=1/t.engine.getHardwareScalingLevel(),i=e.localPosition.multiplyByFloats(n,n);t._handlePointerEventForInteraction(e,i,r)}}))}else{var r=this.scene;e?(r.constantlyUpdateMeshUnderPointer=!0,this._scenePointerObserver=r.onPointerObservable.add((function(e,r){if(t.isVisible!==!1&&e.pickInfo.hit&&e.pickInfo.pickedMesh===t._worldSpaceNode&&t.worldSpaceToNodeLocal){var n=t.worldSpaceToNodeLocal(e.pickInfo.pickedPoint);t._handlePointerEventForInteraction(e,n,r)}}))):this._scenePointerObserver&&(this.scene.onPointerObservable.remove(this._scenePointerObserver),this._scenePointerObserver=null)}},n.prototype._setPointerCapture=function(t,r){if(this.isPointerCaptured(t))return!1;try{this.engine.getRenderingCanvas().setPointerCapture(t)}catch(n){}return this._primPointerInfo.updateRelatedTarget(r,e.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(r,e.PrimitivePointerInfo.PointerGotCapture,null),this._capturedPointers.add(t.toString(),r),!0},n.prototype._releasePointerCapture=function(t,r){if(this._capturedPointers.get(t.toString())!==r)return!1;try{this.engine.getRenderingCanvas().releasePointerCapture(t)}catch(n){}return this._primPointerInfo.updateRelatedTarget(r,e.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(r,e.PrimitivePointerInfo.PointerLostCapture,null),this._capturedPointers.remove(t.toString()),!0},n.prototype.isPointerCaptured=function(e){return this._capturedPointers.contains(e.toString())},n.prototype.getCapturedPrimitive=function(e){return 0===this._capturedPointers.count?null:this._capturedPointers.get(e.toString())},n.prototype._handlePointerEventForInteraction=function(t,r,n){if(!this.isDisposed&&this._updatePointerInfo(t,r)){var i=this.getCapturedPrimitive(this._primPointerInfo.pointerId);if(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,null!==i,!0),this._updateOverStatus(!0),this._actualOverPrimitive||i){var o=i||this._actualOverPrimitive.prim,a=i?this._primPointerInfo.canvasPointerPos.subtract(new e.Vector2(o.globalTransform.m[12],o.globalTransform.m[13])):this._actualOverPrimitive.intersectionLocation;this._primPointerInfo.updateRelatedTarget(o,a);var s=!1;t.type===e.PointerEventTypes.POINTERWHEEL?s=!this._bubbleNotifyPrimPointerObserver(o,e.PrimitivePointerInfo.PointerMouseWheel,t):t.type===e.PointerEventTypes.POINTERMOVE?s=!this._bubbleNotifyPrimPointerObserver(o,e.PrimitivePointerInfo.PointerMove,t):t.type===e.PointerEventTypes.POINTERDOWN?s=!this._bubbleNotifyPrimPointerObserver(o,e.PrimitivePointerInfo.PointerDown,t):t.type===e.PointerEventTypes.POINTERUP&&(s=!this._bubbleNotifyPrimPointerObserver(o,e.PrimitivePointerInfo.PointerUp,t)),n.skipNextObservers=s}}},n.prototype._updatePointerInfo=function(t,r){var n=this.scale,i=this._primPointerInfo;i.canvasPointerPos||(i.canvasPointerPos=e.Vector2.Zero());var o=this._scene.cameraToUseForPointers||this._scene.activeCamera;if(!o||!o.viewport)return!1;var a=this._scene.getEngine();if(this._isScreenSpace){var s=o.viewport,l=s.toGlobal(a.getRenderWidth(),a.getRenderHeight()),u=r.x-l.x,c=r.y-l.y;i.canvasPointerPos.x=(u-this.actualPosition.x)/n,i.canvasPointerPos.y=(a.getRenderHeight()-c-this.actualPosition.y)/n}else i.canvasPointerPos.x=r.x/n,i.canvasPointerPos.y=r.y/n;if(i.mouseWheelDelta=0,t.type===e.PointerEventTypes.POINTERWHEEL){var h=t.event;h.wheelDelta?i.mouseWheelDelta=h.wheelDelta/(40*e.PrimitivePointerInfo.MouseWheelPrecision):h.detail&&(i.mouseWheelDelta=-h.detail/e.PrimitivePointerInfo.MouseWheelPrecision)}else{var d=t.event;i.ctrlKey=d.ctrlKey,i.altKey=d.altKey,i.shiftKey=d.shiftKey,i.metaKey=d.metaKey,i.button=d.button,i.buttons=d.buttons,i.pointerId=d.pointerId,i.width=d.width,i.height=d.height,i.presssure=d.pressure,i.tilt.x=d.tiltX,i.tilt.y=d.tiltY,i.isCaptured=null!==this.getCapturedPrimitive(d.pointerId)}return!0},n.prototype._updateIntersectionList=function(e,t,r){if(r||this.scene.getRenderId()!==this._intersectionRenderId){this._globalTransform||this.updateCachedStates(!0);var i=n._interInfo;if(i.pickPosition.x=e.x,i.pickPosition.y=e.y,i.findFirstOnly=!1,!t&&!this.levelBoundingInfo.doesIntersect(i.pickPosition))return this._previousIntersectionList=this._actualIntersectionList,this._actualIntersectionList=null,this._previousOverPrimitive=this._actualOverPrimitive,void(this._actualOverPrimitive=null);this.intersect(i),this._previousIntersectionList=this._actualIntersectionList,this._actualIntersectionList=i.intersectedPrimitives,this._previousOverPrimitive=this._actualOverPrimitive,this._actualOverPrimitive=i.topMostIntersectedPrimitive,this._intersectionRenderId=this.scene.getRenderId()}},n.prototype._updateOverStatus=function(t){if((t||this.scene.getRenderId()!==this._hoverStatusRenderId)&&this._previousIntersectionList&&this._actualIntersectionList){var r=this._previousOverPrimitive?this._previousOverPrimitive.prim:null,n=this._actualOverPrimitive?this._actualOverPrimitive.prim:null;if(r!==n){var i=this.getCapturedPrimitive(this._primPointerInfo.pointerId);(i&&i===r||!i&&r)&&(this._primPointerInfo.updateRelatedTarget(r,this._previousOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(r,e.PrimitivePointerInfo.PointerOut,null)),(i&&i===n||!i&&n)&&(this._primPointerInfo.updateRelatedTarget(n,this._actualOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(n,e.PrimitivePointerInfo.PointerOver,null))}this._hoverStatusRenderId=this.scene.getRenderId()}},n.prototype._updatePrimPointerPos=function(e){if(this._primPointerInfo.isCaptured)this._primPointerInfo.primitivePointerPos=this._primPointerInfo.relatedTargetPointerPos;else for(var t=0,r=this._actualIntersectionList;t<r.length;t++){var n=r[t];if(n.prim===e)return void(this._primPointerInfo.primitivePointerPos=n.intersectionLocation)}},n.prototype._debugExecObserver=function(t,r){if(this._notifDebugMode){for(var n="",i=0;i<t.hierarchyDepth;i++)n+="  ";var o=this._primPointerInfo;n+="[RID:"+this.scene.getRenderId()+"] ["+t.hierarchyDepth+"] event:"+e.PrimitivePointerInfo.getEventTypeName(r)+", id: "+t.id+" ("+e.Tools.getClassName(t)+"), primPos: "+o.primitivePointerPos.toString()+", canvasPos: "+o.canvasPointerPos.toString(),console.log(n)}},n.prototype._bubbleNotifyPrimPointerObserver=function(t,r,n){var i=this._primPointerInfo,o=n?n.event:null;0!==(r&(e.PrimitivePointerInfo.PointerOver|e.PrimitivePointerInfo.PointerOut))&&this._notifParents(t,r);for(var a=!1,s=t;s;){if(!a){if(this._updatePrimPointerPos(s),this._debugExecObserver(s,r),!s._pointerEventObservable.notifyObservers(i,r)&&n instanceof e.PointerInfoPre)return n.skipOnPointerObservable=!0,!1;if(this._triggerActionManager(s,i,r,o),i.cancelBubble){if(0===(r&(e.PrimitivePointerInfo.PointerOver|e.PrimitivePointerInfo.PointerOut)))return!1;a=!0}}a&&this._updatePrimPointerPos(s),r===e.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(s,e.PrimitivePointerInfo.PointerEnter),s._pointerEventObservable.notifyObservers(i,e.PrimitivePointerInfo.PointerEnter)):r===e.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(s,e.PrimitivePointerInfo.PointerLeave),s._pointerEventObservable.notifyObservers(i,e.PrimitivePointerInfo.PointerLeave)),s=s.parent}return!0},n.prototype._triggerActionManager=function(t,r,n,i){var o=this;if(this._globalTransform||this.updateCachedStates(!0),0!==(n&e.PrimitivePointerInfo.PointerDown)){if(this._pickStartingPosition=r.primitivePointerPos.clone(),this._pickStartingTime=(new Date).getTime(),this._pickedDownPrim=null,t.actionManager){if(this._pickedDownPrim=t,t.actionManager.hasPickTriggers){var a=e.ActionEvent.CreateNewFromPrimitive(t,r.primitivePointerPos,i);switch(i.button){case 0:t.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger,a);break;case 1:t.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger,a);break;case 2:t.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger,a)}t.actionManager.processTrigger(e.ActionManager.OnPickDownTrigger,a)}t.actionManager.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger)&&window.setTimeout((function(){var r=o._primPointerInfo,n=o.getCapturedPrimitive(r.pointerId);o._updateIntersectionList(r.canvasPointerPos,null!==n,!0),o._updateOverStatus(!1);var a=new e.IntersectInfo2D;a.pickPosition=r.canvasPointerPos.clone(),a.findFirstOnly=!1,o.intersect(a),null!==a.isPrimIntersected(t)&&t.actionManager&&0!==o._pickStartingTime&&(new Date).getTime()-o._pickStartingTime>e.ActionManager.LongPressDelay&&Math.abs(o._pickStartingPosition.x-a.pickPosition.x)<e.ActionManager.DragMovementThreshold&&Math.abs(o._pickStartingPosition.y-a.pickPosition.y)<e.ActionManager.DragMovementThreshold&&(o._pickStartingTime=0,t.actionManager.processTrigger(e.ActionManager.OnLongPressTrigger,e.ActionEvent.CreateNewFromPrimitive(t,r.primitivePointerPos,i)))}),e.ActionManager.LongPressDelay)}}else if(0!==(n&e.PrimitivePointerInfo.PointerUp)){this._pickStartingTime=0;var a=e.ActionEvent.CreateNewFromPrimitive(t,r.primitivePointerPos,i);t.actionManager&&(t.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,a),Math.abs(this._pickStartingPosition.x-r.canvasPointerPos.x)<e.ActionManager.DragMovementThreshold&&Math.abs(this._pickStartingPosition.y-r.canvasPointerPos.y)<e.ActionManager.DragMovementThreshold&&t.actionManager.processTrigger(e.ActionManager.OnPickTrigger,a)),this._pickedDownPrim&&this._pickedDownPrim.actionManager&&this._pickedDownPrim!==t&&this._pickedDownPrim.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger,a)}else if(0!==(n&e.PrimitivePointerInfo.PointerOver)){if(t.actionManager){var a=e.ActionEvent.CreateNewFromPrimitive(t,r.primitivePointerPos,i);t.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,a)}}else if(0!==(n&e.PrimitivePointerInfo.PointerOut)&&t.actionManager){var a=e.ActionEvent.CreateNewFromPrimitive(t,r.primitivePointerPos,i);t.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,a)}},n.prototype._notifParents=function(t,r){for(var n=this._primPointerInfo,i=this;i;)this._updatePrimPointerPos(i),r===e.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(i,e.PrimitivePointerInfo.PointerEnter),i._pointerEventObservable.notifyObservers(n,e.PrimitivePointerInfo.PointerEnter)):r===e.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(i,e.PrimitivePointerInfo.PointerLeave),i._pointerEventObservable.notifyObservers(n,e.PrimitivePointerInfo.PointerLeave)),i=i.parent},n.prototype.dispose=function(){if(!r.prototype.dispose.call(this))return!1;this._profilingCanvas&&(this._profilingCanvas.dispose(),this._profilingCanvas=null),this.interactionEnabled&&this._setupInteraction(!1),this._beforeRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this._beforeRenderObserver=null),this._afterRenderObserver&&(this._scene.onAfterRenderObservable.remove(this._afterRenderObserver),this._afterRenderObserver=null),this._groupCacheMaps&&(this._groupCacheMaps.forEach((function(e,t){return t.forEach((function(e){return e.dispose()}))})),this._groupCacheMaps=null);var e=n._INSTANCES.indexOf(this);e>-1&&n._INSTANCES.splice(e,1)},Object.defineProperty(n.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"engine",{get:function(){return this._engine},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cachingStrategy",{get:function(){return this._cachingStrategy},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isScreenSpace",{get:function(){return this._isScreenSpace},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"worldSpaceCanvasNode",{get:function(){return this._worldSpaceNode},set:function(e){this._worldSpaceNode=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"supportInstancedArray",{get:function(){return this._supprtInstancedArray},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"backgroundFill",{get:function(){return this._background&&this._background.isVisible?this._background.fill:null},set:function(e){this.checkBackgroundAvailability(),e!==this._background.fill&&(this._background.fill=e,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"backgroundBorder",{get:function(){return this._background&&this._background.isVisible?this._background.border:null},set:function(e){this.checkBackgroundAvailability(),e!==this._background.border&&(this._background.border=e,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"backgroundBorderThickness",{get:function(){return this._background&&this._background.isVisible?this._background.borderThickness:null},set:function(e){this.checkBackgroundAvailability(),e!==this._background.borderThickness&&(this._background.borderThickness=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"backgroundRoundRadius",{get:function(){return this._background&&this._background.isVisible?this._background.roundRadius:null},set:function(e){this.checkBackgroundAvailability(),e!==this._background.roundRadius&&(this._background.roundRadius=e,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"interactionEnabled",{get:function(){return this._interactionEnabled},set:function(e){this._setupInteraction(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"designSize",{get:function(){return this._designSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"designSizeUseHorizAxis",{get:function(){return this._designUseHorizAxis},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_engineData",{get:function(){return this.__engineData},enumerable:!0,configurable:!0}),n.prototype.createCanvasProfileInfoCanvas=function(){if(this._profilingCanvas)return this._profilingCanvas;var t=new i(this.scene,{id:"ProfileInfoCanvas",cachingStrategy:n.CACHESTRATEGY_DONTCACHE,children:[new e.Rectangle2D({id:"ProfileBorder",border:"#FFFFFFFF",borderThickness:2,roundRadius:5,fill:"#C04040C0",marginAlignment:"h: left, v: top",
margin:"10",padding:"10",children:[new e.Text2D("Stats",{id:"ProfileInfoText",marginAlignment:"h: left, v: top",fontName:"10pt Lucida Console"})]})]});return this._profileInfoText=t.findById("ProfileInfoText"),this._profilingCanvas=t,t},n.prototype.checkBackgroundAvailability=function(){if(this._cachingStrategy===n.CACHESTRATEGY_TOPLEVELGROUPS)throw Error("Can't use Canvas Background with the caching strategy TOPLEVELGROUPS")},n.prototype._initPerfMetrics=function(){this._drawCallsOpaqueCounter.fetchNewFrame(),this._drawCallsAlphaTestCounter.fetchNewFrame(),this._drawCallsTransparentCounter.fetchNewFrame(),this._groupRenderCounter.fetchNewFrame(),this._updateTransparentDataCounter.fetchNewFrame(),this._cachedGroupRenderCounter.fetchNewFrame(),this._updateCachedStateCounter.fetchNewFrame(),this._updateLayoutCounter.fetchNewFrame(),this._updatePositioningCounter.fetchNewFrame(),this._updateLocalTransformCounter.fetchNewFrame(),this._updateGlobalTransformCounter.fetchNewFrame(),this._boundingInfoRecomputeCounter.fetchNewFrame()},n.prototype._fetchPerfMetrics=function(){this._drawCallsOpaqueCounter.addCount(0,!0),this._drawCallsAlphaTestCounter.addCount(0,!0),this._drawCallsTransparentCounter.addCount(0,!0),this._groupRenderCounter.addCount(0,!0),this._updateTransparentDataCounter.addCount(0,!0),this._cachedGroupRenderCounter.addCount(0,!0),this._updateCachedStateCounter.addCount(0,!0),this._updateLayoutCounter.addCount(0,!0),this._updatePositioningCounter.addCount(0,!0),this._updateLocalTransformCounter.addCount(0,!0),this._updateGlobalTransformCounter.addCount(0,!0),this._boundingInfoRecomputeCounter.addCount(0,!0)},n.prototype._updateProfileCanvas=function(){if(null!=this._profileInfoText){var e=function(e){return(Math.round(100*e)/100).toString()},t="Draw Calls:\n"+(" - Opaque:      "+e(this.drawCallsOpaqueCounter.current)+", (avg:"+e(this.drawCallsOpaqueCounter.lastSecAverage)+", t:"+e(this.drawCallsOpaqueCounter.total)+")\n")+(" - AlphaTest:   "+e(this.drawCallsAlphaTestCounter.current)+", (avg:"+e(this.drawCallsAlphaTestCounter.lastSecAverage)+", t:"+e(this.drawCallsAlphaTestCounter.total)+")\n")+(" - Transparent: "+e(this.drawCallsTransparentCounter.current)+", (avg:"+e(this.drawCallsTransparentCounter.lastSecAverage)+", t:"+e(this.drawCallsTransparentCounter.total)+")\n")+("Group Render: "+this.groupRenderCounter.current+", (avg:"+e(this.groupRenderCounter.lastSecAverage)+", t:"+e(this.groupRenderCounter.total)+")\n")+("Update Transparent Data: "+this.updateTransparentDataCounter.current+", (avg:"+e(this.updateTransparentDataCounter.lastSecAverage)+", t:"+e(this.updateTransparentDataCounter.total)+")\n")+("Cached Group Render: "+this.cachedGroupRenderCounter.current+", (avg:"+e(this.cachedGroupRenderCounter.lastSecAverage)+", t:"+e(this.cachedGroupRenderCounter.total)+")\n")+("Update Cached States: "+this.updateCachedStateCounter.current+", (avg:"+e(this.updateCachedStateCounter.lastSecAverage)+", t:"+e(this.updateCachedStateCounter.total)+")\n")+(" - Update Layout: "+this.updateLayoutCounter.current+", (avg:"+e(this.updateLayoutCounter.lastSecAverage)+", t:"+e(this.updateLayoutCounter.total)+")\n")+(" - Update Positioning: "+this.updatePositioningCounter.current+", (avg:"+e(this.updatePositioningCounter.lastSecAverage)+", t:"+e(this.updatePositioningCounter.total)+")\n")+(" - Update Local  Trans: "+this.updateLocalTransformCounter.current+", (avg:"+e(this.updateLocalTransformCounter.lastSecAverage)+", t:"+e(this.updateLocalTransformCounter.total)+")\n")+(" - Update Global Trans: "+this.updateGlobalTransformCounter.current+", (avg:"+e(this.updateGlobalTransformCounter.lastSecAverage)+", t:"+e(this.updateGlobalTransformCounter.total)+")\n")+(" - BoundingInfo Recompute: "+this.boundingInfoRecomputeCounter.current+", (avg:"+e(this.boundingInfoRecomputeCounter.lastSecAverage)+", t:"+e(this.boundingInfoRecomputeCounter.total)+")\n");this._profileInfoText.text=t}},n.prototype._addDrawCallCount=function(t,r){switch(r){case e.Render2DContext.RenderModeOpaque:return void this._drawCallsOpaqueCounter.addCount(t,!1);case e.Render2DContext.RenderModeAlphaTest:return void this._drawCallsAlphaTestCounter.addCount(t,!1);case e.Render2DContext.RenderModeTransparent:return void this._drawCallsTransparentCounter.addCount(t,!1)}},n.prototype._addGroupRenderCount=function(e){this._groupRenderCounter.addCount(e,!1)},n.prototype._addUpdateTransparentDataCount=function(e){this._updateTransparentDataCounter.addCount(e,!1)},n.prototype.addCachedGroupRenderCounter=function(e){this._cachedGroupRenderCounter.addCount(e,!1)},n.prototype.addUpdateCachedStateCounter=function(e){this._updateCachedStateCounter.addCount(e,!1)},n.prototype.addUpdateLayoutCounter=function(e){this._updateLayoutCounter.addCount(e,!1)},n.prototype.addUpdatePositioningCounter=function(e){this._updatePositioningCounter.addCount(e,!1)},n.prototype.addupdateLocalTransformCounter=function(e){this._updateLocalTransformCounter.addCount(e,!1)},n.prototype.addUpdateGlobalTransformCounter=function(e){this._updateGlobalTransformCounter.addCount(e,!1)},n.prototype._updateTrackedNodes=function(){var t=this.scene.cameraToUseForPointers||this.scene.activeCamera;t.getViewMatrix().multiplyToRef(t.getProjectionMatrix(),n._m);for(var r=this.engine.getRenderHeight(),i=t.viewport.toGlobal(this.engine.getRenderWidth(),r),o=0,a=this._trackedGroups;o<a.length;o++){var s=a[o];if(!s.isDisposed&&s.isVisible){var l=s.trackedNode,u=l.getWorldMatrix(),c=e.Vector3.Project(n._v,u,n._m,i),h=this.scale;s.x=Math.round(c.x/h),s.y=Math.round((r-c.y)/h)}}},n.prototype.updateCanvasLayout=function(e){this._updateCanvasState(e)},n.prototype._updateAdaptiveSizeWorldCanvas=function(){if(!(this._globalTransformStep<2)){var t=this.worldSpaceCanvasNode,r=t.getBoundingInfo().boundingBox,i=r.vectorsWorld,o=this.scene.cameraToUseForPointers||this.scene.activeCamera;o.getViewMatrix().multiplyToRef(o.getProjectionMatrix(),n._m);for(var a=o.viewport.toGlobal(this.engine.getRenderWidth(),this.engine.getRenderHeight()),s=new Array(4),l=0;l<4;l++)s[l]=e.Vector3.Project(i[l],n._mI,n._m,a);var u=s[3].subtract(s[0]).length(),c=s[3].subtract(s[1]).length(),h=s[1].subtract(s[2]).length(),d=s[2].subtract(s[0]).length(),p=Math.round(Math.max(c,d)),f=Math.round(Math.max(h,u)),_=p>f,g=Math.max(p,f);g=g<256?256:Math.pow(2,Math.ceil(Math.log(g)/Math.log(2))),g=Math.min(g,this._maxAdaptiveWorldSpaceCanvasSize);var y=g/(_?this.size.width:this.size.height);if(y!==this.scale){var P=y;this._setRenderingScale(P)}}},n.prototype._updateCanvasState=function(t){if(t||this.scene.getRenderId()!==this._updateRenderId){var r=!1,n=this.engine.getRenderWidth();n!==this._renderingSize.width&&(r=!0),this._renderingSize.width=n;var i=this.engine.getRenderHeight();if(i!==this._renderingSize.height&&(r=!0),this._renderingSize.height=i,r&&this._fitRenderingDevice&&(this._actualSize=this._renderingSize.clone(),this._size=this._renderingSize.clone(),this._background&&(this._background.size=this.size),this._setLayoutDirty()),this._designSize){var o=void 0;o=this._designUseHorizAxis?this._renderingSize.width/this._designSize.width:this._renderingSize.height/this._designSize.height,this.size=this._designSize.clone(),this.actualSize=this._designSize.clone(),this.scale=o}var a=new e.PrepareRender2DContext;++this._globalTransformProcessStep,this.updateCachedStates(!1),this._prepareGroupRender(a),this._updateRenderId=this.scene.getRenderId()}},n.prototype._render=function(){this._initPerfMetrics(),this._updateCanvasState(!1),this._updateTrackedNodes(),this.isVisible!==!1&&(this._isScreenSpace||this._updateAdaptiveSizeWorldCanvas(),this._updateCanvasState(!1),this._primPointerInfo.canvasPointerPos&&(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,!1,!1),this._updateOverStatus(!1)),this.engine.setState(!1),this._groupRender(),this._isScreenSpace||this._isFlagSet(e.SmartPropertyPrim.flagWorldCacheChanged)&&(this.worldSpaceCacheChanged(),this._clearFlags(e.SmartPropertyPrim.flagWorldCacheChanged)),this._cachingStrategy===n.CACHESTRATEGY_CANVAS&&this._cachedCanvasGroup&&this._cachedCanvasGroup._renderCachedCanvas(),this._fetchPerfMetrics(),this._updateProfileCanvas())},n.prototype._allocateGroupCache=function(t,r,i,o,a){void 0===o&&(o=!1),void 0===a&&(a=1);var s,l=(o?"MipMap":"NoMipMap")+"_"+a,u=t._renderableData,c=u._noResizeOnScale,h=null==r;s=c?h?n._unS:t.parent.actualScale:t.actualScale;var d=t.actualSize;d=new e.Size(Math.ceil(d.width*s.x),Math.ceil(d.height*s.y)),i&&(d.width=Math.max(i.width,d.width),d.height=Math.max(i.height,d.height));for(var p,f=this._groupCacheMaps.getOrAddWithFactory(l,(function(){return new Array})),_=null,g=0,y=f;g<y.length;g++){var P=y[g];p=P;var b=p.allocateRect(d);if(b){_={node:b,texture:p};break}}if(!_){var v=new e.Size(n._groupTextureCacheSize,n._groupTextureCacheSize);(d.width>v.width||d.height>v.height)&&(v.width=Math.pow(2,Math.ceil(Math.log(d.width)/Math.log(2))),v.height=Math.pow(2,Math.ceil(Math.log(d.height)/Math.log(2))));var m="groupsMapChache"+this._mapCounter++ +"forCanvas"+this.id;p=new e.MapTexture(m,this._scene,v,o?e.Texture.TRILINEAR_SAMPLINGMODE:e.Texture.BILINEAR_SAMPLINGMODE,o),p.hasAlpha=!0,p.anisotropicFilteringLevel=4,f.splice(0,0,p);var b=p.allocateRect(d);_={node:b,texture:p}}if(t!==this||this._isScreenSpace){var b=_.node,C=void 0;if(this._cachingStrategy===n.CACHESTRATEGY_CANVAS?(this._cachedCanvasGroup=e.Group2D._createCachedCanvasGroup(this),C=new e.Sprite2D(p,{parent:this._cachedCanvasGroup,id:"__cachedCanvasSprite__",spriteSize:b.contentSize,spriteLocation:b.pos}),C.zOrder=1,C.origin=e.Vector2.Zero()):(C=new e.Sprite2D(p,{parent:r,id:"__cachedSpriteOfGroup__"+t.id,x:t.actualPosition.x,y:t.actualPosition.y,spriteSize:b.contentSize,spriteLocation:b.pos,dontInheritParentScale:!0}),C.origin=t.origin.clone(),C.addExternalData("__cachedGroup__",t),C.pointerEventObservable.add((function(e,r){null!==t.pointerEventObservable&&t.pointerEventObservable.notifyObservers(e,r.mask)})),_.sprite=C),C&&c){var D=h?t.actualScale:t.actualScale.divide(t.parent.actualScale);C.scaleX=D.x,C.scaleY=D.y}}return _},n.prototype._registerTrackedNode=function(t){t._isFlagSet(e.SmartPropertyPrim.flagTrackedGroup)||(this._trackedGroups.push(t),t._setFlags(e.SmartPropertyPrim.flagTrackedGroup))},n.prototype._unregisterTrackedNode=function(t){if(t._isFlagSet(e.SmartPropertyPrim.flagTrackedGroup)){var r=this._trackedGroups.indexOf(t);r!==-1&&this._trackedGroups.splice(r,1),t._clearFlags(e.SmartPropertyPrim.flagTrackedGroup)}},n.GetSolidColorBrush=function(t){return n._solidColorBrushes.getOrAddWithFactory(t.toHexString(),(function(){return new e.SolidColorBrush2D(t.clone(),(!0))}))},n.GetSolidColorBrushFromHex=function(t){return n._solidColorBrushes.getOrAddWithFactory(t,(function(){return new e.SolidColorBrush2D(e.Color4.FromHexString(t),(!0))}))},n.GetGradientColorBrush=function(t,r,i,o,a){return void 0===i&&(i=e.Vector2.Zero()),void 0===o&&(o=0),void 0===a&&(a=1),n._gradientColorBrushes.getOrAddWithFactory(e.GradientColorBrush2D.BuildKey(t,r,i,o,a),(function(){return new e.GradientColorBrush2D(t,r,i,o,a,(!0))}))},n.GetBrushFromString=function(t){t=t.trim();var r=t.split(",");if(1===r.length){var i=null;if(0===t.indexOf("solid:"))i=t.substr(6).trim();else{if(0!==t.indexOf("#"))return null;i=t}return n.GetSolidColorBrushFromHex(i)}0===r[0].indexOf("gradient:")&&(r[0]=r[0].substr(9).trim());try{var o=e.Color4.FromHexString(r[0].trim()),a=e.Color4.FromHexString(r[1].trim()),s=e.Vector2.Zero();if(r.length>2){var l=r[2].trim();if("["!==l.charAt(0)||"]"!==l.charAt(l.length-1))return null;var u=l.indexOf(":"),c=parseFloat(l.substr(1,u)),h=parseFloat(l.substr(u+1,l.length-(u+1)));s=new e.Vector2(c,h)}var d=0;r.length>3&&(d=e.Tools.ToRadians(parseFloat(r[3].trim())));var p=1;return r.length>4&&(p=parseFloat(r[4].trim())),n.GetGradientColorBrush(o,a,s,d,p)}catch(f){return null}},n.CACHESTRATEGY_TOPLEVELGROUPS=1,n.CACHESTRATEGY_ALLGROUPS=2,n.CACHESTRATEGY_CANVAS=3,n.CACHESTRATEGY_DONTCACHE=4,n._INSTANCES=[],n._zMinDelta=1/(Math.pow(2,24)-1),n._interInfo=new e.IntersectInfo2D,n._v=e.Vector3.Zero(),n._m=e.Matrix.Identity(),n._mI=e.Matrix.Identity(),n._unS=new e.Vector2(1,1),n._groupTextureCacheSize=1024,n._solidColorBrushes=new e.StringDictionary,n._gradientColorBrushes=new e.StringDictionary,n=__decorate([e.className("Canvas2D")],n)})(e.Group2D);e.Canvas2D=r;var n=(function(t){function n(n,i,o){var a=this;e.Prim2DBase._isCanvasInit=!0;var s=o;if(s.isScreenSpace=!1,s.size=i.clone(),o.cachingStrategy=null==o.cachingStrategy?r.CACHESTRATEGY_CANVAS:o.cachingStrategy,o.cachingStrategy!==r.CACHESTRATEGY_CANVAS)throw new Error("Right now only the CACHESTRATEGY_CANVAS cache Strategy is supported for WorldSpace Canvas. More will come soon!");t.call(this,n,o),e.Prim2DBase._isCanvasInit=!1,this._renderableData._useMipMap=!0,this._renderableData._anisotropicLevel=8;var l=!o||null==o.customWorldSpaceNode,u=o?o.id||null:null,c=this.engine.getCaps().maxRenderTextureSize,h=Math.min(c,1024);if(null==o.maxAdaptiveCanvasSize?this._maxAdaptiveWorldSpaceCanvasSize=h:this._maxAdaptiveWorldSpaceCanvasSize=Math.min(o.maxAdaptiveCanvasSize,c),l){var d=new e.WorldSpaceCanvas2DNode(u,n,this),p=e.VertexData.CreatePlane({width:i.width,height:i.height,sideOrientation:o&&o.sideOrientation||e.Mesh.DEFAULTSIDE}),f=new e.StandardMaterial(u+"_Material",n);this.applyCachedTexture(p,f),p.applyToMesh(d,!0),f.specularColor=new e.Color3(0,0,0),f.disableLighting=!0,f.useAlphaFromDiffuseTexture=!0,d.position=o&&o.worldPosition||e.Vector3.Zero(),d.rotationQuaternion=o&&o.worldRotation||e.Quaternion.Identity(),d.material=f,this._worldSpaceNode=d}else this._worldSpaceNode=o.customWorldSpaceNode,this.applyCachedTexture(null,null);this.propertyChanged.add((function(e,t){var r=a._worldSpaceNode;r&&(r.isVisible=a.isVisible)}),e.Prim2DBase.isVisibleProperty.flagId)}return __extends(n,t),n=__decorate([e.className("WorldSpaceCanvas2D")],n)})(r);e.WorldSpaceCanvas2D=n;var i=(function(t){function r(r,n){e.Prim2DBase._isCanvasInit=!0,t.call(this,r,n)}return __extends(r,t),r=__decorate([e.className("ScreenSpaceCanvas2D")],r)})(r);e.ScreenSpaceCanvas2D=i})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(e){function t(t,r,n){e.call(this,t,r),this._canvas=n}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._canvas&&(this._canvas.dispose(),this._canvas=null)},t})(e.Mesh);e.WorldSpaceCanvas2DNode=t})(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore={ellipse2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",ellipse2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\natt float opacity;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat ms=properties.z;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<ms) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=ms;\n}\nfloat angle=TWOPI*segi/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat ms=properties.z;\nfloat angle=TWOPI*(index-1.0)/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\n}\n#endif\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvColor.a*=opacity;\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",lines2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",lines2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute vec2 position;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\natt float opacity;\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec2 boundingMin;\natt vec2 boundingMax;\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvColor.a*=opacity;\nvec4 pos;\npos.xy=position.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",rect2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",rect2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\natt float opacity;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n\n#define rsub0 17.0\n#define rsub1 33.0\n#define rsub2 49.0\n#define rsub3 65.0\n#define rsub 64.0\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (properties.z == 0.0) {\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<4.0) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=4.0;\n}\nif (segi == 0.0) {\npos2=vec2(1.0,1.0);\n} \nelse if (segi == 1.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (segi == 2.0) {\npos2=vec2(0.0,0.0);\n} \nelse {\npos2=vec2(0.0,1.0);\n}\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse if (index == 1.0) {\npos2=vec2(1.0,1.0);\n}\nelse if (index == 2.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (index == 3.0) {\npos2=vec2(0.0,0.0);\n}\nelse {\npos2=vec2(0.0,1.0);\n}\n#endif\n}\nelse\n{\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<rsub) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=rsub;\n}\n\nif (segi<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (segi<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (segi<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\n\nif (index<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (index<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (index<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\n}\n#endif\n}\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvColor.a*=opacity;\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",sprite2dPixelShader:"varying vec2 vUV;\nvarying float vOpacity;\nuniform bool alphaTest;\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest)\n{\nif (color.a<0.95) {\ndiscard;\n}\n}\ncolor.a*=vOpacity;\ngl_FragColor=color;\n}",sprite2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 scaleFactor;\natt vec2 textureSize;\n\natt vec3 properties;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\natt float opacity;\n\n\nvarying vec2 vUV;\nvarying float vOpacity;\nvoid main(void) {\nvec2 pos2;\n\nvec2 off=vec2(0.0,0.0);\nvec2 sfSizeUV=sizeUV*scaleFactor;\nfloat frame=properties.x;\nfloat invertY=properties.y;\nfloat alignToPixel=properties.z;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x+(frame*sfSizeUV.x)+off.x,topLeftUV.y-off.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x+(frame*sfSizeUV.x)+off.x,(topLeftUV.y+sfSizeUV.y));\n}\n\nelse if (index == 2.0) {\npos2=vec2( 1.0,1.0);\nvUV=vec2(topLeftUV.x+sfSizeUV.x+(frame*sfSizeUV.x),(topLeftUV.y+sfSizeUV.y));\n}\n\nelse if (index == 3.0) {\npos2=vec2( 1.0,0.0);\nvUV=vec2(topLeftUV.x+sfSizeUV.x+(frame*sfSizeUV.x),topLeftUV.y-off.y);\n}\nif (invertY == 1.0) {\nvUV.y=1.0-vUV.y;\n}\nvec4 pos;\nif (alignToPixel == 1.0)\n{\npos.xy=floor(pos2.xy*sizeUV*textureSize);\n} else {\npos.xy=pos2.xy*sizeUV*textureSize;\n}\nvOpacity=opacity;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n} ",text2dPixelShader:"varying vec4 vColor;\nvarying vec2 vUV;\n\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\ngl_FragColor=color*vColor;\n}",text2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\natt float opacity;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\natt vec4 color;\natt float superSampleFactor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y+sizeUV.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y);\n}\n\nelse if (index == 2.0) {\npos2=vec2(1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y);\n}\n\nelse if (index == 3.0) {\npos2=vec2(1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y+sizeUV.y);\n}\n\nvUV=(floor(vUV*textureSize)+vec2(0.0,0.0))/textureSize;\nvColor=color;\nvColor.a*=opacity;\nvec4 pos;\npos.xy=floor(pos2.xy*superSampleFactor*sizeUV*textureSize); \npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}"},("undefined"!=typeof window&&window.module||"undefined"!=typeof module)&&"undefined"!=typeof module.exports&&(module.exports=BABYLON);