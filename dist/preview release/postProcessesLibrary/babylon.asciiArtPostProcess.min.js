var BABYLON,__extends=this&&this.__extends||(function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}})(),__decorate=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;0<=c;c--)(n=t[c])&&(a=(i<3?n(a):3<i?n(e,o,a):n(e,o))||a);return 3<i&&a&&Object.defineProperty(e,o,a),a};!(function(x){var l=(function(g){function o(t,e,o,r){void 0===r&&(r=null);var n=g.call(this,r)||this;if(!(r=n.getScene()))return n;n.name=t,n._text,n._font,n.wrapU=x.Texture.CLAMP_ADDRESSMODE,n.wrapV=x.Texture.CLAMP_ADDRESSMODE;var i=n.getFontHeight(e),a=n.getFontWidth(e);n._charSize=Math.max(i.height,a);var c=Math.ceil(n._charSize*o.length),l=n._charSize;n._texture=r.getEngine().createDynamicTexture(c,l,!1,x.Texture.NEAREST_SAMPLINGMODE);var f=n.getSize(),s=document.createElement("canvas");s.width=f.width,s.height=f.height;var u=s.getContext("2d");u.textBaseline="top",u.font=e,u.fillStyle="white",u.imageSmoothingEnabled=!1;for(var h=0;h<o.length;h++)u.fillText(o[h],h*n._charSize,-i.offset);return r.getEngine().updateDynamicTexture(n._texture,s,!1,!0),n}return __extends(o,g),Object.defineProperty(o.prototype,"charSize",{get:function(){return this._charSize},enumerable:!0,configurable:!0}),o.prototype.getFontWidth=function(t){var e=document.createElement("canvas").getContext("2d");return e.fillStyle="white",e.font=t,e.measureText("W").width},o.prototype.getFontHeight=function(t){var e=document.createElement("canvas"),o=e.getContext("2d");o.fillRect(0,0,e.width,e.height),o.textBaseline="top",o.fillStyle="white",o.font=t,o.fillText("jH|",0,0);for(var r=o.getImageData(0,0,e.width,e.height).data,n=-1,i=-1,a=0;a<e.height;a++)for(var c=0;c<e.width;c++){if(0===r[4*(a*e.width+c)]){if(c!==e.width-1||-1===n)continue;i=a,a=e.height;break}-1===n&&(n=a);break}return{height:i-n+1,offset:n-1}},o.prototype.clone=function(){return new o(this.name,this._font,this._text,this.getScene())},o.Parse=function(t,e){return x.SerializationHelper.Parse((function(){return new o(t.name,t.font,t.text,e)}),t,e,null)},__decorate([x.serialize("font")],o.prototype,"_font",void 0),__decorate([x.serialize("text")],o.prototype,"_text",void 0),o})(x.BaseTexture);x.AsciiArtFontTexture=l;var t=(function(c){function t(t,e,o){var r=c.call(this,t,"asciiart",["asciiArtFontInfos","asciiArtOptions"],["asciiArtFont"],{width:e.getEngine().getRenderWidth(),height:e.getEngine().getRenderHeight()},e,x.Texture.TRILINEAR_SAMPLINGMODE,e.getEngine(),!0)||this;r.mixToTile=0,r.mixToNormal=0;var n="40px Monospace",i=" `-.'_:,\"=^;<+!*?/cL\\zrs7TivJtC{3F)Il(xZfY5S2eajo14[nuyE]P6V9kXpKwGhqAUbOd8#HRDB0$mgMW&Q%N@";o&&("string"==typeof o?n=o:(n=o.font||n,i=o.characterSet||i,r.mixToTile=o.mixToTile||r.mixToTile,r.mixToNormal=o.mixToNormal||r.mixToNormal)),r._asciiArtFontTexture=new l(t,n,i,e.getScene());var a=r._asciiArtFontTexture.getSize();return r.onApply=function(t){t.setTexture("asciiArtFont",r._asciiArtFontTexture),t.setFloat4("asciiArtFontInfos",r._asciiArtFontTexture.charSize,i.length,a.width,a.height),t.setFloat4("asciiArtOptions",r.width,r.height,r.mixToNormal,r.mixToTile)},r}return __extends(t,c),t})(x.PostProcess);x.AsciiArtPostProcess=t})(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore.asciiartPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D asciiArtFont;\n\nuniform vec4 asciiArtFontInfos;\nuniform vec4 asciiArtOptions;\n\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\n\nvoid main(void) \n{\nfloat caracterSize=asciiArtFontInfos.x;\nfloat numChar=asciiArtFontInfos.y-1.0;\nfloat fontx=asciiArtFontInfos.z;\nfloat fonty=asciiArtFontInfos.w;\nfloat screenx=asciiArtOptions.x;\nfloat screeny=asciiArtOptions.y;\nfloat tileX=float(floor((gl_FragCoord.x)/caracterSize))*caracterSize/screenx;\nfloat tileY=float(floor((gl_FragCoord.y)/caracterSize))*caracterSize/screeny;\nvec2 tileUV=vec2(tileX,tileY);\nvec4 tileColor=texture2D(textureSampler,tileUV);\nvec4 baseColor=texture2D(textureSampler,vUV);\nfloat tileLuminance=getLuminance(tileColor.rgb);\nfloat offsetx=(float(floor(tileLuminance*numChar)))*caracterSize/fontx;\nfloat offsety=0.0;\nfloat x=float(mod(gl_FragCoord.x,caracterSize))/fontx;\nfloat y=float(mod(gl_FragCoord.y,caracterSize))/fonty;\nvec4 finalColor=texture2D(asciiArtFont,vec2(offsetx+x,offsety+(caracterSize/fonty-y)));\nfinalColor.rgb*=tileColor.rgb;\nfinalColor.a=1.0;\nfinalColor=mix(finalColor,tileColor,asciiArtOptions.w);\nfinalColor=mix(finalColor,baseColor,asciiArtOptions.z);\ngl_FragColor=finalColor;\n}";