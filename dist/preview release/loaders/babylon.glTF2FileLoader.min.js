var BABYLON;!(function(e){var r=(function(){function r(){this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}}}return r.prototype.importMeshAsync=function(e,t,n,a,o,i){var s=r._parse(n),l=this._getLoader(s);if(!l)return void i();l.importMeshAsync(e,t,s,a,o,i)},r.prototype.loadAsync=function(e,t,n,a,o){var i=r._parse(t),s=this._getLoader(i);return s?s.loadAsync(e,i,n,a,o):void o()},r._parse=function(e){return e instanceof ArrayBuffer?r._parseBinary(e):{json:JSON.parse(e),bin:null}},r.prototype._getLoader=function(t){var n={major:2,minor:0},a=t.json.asset||{},o=r._parseVersion(a.version);if(!o)return e.Tools.Error("Invalid version"),null;var i=r._parseVersion(a.minVersion);if(i&&r._compareVersion(i,n)>0)return e.Tools.Error("Incompatible version"),null;var s={1:r.GLTFLoaderV1,2:r.GLTFLoaderV2},l=s[o.major];return void 0===l?(e.Tools.Error("Unsupported version"),null):null===l?(e.Tools.Error("v"+o.major+" loader is not available"),null):l},r._parseBinary=function(n){var a={Magic:1179937895},o=new t(n),i=o.readUint32();if(i!==a.Magic)return e.Tools.Error("Unexpected magic: "+i),null;var s=o.readUint32();switch(s){case 1:return r._parseV1(o);case 2:return r._parseV2(o)}return e.Tools.Error("Unsupported version: "+s),null},r._parseV1=function(t){var n={JSON:0},a=t.readUint32();if(a!=t.getLength())return e.Tools.Error("Length in header does not match actual data length: "+a+" != "+t.getLength()),null;var o,i=t.readUint32(),s=t.readUint32();switch(s){case n.JSON:o=JSON.parse(r._decodeBufferToText(t.readUint8Array(i)));break;default:return e.Tools.Error("Unexpected content format: "+s),null}var l=t.getLength()-t.getPosition();return{json:o,bin:t.readUint8Array(l)}},r._parseV2=function(t){var n={JSON:1313821514,BIN:5130562},a=t.readUint32();if(a!==t.getLength())return e.Tools.Error("Length in header does not match actual data length: "+a+" != "+t.getLength()),null;var o=t.readUint32(),i=t.readUint32();if(i!==n.JSON)return e.Tools.Error("First chunk format is not JSON"),null;for(var s=JSON.parse(r._decodeBufferToText(t.readUint8Array(o))),l=null;t.getPosition()<t.getLength();)switch(o=t.readUint32(),i=t.readUint32()){case n.JSON:return e.Tools.Error("Unexpected JSON chunk"),null;case n.BIN:l=t.readUint8Array(o);break;default:t.skipBytes(o)}return{json:s,bin:l}},r._parseVersion=function(e){if(!e)return null;var r=e.split(".");if(0===r.length)return null;var t=parseInt(r[0]);if(t>1&&2!=r.length)return null;parseInt(r[1]);return{major:t,minor:parseInt(r[0])}},r._compareVersion=function(e,r){return e.major>r.major?1:e.major<r.major?-1:e.minor>r.minor?1:e.minor<r.minor?-1:0},r._decodeBufferToText=function(e){for(var r="",t=e.byteLength,n=0;n<t;++n)r+=String.fromCharCode(e[n]);return r},r})();r.GLTFLoaderV1=null,r.GLTFLoaderV2=null,r.HomogeneousCoordinates=!1,r.IncrementalLoading=!0,e.GLTFFileLoader=r;var t=(function(){function e(e){this._arrayBuffer=e,this._dataView=new DataView(e),this._byteOffset=0}return e.prototype.getPosition=function(){return this._byteOffset},e.prototype.getLength=function(){return this._arrayBuffer.byteLength},e.prototype.readUint32=function(){var e=this._dataView.getUint32(this._byteOffset,!0);return this._byteOffset+=4,e},e.prototype.readUint8Array=function(e){var r=new Uint8Array(this._arrayBuffer,this._byteOffset,e);return this._byteOffset+=e,r},e.prototype.skipBytes=function(e){this._byteOffset+=e},e})();e.SceneLoader.RegisterPlugin(new r)})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){!(function(e){!(function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"})(e.EComponentType||(e.EComponentType={}));!(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(e.EMeshPrimitiveMode||(e.EMeshPrimitiveMode={}));!(function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR"})(e.ETextureMagFilter||(e.ETextureMagFilter={}));!(function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(e.ETextureMinFilter||(e.ETextureMinFilter={}));!(function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.REPEAT=10497]="REPEAT"})(e.ETextureWrapMode||(e.ETextureWrapMode={}))})(e.GLTF2||(e.GLTF2={}))})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){!(function(r){var t=["translation","rotation","scale","weights"],n=["position","rotationQuaternion","scaling","influence"],a=function(e){if(e)for(var r=0;r<e.length/2;r++)e[2*r+1]=1-e[2*r+1]},o=function(e){return"node"+e},i=function(a){var i=a.gltf.animations;if(i)for(var s=0;s<i.length;s++){var l=i[s];if(l&&l.channels&&l.samplers)for(var u=null,f=0;f<l.channels.length;f++){var c=l.channels[f];if(c){var d=l.samplers[c.sampler];if(d){var b=d.input,T=d.output,m=r.GLTFUtils.GetBufferFromAccessor(a,a.gltf.accessors[b]),h=r.GLTFUtils.GetBufferFromAccessor(a,a.gltf.accessors[T]),g=c.target.node,y=a.babylonScene.getNodeByID(o(g));if(null!==y){var v=y instanceof e.Bone,A=0,p=c.target.path,L=t.indexOf(p);-1!==L&&(p=n[L]);var E="influence"===p,M=e.Animation.ANIMATIONTYPE_MATRIX;v||("rotationQuaternion"===p?(M=e.Animation.ANIMATIONTYPE_QUATERNION,y.rotationQuaternion=new e.Quaternion):E?(M=e.Animation.ANIMATIONTYPE_FLOAT,A=y.morphTargetManager.numTargets):M=e.Animation.ANIMATIONTYPE_VECTOR3);var x=null,N=[],F=0,_=!1;if(v&&u&&u.getKeys().length===m.length&&(x=u,_=!0),E)for(var R=0;R<A;R++)N[R]=[];for(var I=0;I<m.length;I++){var S=null;if("rotationQuaternion"===p)S=e.Quaternion.FromArray([h[F],h[F+1],h[F+2],h[F+3]]),F+=4;else if(E){S=[];for(var R=0;R<A;R++)S.push(h[F+R]);F+=A}else S=e.Vector3.FromArray([h[F],h[F+1],h[F+2]]),F+=3;if(v){var O=y,B=e.Vector3.Zero(),G=new e.Quaternion,w=e.Vector3.Zero(),U=O.getBaseMatrix();_&&(U=u.getKeys()[I].value),U.decompose(w,G,B),"position"===p?B=S:"rotationQuaternion"===p?G=S:w=S,S=e.Matrix.Compose(w,G,B)}if(_)u.getKeys()[I].value=S;else if(E)for(var R=0;R<A;R++)N[R].push({frame:m[I],value:S[R]});else N.push({frame:m[I],value:S})}if(!_)if(E)for(var R=0;R<A;R++){var P=y.morphTargetManager.getTarget(R);void 0===P.animations&&(P.animations=[]);var C=(l.name||"anim"+s)+"_"+R;x=new e.Animation(C,p,1,M,e.Animation.ANIMATIONLOOPMODE_CYCLE),x.setKeys(N[R]),P.animations.push(x)}else{var C=l.name||"anim"+s;x=new e.Animation(C,v?"_matrix":p,1,M,e.Animation.ANIMATIONLOOPMODE_CYCLE),x.setKeys(N),y.animations.push(x)}if(u=x,E)for(var R=0;R<A;R++){var V=y.morphTargetManager.getTarget(R);a.babylonScene.stopAnimation(V),a.babylonScene.beginAnimation(V,0,m[m.length-1],!0,1)}else a.babylonScene.stopAnimation(y),a.babylonScene.beginAnimation(y,0,m[m.length-1],!0,1)}else e.Tools.Warn("Creating animation index "+s+" but cannot find node index "+g+" to attach to")}}}}},s=function(r){var t=null;if(r.translation||r.rotation||r.scale){var n=e.Vector3.FromArray(r.scale||[1,1,1]),a=e.Quaternion.FromArray(r.rotation||[0,0,0,1]),o=e.Vector3.FromArray(r.translation||[0,0,0]);t=e.Matrix.Compose(n,a,o)}else t=r.matrix?e.Matrix.FromArray(r.matrix):e.Matrix.Identity();return t},l=function(r,t,n,a){for(var i=o(n),u=0;u<a.bones.length;u++)if(a.bones[u].id===i)return a.bones[u].getParent();for(var f=t.joints,d=0;d<f.length;d++)for(var b=f[d],T=r.gltf.nodes[b],m=T.children,u=0;u<m.length;u++){var h=m[u];r.gltf.nodes[h];if(c(t,h)&&h===n){var g=s(T),y=new e.Bone(T.name||o(b),a,l(r,t,b,a),g);return y.id=o(b),y}}return null},u=function(e,r){for(var t=0;t<e.length;t++){var n=e[t];if(n.node.children)for(var a=0;a<n.node.children.length;a++){var o=n.node.children[a];if(o===r)return n.bone}}return null},f=function(e,r){var t=e.gltf.nodes[r];return t?{node:t,index:r}:null},c=function(e,r){for(var t=0;t<e.joints.length;t++)if(e.joints[t]===r)return!0;return!1},d=function(r,t,n,a){for(var i=0;i<r.gltf.nodes.length;i++){var l=r.gltf.nodes[i];if(!c(n,i)){var u=s(l),f=new e.Bone(l.name||o(i),t,null,u);f.id=o(i),a.push({bone:f,node:l,index:i})}}for(var i=0;i<a.length;i++){var d=a[i],b=d.node.children;if(b)for(var T=0;T<b.length;T++){for(var m=null,h=0;h<a.length;h++)if(a[h].index===b[T]){m=a[h];break}m&&(m.bone._parent=d.bone,d.bone.children.push(m.bone))}}},b=function(t,n,a){var i=a.name||"skin"+n.skin,c=a.babylonSkeleton;if(c||(c=new e.Skeleton(i,"skin"+n.skin,t.babylonScene)),!a.babylonSkeleton)return c;var b=t.gltf.accessors[a.inverseBindMatrices],T=(r.GLTFUtils.GetBufferFromAccessor(t,b),[]),m=[];d(t,c,a,T),c.bones=[];for(var h=0;h<a.joints.length;h++){var g=f(t,a.joints[h]),y=g.node;if(y){var v=g.index,A=o(v),p=t.babylonScene.getBoneByID(A);if(p)c.bones.push(p);else{for(var L=!1,E=null,M=0;M<h;M++){var x=f(t,a.joints[M]).node;if(x){var N=x.children;L=!1;for(var F=0;F<N.length;F++)if(N[F]===v){E=l(t,a,a.joints[M],c),L=!0;break}if(L)break}else e.Tools.Warn("Joint index "+a.joints[M]+" does not exist when looking for parent")}var _=s(y);!E&&T.length>0&&(E=u(T,v))&&-1===m.indexOf(E)&&m.push(E);new e.Bone(y.name||A,c,E,_).id=A}}else e.Tools.Warn("Joint index "+a.joints[h]+" does not exist")}var R=c.bones;c.bones=[];for(var h=0;h<a.joints.length;h++){var g=f(t,a.joints[h]);if(g)for(var I=o(g.index),M=0;M<R.length;M++)if(R[M].id===I){c.bones.push(R[M]);break}}c.prepare();for(var h=0;h<m.length;h++)c.bones.push(m[h]);return c},T=function(t,n){if(void 0===n)return r.GLTFUtils.GetDefaultMaterial(t);var a=t.gltf.materials;if(!a||n<0||n>=a.length)return e.Tools.Error("Invalid material index"),r.GLTFUtils.GetDefaultMaterial(t);var o=t.gltf.materials[n].babylonMaterial;return o||r.GLTFUtils.GetDefaultMaterial(t)},m=function(t,n,o){var i=o.name||n.name||"mesh"+n.mesh,s=n.babylonNode;if(s||(s=new e.Mesh(i,t.babylonScene)),!n.babylonNode)return s;var l=new e.MultiMaterial(i,t.babylonScene);s.material||(s.material=l);for(var u=new e.VertexData,f=new e.Geometry(i,t.babylonScene,u,!1,s),c=[],d=[],b=[],m=[],h=new e.MorphTargetManager,g=0;g<o.primitives.length;g++){var y=new e.VertexData,v=o.primitives[g];v.mode,r.EMeshPrimitiveMode.TRIANGLES;var A=v.attributes,p=null,L=null;for(var E in A)if(p=t.gltf.accessors[A[E]],L=r.GLTFUtils.GetBufferFromAccessor(t,p),"NORMAL"===E)y.normals=new Float32Array(L.length),y.normals.set(L);else if("POSITION"===E)y.positions=new Float32Array(L.length),y.positions.set(L),d.push(y.positions.length);else if("TANGENT"===E)y.tangents=new Float32Array(L.length),y.tangents.set(L);else if(-1!==E.indexOf("TEXCOORD_")){var M=Number(E.split("_")[1]),x=e.VertexBuffer.UVKind+(0===M?"":M+1),N=new Float32Array(L.length);N.set(L),a(N),y.set(N,x)}else"JOINT"===E?(y.matricesIndices=new Float32Array(L.length),y.matricesIndices.set(L)):"WEIGHT"===E?(y.matricesWeights=new Float32Array(L.length),y.matricesWeights.set(L)):"COLOR_0"===E?(y.colors=new Float32Array(L.length),y.colors.set(L)):e.Tools.Warn("Ignoring unrecognized semantic '"+E+"'");if(p=t.gltf.accessors[v.indices])L=r.GLTFUtils.GetBufferFromAccessor(t,p),y.indices=new Int32Array(L.length),y.indices.set(L),m.push(y.indices.length);else{for(var F=[],_=0;_<y.positions.length/3;_++)F.push(_);y.indices=new Int32Array(F),m.push(y.indices.length)}u.merge(y),y=void 0;var R=T(t,v.material);if(l.subMaterials.push(R),void 0!==v.targets)for(var I=0;I<v.targets.length;I++){var S=v.targets[I],O=0;void 0!==n.weights?O=n.weights[I]:void 0!==o.weights&&(O=o.weights[I]);var B=new e.MorphTarget("morph"+I,O);for(var E in S)if(p=t.gltf.accessors[S[E]],L=r.GLTFUtils.GetBufferFromAccessor(t,p),void 0!==p.name&&(B.name=p.name),"NORMAL"===E){for(var G=0;G<L.length;G++)L[G]+=u.normals[G];B.setNormals(L)}else if("POSITION"===E){for(var G=0;G<L.length;G++)L[G]+=u.positions[G];B.setPositions(L)}else if("TANGENT"===E){for(var G=0,w=0;G<L.length;G++,w++)L[G]+=u.tangents[w],(G+1)%3==0&&w++;B.setTangents(L)}else e.Tools.Warn("Ignoring unrecognized semantic '"+E+"'");void 0!==B.getPositions()?h.addTarget(B):e.Tools.Warn("Not adding morph target '"+B.name+"' because it has no position data")}c.push(0===c.length?0:c[c.length-1]+d[d.length-2]),b.push(0===b.length?0:b[b.length-1]+m[m.length-2])}f.setAllVerticesData(u,!1),s.computeWorldMatrix(!0),void 0!==h&&h.numTargets>0&&(s.morphTargetManager=h),s.subMeshes=[];for(var g=0;g<o.primitives.length;g++){o.primitives[g].mode,r.EMeshPrimitiveMode.TRIANGLES;new e.SubMesh(g,c[g],d[g],b[g],m[g],s,s,!0)}return s},h=function(r,t){var n=e.Vector3.Zero(),a=e.Quaternion.Identity(),o=new e.Vector3(1,1,1);if(t.matrix){e.Matrix.FromArray(t.matrix).decompose(o,a,n)}else t.translation&&(n=e.Vector3.FromArray(t.translation)),t.rotation&&(a=e.Quaternion.FromArray(t.rotation)),t.scale&&(o=e.Vector3.FromArray(t.scale));if(r.position=n,r.rotationQuaternion=a,r instanceof e.Mesh){r.scaling=o}},g=function(r,t){var n=null;if(r.importOnlyMeshes&&(void 0!==t.skin||void 0!==t.mesh)&&r.importMeshesNames.length>0&&-1===r.importMeshesNames.indexOf(t.name))return null;if(void 0!==t.skin){if(void 0!==t.mesh){var a=r.gltf.skins[t.skin],o=m(r,t,r.gltf.meshes[t.mesh]),i=b(r,t,a);i&&(o.skeleton=i,a.babylonSkeleton=i),n=o}}else if(void 0!==t.mesh)n=m(r,t,r.gltf.meshes[t.mesh]);else if(void 0!==t.camera&&!t.babylonNode&&!r.importOnlyMeshes){var s=r.gltf.cameras[t.camera];if(void 0!==s)if("orthographic"===s.type){var l=(s.orthographic,new e.FreeCamera(t.name||"camera"+t.camera,e.Vector3.Zero(),r.babylonScene));l.mode=e.Camera.ORTHOGRAPHIC_CAMERA,l.attachControl(r.babylonScene.getEngine().getRenderingCanvas()),n=l}else if("perspective"===s.type){var u=s.perspective,f=new e.FreeCamera(t.name||"camera"+t.camera,e.Vector3.Zero(),r.babylonScene);f.attachControl(r.babylonScene.getEngine().getRenderingCanvas()),u.aspectRatio||(u.aspectRatio=r.babylonScene.getEngine().getRenderWidth()/r.babylonScene.getEngine().getRenderHeight()),u.znear&&u.zfar&&(f.maxZ=u.zfar,f.minZ=u.znear),n=f}}if(t.babylonNode)return t.babylonNode;if(null===n){var c=new e.Mesh(t.name||"mesh"+t.mesh,r.babylonScene);t.babylonNode=c,n=c}return null!==n&&(h(n,t),n.updateCache(!0),t.babylonNode=n),n},y=function(e,r,t,n){var a=e.gltf.nodes[r],i=null;if(n=!(e.importOnlyMeshes&&!n)||(-1!==e.importMeshesNames.indexOf(a.name)||0===e.importMeshesNames.length),n&&null!==(i=g(e,a))&&(i.id=o(r),i.parent=t),a.children)for(var s=0;s<a.children.length;s++)y(e,a.children[s],i,n)},v=function(e){var r=e.gltf.scene||0,t=e.gltf.scenes;if(t)for(var n=t[r].nodes,a=0;a<n.length;a++)y(e,n[a],null);else for(var a=0;a<e.gltf.nodes.length;a++)y(e,a,null)},A=function(e){v(e),i(e);for(var r=0;r<e.babylonScene.skeletons.length;r++){var t=e.babylonScene.skeletons[r];e.babylonScene.beginAnimation(t,0,Number.MAX_VALUE,!0,1)}if(e.gltf.textures)for(var r=0;r<e.gltf.textures.length;r++){var n=e.gltf.textures[r];n.blobURL&&URL.revokeObjectURL(n.blobURL)}},p=(function(){function e(e){this._arrayBuffer=e,this._dataView=new DataView(e),this._byteOffset=0}e.prototype.getPosition=function(){return this._byteOffset},e.prototype.getLength=function(){return this._arrayBuffer.byteLength},e.prototype.readUint32=function(){var e=this._dataView.getUint32(this._byteOffset,!0);return this._byteOffset+=4,e},e.prototype.readUint8Array=function(e){var r=new Uint8Array(this._arrayBuffer,this._byteOffset,e);return this._byteOffset+=e,r},e.prototype.skipBytes=function(e){this._byteOffset+=e}}(),(function(){function t(){}return t.RegisterExtension=function(r){if(t.Extensions[r.name])return void e.Tools.Error('Tool with the same name "'+r.name+'" already exists');t.Extensions[r.name]=r},t.LoadMaterial=function(r,t){var n=r.gltf.materials[t];return n?(n.babylonMaterial=new e.PBRMaterial(n.name||"mat"+t,r.babylonScene),n.babylonMaterial.sideOrientation=e.Material.CounterClockWiseSideOrientation,n.babylonMaterial.useScalarInLinearSpace=!0,n):null},t.LoadMetallicRoughnessMaterialPropertiesAsync=function(r,n,a,o){n.babylonMaterial.metallic=1,n.babylonMaterial.roughness=1;var i=n.pbrMetallicRoughness;if(!i)return void a();if(n.babylonMaterial.albedoColor=i.baseColorFactor?e.Color3.FromArray(i.baseColorFactor):new e.Color3(1,1,1),n.babylonMaterial.metallic=i.metallicFactor||1,n.babylonMaterial.roughness=i.roughnessFactor||1,!i.baseColorTexture&&!i.metallicRoughnessTexture)return void a();var s=function(){i.baseColorTexture&&!n.babylonMaterial.albedoTexture||i.metallicRoughnessTexture&&!n.babylonMaterial.metallicTexture||a()};i.baseColorTexture&&t.LoadTextureAsync(r,i.baseColorTexture,(function(e){n.babylonMaterial.albedoTexture=e,t.LoadAlphaProperties(r,n),s()}),(function(){e.Tools.Error("Failed to load base color texture"),o()})),i.metallicRoughnessTexture&&t.LoadTextureAsync(r,i.metallicRoughnessTexture,(function(e){n.babylonMaterial.metallicTexture=e,n.babylonMaterial.useMetallnessFromMetallicTextureBlue=!0,n.babylonMaterial.useRoughnessFromMetallicTextureGreen=!0,n.babylonMaterial.useRoughnessFromMetallicTextureAlpha=!1,s()}),(function(){e.Tools.Error("Failed to load metallic roughness texture"),o()}))},t.LoadCommonMaterialPropertiesAsync=function(r,n,a,o){if(n.babylonMaterial.useEmissiveAsIllumination=!(!n.emissiveFactor&&!n.emissiveTexture),n.babylonMaterial.emissiveColor=n.emissiveFactor?e.Color3.FromArray(n.emissiveFactor):new e.Color3(0,0,0),n.doubleSided&&(n.babylonMaterial.backFaceCulling=!1,n.babylonMaterial.twoSidedLighting=!0),!n.normalTexture&&!n.occlusionTexture&&!n.emissiveTexture)return void a();var i=function(){n.normalTexture&&!n.babylonMaterial.bumpTexture||n.occlusionTexture&&!n.babylonMaterial.ambientTexture||n.emissiveTexture&&!n.babylonMaterial.emissiveTexture||a()};n.normalTexture&&t.LoadTextureAsync(r,n.normalTexture,(function(e){n.babylonMaterial.bumpTexture=e,void 0!==n.normalTexture.scale&&(n.babylonMaterial.bumpTexture.level=n.normalTexture.scale),i()}),(function(){e.Tools.Error("Failed to load normal texture"),o()})),n.occlusionTexture&&t.LoadTextureAsync(r,n.occlusionTexture,(function(e){n.babylonMaterial.ambientTexture=e,n.babylonMaterial.useAmbientInGrayScale=!0,void 0!==n.occlusionTexture.strength&&(n.babylonMaterial.ambientTextureStrength=n.occlusionTexture.strength),i()}),(function(){e.Tools.Error("Failed to load occlusion texture"),o()})),n.emissiveTexture&&t.LoadTextureAsync(r,n.emissiveTexture,(function(e){n.babylonMaterial.emissiveTexture=e,i()}),(function(){e.Tools.Error("Failed to load emissive texture"),o()}))},t.LoadAlphaProperties=function(r,t){switch(t.alphaMode||"OPAQUE"){case"OPAQUE":break;case"MASK":t.babylonMaterial.albedoTexture.hasAlpha=!0,t.babylonMaterial.useAlphaFromAlbedoTexture=!1,t.babylonMaterial.alphaMode=e.Engine.ALPHA_DISABLE;break;case"BLEND":t.babylonMaterial.albedoTexture.hasAlpha=!0,t.babylonMaterial.useAlphaFromAlbedoTexture=!0,t.babylonMaterial.alphaMode=e.Engine.ALPHA_COMBINE;break;default:e.Tools.Error("Invalid alpha mode '"+t.alphaMode+"'")}},t.LoadTextureAsync=function(e,n,a,o){var i=e.gltf.textures[n.index],s=n.texCoord||0;if(!i||void 0===i.source)return void o();if(i.babylonTextures){var l=i.babylonTextures[s];if(!l)for(var u=0;u<i.babylonTextures.length;u++)if(l=i.babylonTextures[u]){l=l.clone(),l.coordinatesIndex=s;break}return void a(l)}var f=e.gltf.images[i.source],c=e.rootUrl+f.uri;if(i.blobURL)c=i.blobURL;else if(void 0===f.uri){var d=e.gltf.bufferViews[f.bufferView],b=r.GLTFUtils.GetBufferFromBufferView(e,d,0,d.byteLength,r.EComponentType.UNSIGNED_BYTE);i.blobURL=URL.createObjectURL(new Blob([b],{type:f.mimeType})),c=i.blobURL}else if(r.GLTFUtils.IsBase64(f.uri)){var T=new Uint8Array(r.GLTFUtils.DecodeBase64(f.uri));i.blobURL=URL.createObjectURL(new Blob([T],{type:f.mimeType})),c=i.blobURL}t._createTextureAsync(e,i,s,c,a,o)},t._createTextureAsync=function(t,n,a,o,i,s){var l=void 0===n.sampler?{}:t.gltf.samplers[n.sampler],u=l.minFilter===r.ETextureMinFilter.NEAREST||l.minFilter===r.ETextureMinFilter.LINEAR,f=r.GLTFUtils.GetTextureFilterMode(l.minFilter),c=new e.Texture(o,t.babylonScene,u,!0,f,function(){i(c)},s);c.coordinatesIndex=a,c.wrapU=r.GLTFUtils.GetWrapMode(l.wrapS),c.wrapV=r.GLTFUtils.GetWrapMode(l.wrapT),c.name=n.name,n.babylonTextures=n.babylonTextures||[],n.babylonTextures[a]=c},t.prototype.importMeshAsync=function(r,n,a,o,i,s){n.useRightHandedSystem=!0;var l=t._createRuntime(n,a,o,!0);if(!l)return void s();""===r?l.importMeshesNames=[]:"string"==typeof r?l.importMeshesNames=[r]:!r||r instanceof Array?(l.importMeshesNames=[],e.Tools.Warn("Argument meshesNames must be of type string or string[]")):l.importMeshesNames=[r],v(l);for(var u=[],f=[],c=0;c<l.gltf.nodes.length;c++){var d=l.gltf.nodes[c];d.babylonNode instanceof e.AbstractMesh&&u.push(d.babylonNode)}for(var c=0;c<l.gltf.skins.length;c++){var b=l.gltf.skins[c];b.babylonSkeleton instanceof e.Skeleton&&f.push(b.babylonSkeleton)}t._loadBuffersAsync(l,(function(){t._loadMaterialsAsync(l,(function(){A(l),i(u,null,f)}),s)}),s),e.GLTFFileLoader.IncrementalLoading&&i&&i(u,null,f)},t.prototype.loadAsync=function(e,r,n,a,o){e.useRightHandedSystem=!0;var i=t._createRuntime(e,r,n,!1);if(!i)return void o();v(i),t._loadBuffersAsync(i,(function(){t._loadMaterialsAsync(i,(function(){A(i),a()}),o)}),o)},t._loadBuffersAsync=function(e,r,t){var n=this;if(0==e.gltf.buffers.length)return void r();var a=0;e.gltf.buffers.forEach((function(o,i){n._loadBufferAsync(e,i,(function(){++a===e.gltf.buffers.length&&r()}),t)}))},t._loadBufferAsync=function(t,n,a,o){var i=t.gltf.buffers[n];if(void 0===i.uri)a();else if(r.GLTFUtils.IsBase64(i.uri)){var s=r.GLTFUtils.DecodeBase64(i.uri);setTimeout((function(){i.loadedBufferView=new Uint8Array(s),a()}))}else e.Tools.LoadFile(t.rootUrl+i.uri,(function(e){i.loadedBufferView=new Uint8Array(e),a()}),null,null,!0,o)},t._loadMaterialsAsync=function(e,t,n){var a=e.gltf.materials;if(!a)return void t();for(var o=0,i=0;i<a.length;i++)r.GLTFLoaderExtension.LoadMaterialAsync(e,i,(function(){++o===a.length&&t()}),n)},t._createRuntime=function(t,n,a,o){var i,s={gltf:n.json,babylonScene:t,rootUrl:a,importOnlyMeshes:o},l=s.gltf.buffers;if(l.length>0&&void 0===l[0].uri&&(i=l[0]),n.bin){if(!i)return e.Tools.Error("Unexpected BIN chunk"),null;if(i.byteLength!=n.bin.byteLength)return e.Tools.Error("Binary buffer length from JSON does not match chunk length"),null;i.loadedBufferView=n.bin}return r.GLTFLoaderExtension.PostCreateRuntime(s),s},t})());p.Extensions={},r.GLTFLoader=p,e.GLTFFileLoader.GLTFLoaderV2=new p})(e.GLTF2||(e.GLTF2={}))})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){!(function(r){var t=(function(){function t(){}return t.IsBase64=function(e){return!(e.length<5)&&"data:"===e.substr(0,5)},t.DecodeBase64=function(e){for(var r=atob(e.split(",")[1]),t=r.length,n=new Uint8Array(new ArrayBuffer(t)),a=0;a<t;a++)n[a]=r.charCodeAt(a);return n.buffer},t.GetWrapMode=function(t){switch(t){case r.ETextureWrapMode.CLAMP_TO_EDGE:return e.Texture.CLAMP_ADDRESSMODE;case r.ETextureWrapMode.MIRRORED_REPEAT:return e.Texture.MIRROR_ADDRESSMODE;case r.ETextureWrapMode.REPEAT:default:return e.Texture.WRAP_ADDRESSMODE}},t.GetByteStrideFromType=function(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},t.GetTextureFilterMode=function(t){switch(t){case r.ETextureMinFilter.LINEAR:case r.ETextureMinFilter.LINEAR_MIPMAP_NEAREST:case r.ETextureMinFilter.LINEAR_MIPMAP_LINEAR:return e.Texture.TRILINEAR_SAMPLINGMODE;case r.ETextureMinFilter.NEAREST:case r.ETextureMinFilter.NEAREST_MIPMAP_NEAREST:return e.Texture.NEAREST_SAMPLINGMODE;default:return e.Texture.BILINEAR_SAMPLINGMODE}},t.GetBufferFromBufferView=function(e,t,n,a,o){n+=t.byteOffset||0;var i=e.gltf.buffers[t.buffer].loadedBufferView;if(n+a>i.byteLength)throw new Error("Buffer access is out of range");var s=i.buffer;switch(n+=i.byteOffset,o){case r.EComponentType.BYTE:return new Int8Array(s,n,a);case r.EComponentType.UNSIGNED_BYTE:return new Uint8Array(s,n,a);case r.EComponentType.SHORT:return new Int16Array(s,n,a);case r.EComponentType.UNSIGNED_SHORT:return new Uint16Array(s,n,a);case r.EComponentType.UNSIGNED_INT:return new Uint32Array(s,n,a);default:return new Float32Array(s,n,a)}},t.GetBufferFromAccessor=function(e,r){var n=e.gltf.bufferViews[r.bufferView],a=r.byteOffset||0,o=r.count*t.GetByteStrideFromType(r);return t.GetBufferFromBufferView(e,n,a,o,r.componentType)},t.DecodeBufferToText=function(e){for(var r="",t=e.byteLength,n=0;n<t;++n)r+=String.fromCharCode(e[n]);return r},t.GetDefaultMaterial=function(r){if(!r.defaultMaterial){var t=new e.PBRMaterial("gltf_default",r.babylonScene);t.sideOrientation=e.Material.CounterClockWiseSideOrientation,t.metallic=1,t.roughness=1,r.defaultMaterial=t}return r.defaultMaterial},t})();r.GLTFUtils=t})(e.GLTF2||(e.GLTF2={}))})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){!(function(e){var r=(function(){function r(e){this._name=e}return Object.defineProperty(r.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),r.prototype.postCreateRuntime=function(e){},r.prototype.loadMaterialAsync=function(e,r,t,n){return!1},r.PostCreateRuntime=function(r){for(var t in e.GLTFLoader.Extensions){e.GLTFLoader.Extensions[t].postCreateRuntime(r)}},r.LoadMaterialAsync=function(r,t,n,a){for(var o in e.GLTFLoader.Extensions){if(e.GLTFLoader.Extensions[o].loadMaterialAsync(r,t,n,a))return}var i=e.GLTFLoader.LoadMaterial(r,t);if(!i)return void n();var s=!1,l=!1,u=function(){s&&l&&n()};e.GLTFLoader.LoadMetallicRoughnessMaterialPropertiesAsync(r,i,(function(){s=!0,u()}),a),e.GLTFLoader.LoadCommonMaterialPropertiesAsync(r,i,(function(){l=!0,u()}),a)},r})();e.GLTFLoaderExtension=r})(e.GLTF2||(e.GLTF2={}))})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){!(function(r){var t=(function(t){function n(){return t.call(this,"KHR_materials_pbrSpecularGlossiness")||this}return __extends(n,t),n.prototype.loadMaterialAsync=function(t,n,a,o){var i=r.GLTFLoader.LoadMaterial(t,n);if(!i||!i.extensions)return!1;var s=i.extensions[this.name];if(!s)return!1;i.babylonMaterial.albedoColor=s.diffuseFactor?e.Color3.FromArray(s.diffuseFactor):new e.Color3(1,1,1),i.babylonMaterial.reflectivityColor=s.specularFactor?e.Color3.FromArray(s.specularFactor):new e.Color3(1,1,1),i.babylonMaterial.microSurface=void 0===s.glossinessFactor?1:s.glossinessFactor;var l=!1,u=function(){s.diffuseTexture&&!i.babylonMaterial.albedoTexture||s.specularGlossinessTexture&&!i.babylonMaterial.reflectivityTexture||!l||a()};return s.diffuseTexture&&r.GLTFLoader.LoadTextureAsync(t,s.diffuseTexture,(function(e){i.babylonMaterial.albedoTexture=e,r.GLTFLoader.LoadAlphaProperties(t,i),u()}),(function(){e.Tools.Warn("Failed to load diffuse texture"),o()})),s.specularGlossinessTexture&&r.GLTFLoader.LoadTextureAsync(t,s.specularGlossinessTexture,(function(e){i.babylonMaterial.reflectivityTexture=e,i.babylonMaterial.useMicroSurfaceFromReflectivityMapAlpha=!0,u()}),(function(){e.Tools.Warn("Failed to load metallic roughness texture"),o()})),r.GLTFLoader.LoadCommonMaterialPropertiesAsync(t,i,(function(){l=!0,u()}),o),!0},n})(r.GLTFLoaderExtension);r.GLTFMaterialsPbrSpecularGlossinessExtension=t,r.GLTFLoader.RegisterExtension(new t)})(e.GLTF2||(e.GLTF2={}))})(BABYLON||(BABYLON={}));