!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("babylonjs")):"function"==typeof define&&define.amd?define("babylonjs-loaders",["babylonjs"],t):"object"==typeof exports?exports["babylonjs-loaders"]=t(require("babylonjs")):e.LOADERS=t(e.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this,(function(e){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=15)}({0:function(t,r){t.exports=e},10:function(e,t,r){"use strict";r.r(t),r.d(t,"MTLFileLoader",(function(){return n})),r.d(t,"OBJFileLoader",(function(){return s}));var o=r(0),n=function(){function e(){this.materials=[]}return e.prototype.parseMTL=function(t,r,n,s){if(!(r instanceof ArrayBuffer)){for(var i,a=r.split("\n"),l=/\s+/,u=null,p=0;p<a.length;p++){var f=a[p].trim();if(0!==f.length&&"#"!==f.charAt(0)){var c=f.indexOf(" "),h=c>=0?f.substring(0,c):f;h=h.toLowerCase();var m=c>=0?f.substring(c+1).trim():"";"newmtl"===h?(u&&this.materials.push(u),t._blockEntityCollection=!!s,(u=new o.StandardMaterial(m,t))._parentContainer=s,t._blockEntityCollection=!1):"kd"===h&&u?(i=m.split(l,3).map(parseFloat),u.diffuseColor=o.Color3.FromArray(i)):"ka"===h&&u?(i=m.split(l,3).map(parseFloat),u.ambientColor=o.Color3.FromArray(i)):"ks"===h&&u?(i=m.split(l,3).map(parseFloat),u.specularColor=o.Color3.FromArray(i)):"ke"===h&&u?(i=m.split(l,3).map(parseFloat),u.emissiveColor=o.Color3.FromArray(i)):"ns"===h&&u?u.specularPower=parseFloat(m):"d"===h&&u?u.alpha=parseFloat(m):"map_ka"===h&&u?u.ambientTexture=e._getTexture(n,m,t):"map_kd"===h&&u?u.diffuseTexture=e._getTexture(n,m,t):"map_ks"===h&&u?u.specularTexture=e._getTexture(n,m,t):"map_ns"===h||("map_bump"===h&&u?u.bumpTexture=e._getTexture(n,m,t):"map_d"===h&&u&&(u.opacityTexture=e._getTexture(n,m,t)))}}u&&this.materials.push(u)}},e._getTexture=function(t,r,n){if(!r)return null;var s=t;if("file:"===t){var i=r.lastIndexOf("\\");-1===i&&(i=r.lastIndexOf("/")),s+=i>-1?r.substr(i+1):r}else s+=r;return new o.Texture(s,n,!1,e.INVERT_TEXTURE_Y)},e.INVERT_TEXTURE_Y=!0,e}(),s=function(){function e(t){this.name="obj",this.extensions=".obj",this.obj=/^o/,this.group=/^g/,this.mtllib=/^mtllib /,this.usemtl=/^usemtl /,this.smooth=/^s /,this.vertexPattern=/v(\s+[\d|\.|\+|\-|e|E]+){3,7}/,this.normalPattern=/vn(\s+[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.uvPattern=/vt(\s+[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.facePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,this.facePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,this.facePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,this._assetContainer=null,this._meshLoadOptions=t||e.currentMeshLoadOptions}return Object.defineProperty(e,"INVERT_TEXTURE_Y",{get:function(){return n.INVERT_TEXTURE_Y},set:function(e){n.INVERT_TEXTURE_Y=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"currentMeshLoadOptions",{get:function(){return{ComputeNormals:e.COMPUTE_NORMALS,OptimizeNormals:e.OPTIMIZE_NORMALS,ImportVertexColors:e.IMPORT_VERTEX_COLORS,InvertY:e.INVERT_Y,InvertTextureY:e.INVERT_TEXTURE_Y,UVScaling:e.UV_SCALING,MaterialLoadingFailsSilently:e.MATERIAL_LOADING_FAILS_SILENTLY,OptimizeWithUV:e.OPTIMIZE_WITH_UV,SkipMaterials:e.SKIP_MATERIALS}},enumerable:!1,configurable:!0}),e.prototype._loadMTL=function(e,t,r,n){var s=t+e;o.Tools.LoadFile(s,r,void 0,void 0,!1,(function(e,t){n(s,t)}))},e.prototype.createPlugin=function(){return new e(e.currentMeshLoadOptions)},e.prototype.canDirectLoad=function(e){return!1},e.prototype.importMeshAsync=function(e,t,r,o,n,s){return this._parseSolid(e,t,r,o).then((function(e){return{meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[]}}))},e.prototype.loadAsync=function(e,t,r,o,n){return this.importMeshAsync(null,e,t,r,o).then((function(){}))},e.prototype.loadAssetContainerAsync=function(e,t,r,n,s){var i=this,a=new o.AssetContainer(e);return this._assetContainer=a,this.importMeshAsync(null,e,t,r).then((function(e){return e.meshes.forEach((function(e){return a.meshes.push(e)})),e.meshes.forEach((function(e){var t=e.material;t&&(-1==a.materials.indexOf(t)&&(a.materials.push(t),t.getActiveTextures().forEach((function(e){-1==a.textures.indexOf(e)&&a.textures.push(e)}))))})),i._assetContainer=null,a})).catch((function(e){throw i._assetContainer=null,e}))},e.prototype._optimizeNormals=function(e){var t=e.getVerticesData(o.VertexBuffer.PositionKind),r=e.getVerticesData(o.VertexBuffer.NormalKind),n={};if(t&&r){for(var s=0;s<t.length/3;s++){(l=n[a=t[3*s+0]+"_"+t[3*s+1]+"_"+t[3*s+2]])||(l=[],n[a]=l),l.push(s)}var i=new o.Vector3;for(var a in n){var l;if(!((l=n[a]).length<2)){var u=l[0];for(s=1;s<l.length;++s){var p=l[s];r[3*u+0]+=r[3*p+0],r[3*u+1]+=r[3*p+1],r[3*u+2]+=r[3*p+2]}i.copyFromFloats(r[3*u+0],r[3*u+1],r[3*u+2]),i.normalize();for(s=0;s<l.length;++s){r[3*(p=l[s])+0]=i.x,r[3*p+1]=i.y,r[3*p+2]=i.z}}}e.setVerticesData(o.VertexBuffer.NormalKind,r)}},e.prototype._parseSolid=function(t,r,s,i){for(var a,l=this,u=[],p=[],f=[],c=[],h=[],m=[],d=[],v=[],_=[],g=[],x=[],y=0,L=!1,O=[],T=[],I=[],b=[],E=[],C="",V="",M=new n,A=1,P=!0,F=new o.Color4(.5,.5,.5,1),N=function(e,t,r,o,n,s,i){var a;-1===(a=l._meshLoadOptions.OptimizeWithUV?function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});var r=e[t[0]].normals.indexOf(t[1]);return 1!=r&&t[2]===e[t[0]].uv[r]?e[t[0]].idx[r]:-1}(x,[e,r,t]):function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});var r=e[t[0]].normals.indexOf(t[1]);return-1===r?-1:e[t[0]].idx[r]}(x,[e,r]))?(m.push(d.length),d.push(o),v.push(n),g.push(s),void 0!==i&&_.push(i),x[e].normals.push(r),x[e].idx.push(y++),l._meshLoadOptions.OptimizeWithUV&&x[e].uv.push(t)):m.push(a)},S=function(){for(var e=0;e<d.length;e++)O.push(d[e].x,d[e].y,d[e].z),I.push(g[e].x,g[e].y,g[e].z),b.push(v[e].x,v[e].y),!0===l._meshLoadOptions.ImportVertexColors&&T.push(_[e].r,_[e].g,_[e].b,_[e].a);d=[],g=[],v=[],_=[],x=[],y=0},w=function(e,t){for(var r=t;r<e.length-1;r++)E.push(e[0],e[r],e[r+1])},R=function(e,t){w(e,t);for(var r=0;r<E.length;r++){var n=parseInt(E[r])-1;N(n,0,0,u[n],o.Vector2.Zero(),o.Vector3.Up(),!0===l._meshLoadOptions.ImportVertexColors?c[n]:void 0)}E=[]},j=function(e,t){w(e,t);for(var r=0;r<E.length;r++){var n=E[r].split("/"),s=parseInt(n[0])-1,i=parseInt(n[1])-1;N(s,i,0,u[s],f[i],o.Vector3.Up(),!0===l._meshLoadOptions.ImportVertexColors?c[s]:void 0)}E=[]},U=function(e,t){w(e,t);for(var r=0;r<E.length;r++){var o=E[r].split("/"),n=parseInt(o[0])-1,s=parseInt(o[1])-1,i=parseInt(o[2])-1;N(n,s,i,u[n],f[s],p[i])}E=[]},Y=function(e,t){w(e,t);for(var r=0;r<E.length;r++){var n=E[r].split("//"),s=parseInt(n[0])-1,i=parseInt(n[1])-1;N(s,1,i,u[s],o.Vector2.Zero(),p[i],!0===l._meshLoadOptions.ImportVertexColors?c[s]:void 0)}E=[]},k=function(e,t){w(e,t);for(var r=0;r<E.length;r++){var o=E[r].split("/"),n=u.length+parseInt(o[0]),s=f.length+parseInt(o[1]),i=p.length+parseInt(o[2]);N(n,s,i,u[n],f[s],p[i],!0===l._meshLoadOptions.ImportVertexColors?c[n]:void 0)}E=[]},z=function(){h.length>0&&(a=h[h.length-1],S(),m.reverse(),a.indices=m.slice(),a.positions=O.slice(),a.normals=I.slice(),a.uvs=b.slice(),!0===l._meshLoadOptions.ImportVertexColors&&(a.colors=T.slice()),m=[],O=[],T=[],I=[],b=[])},B=s.split("\n"),D=0;D<B.length;D++){var G,X=B[D].trim().replace(/\s\s/g," ");if(0!==X.length&&"#"!==X.charAt(0))if(this.vertexPattern.test(X))G=X.match(/[^ ]+/g),u.push(new o.Vector3(parseFloat(G[1]),parseFloat(G[2]),parseFloat(G[3]))),!0===this._meshLoadOptions.ImportVertexColors&&(G.length>=7?c.push(new o.Color4(parseFloat(G[4]),parseFloat(G[5]),parseFloat(G[6]),7===G.length||void 0===G[7]?1:parseFloat(G[7]))):c.push(F));else if(null!==(G=this.normalPattern.exec(X)))p.push(new o.Vector3(parseFloat(G[1]),parseFloat(G[2]),parseFloat(G[3])));else if(null!==(G=this.uvPattern.exec(X)))f.push(new o.Vector2(parseFloat(G[1])*e.UV_SCALING.x,parseFloat(G[2])*e.UV_SCALING.y));else if(null!==(G=this.facePattern3.exec(X)))U(G[1].trim().split(" "),1);else if(null!==(G=this.facePattern4.exec(X)))Y(G[1].trim().split(" "),1);else if(null!==(G=this.facePattern5.exec(X)))k(G[1].trim().split(" "),1);else if(null!==(G=this.facePattern2.exec(X)))j(G[1].trim().split(" "),1);else if(null!==(G=this.facePattern1.exec(X)))R(G[1].trim().split(" "),1);else if(this.group.test(X)||this.obj.test(X)){var W={name:X.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:""};z(),h.push(W),L=!0,P=!0,A=1}else if(this.usemtl.test(X)){if(C=X.substring(7).trim(),!P||!L){z();W={name:"mesh_mm"+A.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:C};A++,h.push(W),L=!0}L&&P&&(h[h.length-1].materialName=C,P=!1)}else this.mtllib.test(X)?V=X.substring(7).trim():this.smooth.test(X)||console.log("Unhandled expression at line : "+X)}L&&(a=h[h.length-1],m.reverse(),S(),a.indices=m,a.positions=O,a.normals=I,a.uvs=b,!0===this._meshLoadOptions.ImportVertexColors&&(a.colors=T)),L||(m.reverse(),S(),h.push({name:o.Geometry.RandomId(),indices:m,positions:O,colors:T,normals:I,uvs:b,materialName:C}));for(var Z=[],K=new Array,J=0;J<h.length;J++){if(t&&h[J].name)if(t instanceof Array){if(-1===t.indexOf(h[J].name))continue}else if(h[J].name!==t)continue;a=h[J],r._blockEntityCollection=!!this._assetContainer;var q=new o.Mesh(h[J].name,r);q._parentContainer=this._assetContainer,r._blockEntityCollection=!1,K.push(h[J].materialName);var H=new o.VertexData;if(H.uvs=a.uvs,H.indices=a.indices,H.positions=a.positions,!0===this._meshLoadOptions.ComputeNormals){var Q=new Array;o.VertexData.ComputeNormals(a.positions,a.indices,Q),H.normals=Q}else H.normals=a.normals;!0===this._meshLoadOptions.ImportVertexColors&&(H.colors=a.colors),H.applyToMesh(q),this._meshLoadOptions.InvertY&&(q.scaling.y*=-1),!0===this._meshLoadOptions.OptimizeNormals&&this._optimizeNormals(q),Z.push(q)}var $=[];return""!==V&&!1===this._meshLoadOptions.SkipMaterials&&$.push(new Promise((function(e,t){l._loadMTL(V,i,(function(n){try{M.parseMTL(r,n,i,l._assetContainer);for(var s=0;s<M.materials.length;s++){for(var a,u=0,p=[];(a=K.indexOf(M.materials[s].name,u))>-1;)p.push(a),u=a+1;if(-1===a&&0===p.length)M.materials[s].dispose();else for(var f=0;f<p.length;f++)Z[p[f]].material=M.materials[s]}e()}catch(r){o.Tools.Warn("Error processing MTL file: '"+V+"'"),l._meshLoadOptions.MaterialLoadingFailsSilently?e():t(r)}}),(function(r,n){o.Tools.Warn("Error downloading MTL file: '"+V+"'"),l._meshLoadOptions.MaterialLoadingFailsSilently?e():t(n)}))}))),Promise.all($).then((function(){return Z}))},e.OPTIMIZE_WITH_UV=!0,e.INVERT_Y=!1,e.IMPORT_VERTEX_COLORS=!1,e.COMPUTE_NORMALS=!1,e.OPTIMIZE_NORMALS=!1,e.UV_SCALING=new o.Vector2(1,1),e.SKIP_MATERIALS=!1,e.MATERIAL_LOADING_FAILS_SILENTLY=!0,e}();o.SceneLoader&&o.SceneLoader.RegisterPlugin(new s)},15:function(e,t,r){"use strict";r.r(t),function(e){var o=r(10);r.d(t,"MTLFileLoader",(function(){return o.MTLFileLoader})),r.d(t,"OBJFileLoader",(function(){return o.OBJFileLoader}));var n=void 0!==e?e:"undefined"!=typeof window?window:void 0;if(void 0!==n)for(var s in o)n.BABYLON[s]=o[s]}.call(this,r(5))},5:function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r}})}));