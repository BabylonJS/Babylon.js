!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("babylonjs")):"function"==typeof define&&define.amd?define("babylonjs-loaders",["babylonjs"],e):"object"==typeof exports?exports["babylonjs-loaders"]=e(require("babylonjs")):t.LOADERS=e(t.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this,(function(t){return function(t){var e={};function s(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(r,i,function(e){return t[e]}.bind(null,i));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=15)}({0:function(e,s){e.exports=t},10:function(t,e,s){"use strict";s.r(e),s.d(e,"MTLFileLoader",(function(){return i})),s.d(e,"SolidParser",(function(){return o})),s.d(e,"OBJFileLoader",(function(){return n}));var r=s(0),i=function(){function t(){this.materials=[]}return t.prototype.parseMTL=function(e,s,i,o){if(!(s instanceof ArrayBuffer)){for(var n,a=s.split("\n"),l=/\s+/,h=null,p=0;p<a.length;p++){var _=a[p].trim();if(0!==_.length&&"#"!==_.charAt(0)){var u=_.indexOf(" "),d=u>=0?_.substring(0,u):_;d=d.toLowerCase();var c=u>=0?_.substring(u+1).trim():"";"newmtl"===d?(h&&this.materials.push(h),e._blockEntityCollection=!!o,(h=new r.StandardMaterial(c,e))._parentContainer=o,e._blockEntityCollection=!1):"kd"===d&&h?(n=c.split(l,3).map(parseFloat),h.diffuseColor=r.Color3.FromArray(n)):"ka"===d&&h?(n=c.split(l,3).map(parseFloat),h.ambientColor=r.Color3.FromArray(n)):"ks"===d&&h?(n=c.split(l,3).map(parseFloat),h.specularColor=r.Color3.FromArray(n)):"ke"===d&&h?(n=c.split(l,3).map(parseFloat),h.emissiveColor=r.Color3.FromArray(n)):"ns"===d&&h?h.specularPower=parseFloat(c):"d"===d&&h?h.alpha=parseFloat(c):"map_ka"===d&&h?h.ambientTexture=t._getTexture(i,c,e):"map_kd"===d&&h?h.diffuseTexture=t._getTexture(i,c,e):"map_ks"===d&&h?h.specularTexture=t._getTexture(i,c,e):"map_ns"===d||("map_bump"===d&&h?h.bumpTexture=t._getTexture(i,c,e):"map_d"===d&&h&&(h.opacityTexture=t._getTexture(i,c,e)))}}h&&this.materials.push(h)}},t._getTexture=function(e,s,i){if(!s)return null;var o=e;if("file:"===e){var n=s.lastIndexOf("\\");-1===n&&(n=s.lastIndexOf("/")),o+=n>-1?s.substr(n+1):s}else o+=s;return new r.Texture(o,i,!1,t.INVERT_TEXTURE_Y)},t.INVERT_TEXTURE_Y=!0,t}(),o=function(){function t(t,e,s){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new r.Color4(.5,.5,.5,1),this._materialToUse=t,this._babylonMeshesArray=e,this._loadingOptions=s}return t.prototype._isInArray=function(t,e){t[e[0]]||(t[e[0]]={normals:[],idx:[]});var s=t[e[0]].normals.indexOf(e[1]);return-1===s?-1:t[e[0]].idx[s]},t.prototype._isInArrayUV=function(t,e){t[e[0]]||(t[e[0]]={normals:[],idx:[],uv:[]});var s=t[e[0]].normals.indexOf(e[1]);return 1!=s&&e[2]===t[e[0]].uv[s]?t[e[0]].idx[s]:-1},t.prototype._setData=function(t,e,s,r,i,o,n){var a;-1===(a=this._loadingOptions.optimizeWithUV?this._isInArrayUV(this._tuplePosNorm,[t,s,e]):this._isInArray(this._tuplePosNorm,[t,s]))?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(r),this._wrappedUvsForBabylon.push(i),this._wrappedNormalsForBabylon.push(o),void 0!==n&&this._wrappedColorsForBabylon.push(n),this._tuplePosNorm[t].normals.push(s),this._tuplePosNorm[t].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[t].uv.push(e)):this._indicesForBabylon.push(a)},t.prototype._unwrapData=function(){for(var t=0;t<this._wrappedPositionForBabylon.length;t++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[t].x,this._wrappedPositionForBabylon[t].y,this._wrappedPositionForBabylon[t].z),this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[t].x,this._wrappedNormalsForBabylon[t].y,this._wrappedNormalsForBabylon[t].z),this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[t].x,this._wrappedUvsForBabylon[t].y),this._loadingOptions.importVertexColors&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[t].r,this._wrappedColorsForBabylon[t].g,this._wrappedColorsForBabylon[t].b,this._wrappedColorsForBabylon[t].a);this._wrappedPositionForBabylon=[],this._wrappedNormalsForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0},t.prototype._getTriangles=function(t,e){for(var s=e;s<t.length-1;s++)this._triangles.push(t[0],t[s],t[s+1])},t.prototype._setDataForCurrentFaceWithPattern1=function(t,e){this._getTriangles(t,e);for(var s=0;s<this._triangles.length;s++){var i=parseInt(this._triangles[s])-1;this._setData(i,0,0,this._positions[i],r.Vector2.Zero(),r.Vector3.Up(),this._loadingOptions.importVertexColors?this._colors[i]:void 0)}this._triangles=[]},t.prototype._setDataForCurrentFaceWithPattern2=function(t,e){this._getTriangles(t,e);for(var s=0;s<this._triangles.length;s++){var i=this._triangles[s].split("/"),o=parseInt(i[0])-1,n=parseInt(i[1])-1;this._setData(o,n,0,this._positions[o],this._uvs[n],r.Vector3.Up(),this._loadingOptions.importVertexColors?this._colors[o]:void 0)}this._triangles=[]},t.prototype._setDataForCurrentFaceWithPattern3=function(t,e){this._getTriangles(t,e);for(var s=0;s<this._triangles.length;s++){var r=this._triangles[s].split("/"),i=parseInt(r[0])-1,o=parseInt(r[1])-1,n=parseInt(r[2])-1;this._setData(i,o,n,this._positions[i],this._uvs[o],this._normals[n])}this._triangles=[]},t.prototype._setDataForCurrentFaceWithPattern4=function(t,e){this._getTriangles(t,e);for(var s=0;s<this._triangles.length;s++){var i=this._triangles[s].split("//"),o=parseInt(i[0])-1,n=parseInt(i[1])-1;this._setData(o,1,n,this._positions[o],r.Vector2.Zero(),this._normals[n],this._loadingOptions.importVertexColors?this._colors[o]:void 0)}this._triangles=[]},t.prototype._setDataForCurrentFaceWithPattern5=function(t,e){this._getTriangles(t,e);for(var s=0;s<this._triangles.length;s++){var r=this._triangles[s].split("/"),i=this._positions.length+parseInt(r[0]),o=this._uvs.length+parseInt(r[1]),n=this._normals.length+parseInt(r[2]);this._setData(i,o,n,this._positions[i],this._uvs[o],this._normals[n],this._loadingOptions.importVertexColors?this._colors[i]:void 0)}this._triangles=[]},t.prototype._addPreviousObjMesh=function(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice(),this._handledMesh.uvs=this._unwrappedUVForBabylon.slice(),this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._indicesForBabylon=[],this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[])},t.prototype._optimizeNormals=function(t){var e=t.getVerticesData(r.VertexBuffer.PositionKind),s=t.getVerticesData(r.VertexBuffer.NormalKind),i={};if(e&&s){for(var o=0;o<e.length/3;o++){(l=i[a=e[3*o+0]+"_"+e[3*o+1]+"_"+e[3*o+2]])||(l=[],i[a]=l),l.push(o)}var n=new r.Vector3;for(var a in i){var l;if(!((l=i[a]).length<2)){var h=l[0];for(o=1;o<l.length;++o){var p=l[o];s[3*h+0]+=s[3*p+0],s[3*h+1]+=s[3*p+1],s[3*h+2]+=s[3*p+2]}n.copyFromFloats(s[3*h+0],s[3*h+1],s[3*h+2]),n.normalize();for(o=0;o<l.length;++o){s[3*(p=l[o])+0]=n.x,s[3*p+1]=n.y,s[3*p+2]=n.z}}}t.setVerticesData(r.VertexBuffer.NormalKind,s)}},t.prototype.parse=function(e,s,i,o,n){for(var a,l=s.split("\n"),h=0;h<l.length;h++){var p,_=l[h].trim().replace(/\s\s/g," ");if(0!==_.length&&"#"!==_.charAt(0))if(t.VertexPattern.test(_)){if(p=_.match(/[^ ]+/g),this._positions.push(new r.Vector3(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]))),this._loadingOptions.importVertexColors)if(p.length>=7){var u=parseFloat(p[4]),d=parseFloat(p[5]),c=parseFloat(p[6]);this._colors.push(new r.Color4(u>1?u/255:u,d>1?d/255:d,c>1?c/255:c,7===p.length||void 0===p[7]?1:parseFloat(p[7])))}else this._colors.push(this._grayColor)}else if(null!==(p=t.NormalPattern.exec(_)))this._normals.push(new r.Vector3(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])));else if(null!==(p=t.UVPattern.exec(_)))this._uvs.push(new r.Vector2(parseFloat(p[1])*this._loadingOptions.UVScaling.x,parseFloat(p[2])*this._loadingOptions.UVScaling.y));else if(null!==(p=t.FacePattern3.exec(_)))this._setDataForCurrentFaceWithPattern3(p[1].trim().split(" "),1);else if(null!==(p=t.FacePattern4.exec(_)))this._setDataForCurrentFaceWithPattern4(p[1].trim().split(" "),1);else if(null!==(p=t.FacePattern5.exec(_)))this._setDataForCurrentFaceWithPattern5(p[1].trim().split(" "),1);else if(null!==(p=t.FacePattern2.exec(_)))this._setDataForCurrentFaceWithPattern2(p[1].trim().split(" "),1);else if(null!==(p=t.FacePattern1.exec(_)))this._setDataForCurrentFaceWithPattern1(p[1].trim().split(" "),1);else if(t.GroupDescriptor.test(_)||t.ObjectDescriptor.test(_)){var m={name:_.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:""};this._addPreviousObjMesh(),this._meshesFromObj.push(m),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(t.UseMtlDescriptor.test(_)){if(this._materialNameFromObj=_.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();m={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:this._materialNameFromObj};this._increment++,this._meshesFromObj.push(m),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else t.MtlLibGroupDescriptor.test(_)?n(_.substring(7).trim()):t.SmoothDescriptor.test(_)||console.log("Unhandled expression at line : "+_)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._handledMesh.normals=this._unwrappedNormalsForBabylon,this._handledMesh.uvs=this._unwrappedUVForBabylon,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon)),!this._hasMeshes){var f=null;if(this._indicesForBabylon.length)this._indicesForBabylon.reverse(),this._unwrapData();else{for(var y=0,F=this._positions;y<F.length;y++){var b=F[y];this._unwrappedPositionsForBabylon.push(b.x,b.y,b.z)}if(this._normals.length)for(var g=0,v=this._normals;g<v.length;g++){var O=v[g];this._unwrappedNormalsForBabylon.push(O.x,O.y,O.z)}if(this._uvs.length)for(var w=0,M=this._uvs;w<M.length;w++){var P=M[w];this._unwrappedUVForBabylon.push(P.x,P.y)}if(this._colors.length)for(var B=0,T=this._colors;B<T.length;B++){var x=T[B];this._unwrappedColorsForBabylon.push(x.r,x.g,x.b,x.a)}this._materialNameFromObj||((f=new r.StandardMaterial(r.Geometry.RandomId(),i)).pointsCloud=!0,this._materialNameFromObj=f.name,this._normals.length||(f.disableLighting=!0,f.emissiveColor=r.Color3.White()))}this._meshesFromObj.push({name:r.Geometry.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:f})}for(var C=0;C<this._meshesFromObj.length;C++){if(e&&this._meshesFromObj[C].name)if(e instanceof Array){if(-1===e.indexOf(this._meshesFromObj[C].name))continue}else if(this._meshesFromObj[C].name!==e)continue;this._handledMesh=this._meshesFromObj[C],i._blockEntityCollection=!!o;var N=new r.Mesh(this._meshesFromObj[C].name,i);if(N._parentContainer=o,i._blockEntityCollection=!1,this._materialToUse.push(this._meshesFromObj[C].materialName),0!==(null===(a=this._handledMesh.positions)||void 0===a?void 0:a.length)){var I=new r.VertexData;if(I.uvs=this._handledMesh.uvs,I.indices=this._handledMesh.indices,I.positions=this._handledMesh.positions,this._loadingOptions.computeNormals){var V=new Array;r.VertexData.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,V),I.normals=V}else I.normals=this._handledMesh.normals;this._loadingOptions.importVertexColors&&(I.colors=this._handledMesh.colors),I.applyToMesh(N),this._loadingOptions.invertY&&(N.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(N),this._babylonMeshesArray.push(N),this._handledMesh.directMaterial&&(N.material=this._handledMesh.directMaterial)}else this._babylonMeshesArray.push(N)}},t.ObjectDescriptor=/^o/,t.GroupDescriptor=/^g/,t.MtlLibGroupDescriptor=/^mtllib /,t.UseMtlDescriptor=/^usemtl /,t.SmoothDescriptor=/^s /,t.VertexPattern=/v(\s+[\d|\.|\+|\-|e|E]+){3,7}/,t.NormalPattern=/vn(\s+[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,t.UVPattern=/vt(\s+[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,t.FacePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,t.FacePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,t.FacePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,t.FacePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,t.FacePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,t}(),n=function(){function t(e){this.name="obj",this.extensions=".obj",this._assetContainer=null,this._loadingOptions=e||t.DefaultLoadingOptions}return Object.defineProperty(t,"INVERT_TEXTURE_Y",{get:function(){return i.INVERT_TEXTURE_Y},set:function(t){i.INVERT_TEXTURE_Y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DefaultLoadingOptions",{get:function(){return{computeNormals:t.COMPUTE_NORMALS,optimizeNormals:t.OPTIMIZE_NORMALS,importVertexColors:t.IMPORT_VERTEX_COLORS,invertY:t.INVERT_Y,invertTextureY:t.INVERT_TEXTURE_Y,UVScaling:t.UV_SCALING,materialLoadingFailsSilently:t.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:t.OPTIMIZE_WITH_UV,skipMaterials:t.SKIP_MATERIALS}},enumerable:!1,configurable:!0}),t.prototype._loadMTL=function(t,e,s,i){var o=e+t;r.Tools.LoadFile(o,s,void 0,void 0,!1,(function(t,e){i(o,e)}))},t.prototype.createPlugin=function(){return new t(t.DefaultLoadingOptions)},t.prototype.canDirectLoad=function(t){return!1},t.prototype.importMeshAsync=function(t,e,s,r,i,o){return this._parseSolid(t,e,s,r).then((function(t){return{meshes:t,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[]}}))},t.prototype.loadAsync=function(t,e,s,r,i){return this.importMeshAsync(null,t,e,s,r).then((function(){}))},t.prototype.loadAssetContainerAsync=function(t,e,s,i,o){var n=this,a=new r.AssetContainer(t);return this._assetContainer=a,this.importMeshAsync(null,t,e,s).then((function(t){return t.meshes.forEach((function(t){return a.meshes.push(t)})),t.meshes.forEach((function(t){var e=t.material;e&&(-1==a.materials.indexOf(e)&&(a.materials.push(e),e.getActiveTextures().forEach((function(t){-1==a.textures.indexOf(t)&&a.textures.push(t)}))))})),n._assetContainer=null,a})).catch((function(t){throw n._assetContainer=null,t}))},t.prototype._parseSolid=function(t,e,s,n){var a=this,l="",h=new i,p=new Array,_=[];new o(p,_,this._loadingOptions).parse(t,s,e,this._assetContainer,(function(t){l=t}));var u=[];return""===l||this._loadingOptions.skipMaterials||u.push(new Promise((function(t,s){a._loadMTL(l,n,(function(i){try{h.parseMTL(e,i,n,a._assetContainer);for(var o=0;o<h.materials.length;o++){for(var u,d=0,c=[];(u=p.indexOf(h.materials[o].name,d))>-1;)c.push(u),d=u+1;if(-1===u&&0===c.length)h.materials[o].dispose();else for(var m=0;m<c.length;m++){var f=_[c[m]],y=h.materials[o];f.material=y,f.getTotalIndices()||(y.pointsCloud=!0)}}t()}catch(e){r.Tools.Warn("Error processing MTL file: '"+l+"'"),a._loadingOptions.materialLoadingFailsSilently?t():s(e)}}),(function(e,i){r.Tools.Warn("Error downloading MTL file: '"+l+"'"),a._loadingOptions.materialLoadingFailsSilently?t():s(i)}))}))),Promise.all(u).then((function(){return _}))},t.OPTIMIZE_WITH_UV=!0,t.INVERT_Y=!1,t.IMPORT_VERTEX_COLORS=!1,t.COMPUTE_NORMALS=!1,t.OPTIMIZE_NORMALS=!1,t.UV_SCALING=new r.Vector2(1,1),t.SKIP_MATERIALS=!1,t.MATERIAL_LOADING_FAILS_SILENTLY=!0,t}();r.SceneLoader&&r.SceneLoader.RegisterPlugin(new n)},15:function(t,e,s){"use strict";s.r(e),function(t){var r=s(10);s.d(e,"MTLFileLoader",(function(){return r.MTLFileLoader})),s.d(e,"SolidParser",(function(){return r.SolidParser})),s.d(e,"OBJFileLoader",(function(){return r.OBJFileLoader}));var i=void 0!==t?t:"undefined"!=typeof window?window:void 0;if(void 0!==i)for(var o in r)i.BABYLON[o]=r[o]}.call(this,s(5))},5:function(t,e){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(t){"object"==typeof window&&(s=window)}t.exports=s}})}));